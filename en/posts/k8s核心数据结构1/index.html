<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>k8s核心数据结构（1） | Luenci</title>
<meta name=keywords content="k8s"><meta name=description content="Kubernetes 核心数据结构（1）

参考书籍：《Kubernetes源码剖析-郑旭东著》
K8s 是一个完全以资源为中心的系统
Group、Version、Resource 核心数据结构
​	Kuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。
​	Kuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）

Group: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。
Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。
Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。
Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。



​
​	Kubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。
​	资源组、资源版本、资源、子资源的完整表现形式<group>/<version>/<resource>/ <subresource>。以常用的 Deployment 资源为例，其完整表现形式为apps/v1/deployments/status
​	另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为<group>/<version>, Kind=<kind>，例如apps/v1, Kind=Deployment.
​	每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。
​	每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。
​	Kubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。"><meta name=author content="Luenci"><link rel=canonical href=https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://luenci.com/images/L.png><link rel=icon type=image/png sizes=16x16 href=https://luenci.com/images/L.png><link rel=icon type=image/png sizes=32x32 href=https://luenci.com/images/L.png><link rel=apple-touch-icon href=https://luenci.com/L.png><link rel=mask-icon href=https://luenci.com/L.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://umami.luenci.com/script.js data-website-id=b0a9e971-b470-43a2-bda9-182c654377f4></script><meta property="og:title" content="k8s核心数据结构（1）"><meta property="og:description" content="Kubernetes 核心数据结构（1）

参考书籍：《Kubernetes源码剖析-郑旭东著》
K8s 是一个完全以资源为中心的系统
Group、Version、Resource 核心数据结构
​	Kuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。
​	Kuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）

Group: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。
Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。
Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。
Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。



​
​	Kubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。
​	资源组、资源版本、资源、子资源的完整表现形式<group>/<version>/<resource>/ <subresource>。以常用的 Deployment 资源为例，其完整表现形式为apps/v1/deployments/status
​	另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为<group>/<version>, Kind=<kind>，例如apps/v1, Kind=Deployment.
​	每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。
​	每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。
​	Kubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。"><meta property="og:type" content="article"><meta property="og:url" content="https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-18T00:00:00+00:00"><meta property="og:site_name" content="(〃'▽'〃)"><meta name=twitter:card content="summary"><meta name=twitter:title content="k8s核心数据结构（1）"><meta name=twitter:description content="Kubernetes 核心数据结构（1）

参考书籍：《Kubernetes源码剖析-郑旭东著》
K8s 是一个完全以资源为中心的系统
Group、Version、Resource 核心数据结构
​	Kuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。
​	Kuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）

Group: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。
Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。
Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。
Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。



​
​	Kubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。
​	资源组、资源版本、资源、子资源的完整表现形式<group>/<version>/<resource>/ <subresource>。以常用的 Deployment 资源为例，其完整表现形式为apps/v1/deployments/status
​	另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为<group>/<version>, Kind=<kind>，例如apps/v1, Kind=Deployment.
​	每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。
​	每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。
​	Kubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://luenci.com/en/posts/"},{"@type":"ListItem","position":2,"name":"k8s核心数据结构（1）","item":"https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"k8s核心数据结构（1）","name":"k8s核心数据结构（1）","description":"Kubernetes 核心数据结构（1） 参考书籍：《Kubernetes源码剖析-郑旭东著》\nK8s 是一个完全以资源为中心的系统\nGroup、Version、Resource 核心数据结构 ​\tKuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。\n​\tKuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）\nGroup: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。 Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。 Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。 Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。 ​\n​\tKubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。 ​\t资源组、资源版本、资源、子资源的完整表现形式\u0026lt;group\u0026gt;/\u0026lt;version\u0026gt;/\u0026lt;resource\u0026gt;/ \u0026lt;subresource\u0026gt;。以常用的 Deployment 资源为例，其完整表现形式为apps/v1/deployments/status\n​\t另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为\u0026lt;group\u0026gt;/\u0026lt;version\u0026gt;, Kind=\u0026lt;kind\u0026gt;，例如apps/v1, Kind=Deployment.\n​\t每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。\n​\t每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。\n​\tKubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。\n","keywords":["k8s"],"articleBody":"Kubernetes 核心数据结构（1） 参考书籍：《Kubernetes源码剖析-郑旭东著》\nK8s 是一个完全以资源为中心的系统\nGroup、Version、Resource 核心数据结构 ​\tKuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。\n​\tKuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）\nGroup: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。 Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。 Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。 Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。 ​\n​\tKubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。 ​\t资源组、资源版本、资源、子资源的完整表现形式/// 。以常用的 Deployment 资源为例，其完整表现形式为apps/v1/deployments/status\n​\t另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为/, Kind=，例如apps/v1, Kind=Deployment.\n​\t每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。\n​\t每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。\n​\tKubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。\nResourceList ​\tKubernetes Group、 Version、Resource 等核心数据结构存放在staging/src/k8s.io/apimachinery/pkg/apis/meta/v1 目录中。它包含了Kubernetes 集群中所有组件使用的通 用核心数据结构，例如APIGroup、APIVersions、APIResource 等。其 中，我们可以 通过 APIResourceList 数据结构描述所有Group、Version、Resource 的结构。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 type APIResourceList struct { TypeMeta `json:\",inline\"` // groupVersion is the group and version this APIResourceList is for. GroupVersion string `json:\"groupVersion\"` // resources contains the name of the resources and if they are namespaced. APIResources []APIResource `json:\"resources\"` } type TypeMeta struct { Kind string `json:\"kind,omitempty\"` APIVersion string `json:\"apiVersion,omitempty\"` } type APIResource struct { // name is the plural name of the resource. Name string `json:\"name\"` // singularName is the singular name of the resource. This allows clients to handle plural and singular opaquely. // The singularName is more correct for reporting status on a single item and both singular and plural are allowed // from the kubectl CLI interface. SingularName string `json:\"singularName\"` // namespaced indicates if a resource is namespaced or not. Namespaced bool `json:\"namespaced\"` // group is the preferred group of the resource. Empty implies the group of the containing resource list. // For subresources, this may have a different value, for example: Scale\". Group string `json:\"group,omitempty\"` // version is the preferred version of the resource. Empty implies the version of the containing resource list // For subresources, this may have a different value, for example: v1 (while inside a v1beta1 version of the core resource's group)\". Version string `json:\"version,omitempty\"` // kind is the kind for the resource (e.g. 'Foo' is the kind for a resource 'foo') Kind string `json:\"kind\"` // verbs is a list of supported kube verbs (this includes get, list, watch, create, // update, patch, delete, deletecollection, and proxy) Verbs Verbs `json:\"verbs\"` // shortNames is a list of suggested short names of the resource. ShortNames []string `json:\"shortNames,omitempty\"` // categories is a list of the grouped resources this resource belongs to (e.g. 'all') Categories []string `json:\"categories,omitempty\"` StorageVersionHash string `json:\"storageVersionHash,omitempty\"` } ​\tKubernetes的每个资源可使用metav1.APIResource 结构进行描述，它描述资源的基本信息，例如资源名称 (即 Name 字段)、资源所属的命名空间(即 Namespaced 字段)、资源种类(即 Kind 字段)、资源可操作的方法列表(即 Verbs 字段)。\n​\t每一个资源都属于一个或多个资源版本， 资源所属的版本通过 metavl.APIVersions 结构描述，一个或多个资源版本通过Versions []string 字符串数组进行存储。\nGroup ​\tGroup ( 资源组)，在Kubernetes API Server 中也可称其为 APIGroup。Kubernetes 系统中定义了许多资源组，这些资源组按照不同功能将资源进行了划分，资源组特点如下。\n将众多资源按照功能划分成不同的资源组，并允许单独启用/ 禁用资源组。 当然也可以单独启用/禁用资源组中的资源。 支持不同资源组中拥有不同的资源版本。这方便组内的资源根据版本进行迭代升级。 支持同名的资源种类 (即 Kind ) 存在于不同的资源组内 。 资源组与资源版本通过 Kubernetes API Server 对外暴露，允许开发者通过 HTTP 协议进行交互并通过动态客户端( 即 DynamicClient )进行资源发现。 支持CRD 自定 义资源扩展。 用户交互简单，例如在使用kubectl 命令行工具时，可以不填写资源组名称 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type APIGroup struct { TypeMeta `json:\",inline\"` // name is the name of the group. Name string `json:\"name\"` // 资源组下所支持的资源版本. Versions []GroupVersionForDiscovery `json:\"versions\"` // 首选版本。 当一个资源组内存在多个资源版本时， Kubernetes API Server 在使用资源时会选择一 个首选版本作为当前版本 PreferredVersion GroupVersionForDiscovery `json:\"preferredVersion,omitempty\"` // a map of client CIDR to server address that is serving this group. // This is to help clients reach servers in the most network-efficient way possible. // Clients can use the app ropriate server address as per the CIDR that they match. // In case of multiple matches, clients should use the longest matching CIDR. // The server returns only those CIDRs that it thinks that the client can match. // For example: the master will return an internal IP CIDR only, if the client reaches the server using an internal IP. // Server looks at X-Forwarded-For header or X-Real-Ip header or request.RemoteAddr (in that order) to get the client IP. ServerAddressByClientCIDRs []ServerAddressByClientCIDR `json:\"serverAddressByClientCIDRs,omitempty\"` } ​\t在当前的Kubernetes 系统中，支持两类资源组，分别是拥有组名的资源组和没有组名的资源组。\n拥有组名的资源组: 其表现形式为//，例如 apps/v1/deployments\n没有组名的资源组: 被称为 Core Groups ( 即核心资源组)或 Legacy Groups , 也可被称为 Group Less ( 即无组 )。 其表现形式为 // ， 例 如 /v1/pods\n两类资源组表现形式不同， 形成的 HTTP PATH 路径也不同。 拥有组名的资源组的 HTTP PATH 以/apis 为前缀，其表现形式为/apis///，例如 http://localhost:8080/apis/apps/v1/deployments。没有组名的资源组的 HTTP PATH 以 api 为前缀，其表现形式为/api//，例如 http://localhost:8080/api/vl/pods.\nVersion ​\tKubernetes 的资源版本控制可分为了种，分别是 Alpha、Beta、Stable，它们之间的迭代顺序为Alpha -\u003e Beta -\u003e Stable，其通常用来表示软件测试过程中的 了个阶段。 Alpha是第1个阶段，一般用于内部测试; Beta 是第2 个阶段，该版本已经修复了大 部分不完善之处，但仍有可能存在缺陷和漏洞， 一般由特定的用户群来进行测试; Stable 是第了个阶段，此时基本形成了产品并达到了一定的成熟度，可稳定运行。 Kubernetes 资源版本控制详情如下:\nAlpha 版本 ​ Alpha 版本为内部测试版本，用于Kubernetes 开发者内部测试，该版本是不稳定的，可能存在很多缺陷和漏洞，官方随时可能会放弃支持该版本。在默认的情况下， 处于Alpha 版本的功能会被禁用。Alpha 版本名称一般为 vlalphal、vlalpha2、v2alphal 等。\nBeta 版本 ​ Beta 版本为相对稳定的版本， Beta 版本经过官方和社区很多次测试 ， 当功能迭代时，该版本会有较小的改变，但不会被删除。在默认的情况下，处于Beta 版本的功能是开启状态的。Beta 版本命名一般为 v1betal、v1beta2、v2betal。\nStable 版本 ​ Stable 版本为正式发布的版本, Stable 版本基本形成了产品 ，该版本不会被删除。 在默认的情况下 ，处于 stable 版本的功能全部处于开启状态 。Stable 版本命名一般为 v1、v2、 v3。\n1 2 3 4 5 6 7 8 9 10 11 12 13 type APIVersions struct { TypeMeta `json:\",inline\"` // 所支持的资源版本列表. Versions []string `json:\"versions\"` // a map of client CIDR to server address that is serving this group. // This is to help clients reach servers in the most network-efficient way possible. // Clients can use the appropriate server address as per the CIDR that they match. // In case of multiple matches, clients should use the longest matching CIDR. // The server returns only those CIDRs that it thinks that the client can match. // For example: the master will return an internal IP CIDR only, if the client reaches the server using an internal IP. // Server looks at X-Forwarded-For header or X-Real-Ip header or request.RemoteAddr (in that order) to get the client IP. ServerAddressByClientCIDRs []ServerAddressByClientCIDR `json:\"serverAddressByClientCIDRs\"` } CIDR（Classless Inter-Domain Routing）是一个用于给用户分配IP地址以及在互联网上有效地路由IP数据包的对IP地址进行归类的方法。与传统的A类、B类和C类寻址模式相比，CIDR在IP地址分配方面更为高效。CIDR采用斜线记法，表示为：IP地址/网络ID的位数。\n示例一：CIDR格式换算为IP地址网段\n例如10.0.0.0/8，换算为32位二进制地址：00001010.00000000.00000000.00000000。其中/8表示8位网络ID，即32位二进制地址中前8位是固定不变的，对应网段为：00001010.00000000.00000000.0000000000001010.11111111.11111111.11111111。则换算为十进制后，10.0.0.0/8表示：子网掩码为255.0.0.0，对应网段为10.0.0.010.255.255.255。\n示例二：IP地址网段换算为CIDR格式\n例如192.168.0.0192.168.31.255，后两段IP换算为二进制地址：00000000.0000000000011111.11111111，可以得出前19位（8*2+3）是固定不变的，则换算为CIDR格式后，表示为：192.168.0.0/19\nResource ​\t一 个资源被实例化后会表达为一 个资源对象(即Resource Object )。在 Kuberetes 系统中定义并运行着各式各样的资源对象，Kubernetes 资源对象如图所示。所有资源对象都是 Entity 。 Entity 翻译成中 文为 “ 实 体” ，Kubernetes 使用这些 Entity 来表示当前状态。可以通过 Kubernetes API Server 进行查询和更新每一个资源对象。 Kubernetes 目前支持两种 Entity，分别介绍如下\n持久性实体(Persistent Entity): 在资源对象被创建后，Kubernetes 会持久确保该资源对象存在。大部分资源对象属于持久性实体，例如 Deployment 资源对象\n短暂性实体(Ephemeral Entity): 也可称其为非持久性实体(Non-Persistent Entity ) 。 在资源对象被创建后，如果出现故障或调度失败 ，不会重新创建该资源对象，例如 Pod 资源对象\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 type APIResource struct { // name is the plural name of the resource. Name string `json:\"name\" protobuf:\"bytes,1,opt,name=name\"` // 资源的单数名称，它必须由小写字母组成，默认使用资源种类(Kind)的小写形式进行命名。例如，Pod 资源的单数名称为pod, 复数名称为pods SingularName string `json:\"singularName\"` // 资源是否拥有所属命名空间 Namespaced bool `json:\"namespaced\"` // 资源所在的资源组名称 Group string `json:\"group,omitempty\"` // 资源所在的资源版本 Version string `json:\"version,omitempty\"` // 资源种类 Kind string `json:\"kind\" ` // 资源可操作的方法列表，例如get 、list、delete、create、update 等 Verbs Verbs `json:\"verbs\"` // 资源的简称，例如 Pod 资源的简称为 po ShortNames []string `json:\"shortNames,omitempty\"` // 该资源所属的分组资源列表（例如“全部”) Categories []string `json:\"categories,omitempty\"` ...\t} 资源外部版本与内部版本 ​\tKubernetes 资源代码定义在 pkg/apis 目录下， 在详解资源代码定义之前， 先来了解一下资源的外部版本(ExternalVersion )与内部版本(Internal Version )。在 Kubernetes 系统中，同 一资源对应着两个版本，分别是外部版本和内部版本。例如，Deployment 资源，它所属的外部版本表现形式为apps/ v1，内部版本表现形式为apps/_internal'\nExternalObject: 外部版本资源对象，也称为 Versioned Object ( 即拥有资源版本的资源对象)。外部版本用于对外暴露给用户请求的接又所使用的资源对象，例如，用户在通过 YAML 或 JSON 格式的描述文件创建资源对象时，所使用的是外部版本的资源对象。外部版本的资源对象通过资源版本( Alpha 、Beta 、Stable )进行标识\nInternal Object: 内部版本资源对象。内部版本不对外暴露，仅在 Kubernetes API Server 内部使用。内部版本用于多资源版本的转换，例如将 v1betal 版本转换为 v1 版本，其过程为 v1betal--internal - v1，即先将 v1betal 转换为内部版本(internal )，再由内部版本(internal)转换为V1版本。内部版本资源对象通过 runtime. APIVersionlnternal (即 internal )进行标识。\n资源的外部版本代码定义在 pkg/apis///目录下，资源的内部版本代码定义在 pkg/apis//日 录 下。 例 如 ， Deployment 资源 ，它的外部版本定义在 pkg/apis/apps/{v1,V1betal, v1beta2}/ 目录下， 它的内部版本定义在pkg/apis/apps/目录下(内部版本一般与资源组在同一级目录下)。资源的外部版本与内部版本如图所示。\n资源的外部版本和内部版本是需要相互转换的，而用于转换的函数需要事先初始化到资源注册表 (Scheme) 中 。 多个外部版本 ( External Version ) 之间的资源进行相互转换，都需要通过内部版本 (Internal Version )进行中转。这也是Kubernetes 能实现多资源版本转换的关键.\n​\t资源的外部版本与内部版本的代码定义也不太一样，外部版本的资源需要对外暴露给用户请求的接又，所以资源代码定义了 JSONTags 和 Proto Tags，用于请求的序列化和反序列化操作。内部版本的资源不对外暴露，所以没有任何的 JSON Tags 和ProtoTags定义。以Pod 资源代码定义为例，代码示例如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // staging/src/k8s.io/api/core/v1/types.go 外部使用 type Pod struct { metav1.TypeMeta `json:\",inline\"` // Standard object's metadata. // More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata // +optional metav1.ObjectMeta `json:\"metadata,omitempty\" protobuf:\"bytes,1,opt,name=metadata\"` // Specification of the desired behavior of the pod. // More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status // +optional Spec PodSpec `json:\"spec,omitempty\" protobuf:\"bytes,2,opt,name=spec\"` // Most recently observed status of the pod. // This data may not be up to date. // Populated by the system. // Read-only. // More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status // +optional Status PodStatus `json:\"status,omitempty\" protobuf:\"bytes,3,opt,name=status\"` } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // pkg/apis/core/types.go 内部使用 type Pod struct { metav1.TypeMeta // +optional metav1.ObjectMeta // Spec defines the behavior of a pod. // +optional Spec PodSpec // Status represents the current information about a pod. This data may not be up // to date. // +optional Status PodStatus } 资源代码定义 ​ Kubernetes资源代码定义在pkg/apis目录下，同一资源对应着内部版本和外部版本，内部版本和外部版本的资源代码结构并不相同。\n​\t资源的内部版本定义了所支持的资源类型 ( types.go)、资源验证方法( validation.go )、资源注册至资源注册表的方法 ( install/install.go) 等 。 而资源的外部版本定义了资源的转换方法 (conversion.go )、资源的默认值 (defaults.go) 等。\n​\t以 Deployment 资源为例，它的内部版本定义在 pkg/apis/apps/目录下，其资源代码结构为\n1 2 3 4 5 6 7 8 9 10 11 12 . ├── OWNERS ├── doc.go ├── fuzzer ├── install ├── register.go ├── types.go ├── v1 ├── v1beta1 ├── v1beta2 ├── validation └── zz_generated.deepcopy.go doc.go: GoDoc 文件，定义了当前包的注释信息。在 Kubernetes 资源包中， 它还担当了代码生成器的全局 Tags 描述文件 register. go : 定义了资源组、资源版本及资源的注册信息 。 types.go: 定义了在当前资源组、资源版本下所支持的资源类型。 v1、v1betal 、v1beta2 : 定义了资源组下拥有的资源版本的资源 (即外部版本)。 install : 把当前资源组下的所有资源注册到资源注册表中。 validation: 定义了资源的验证方法。 zz_generated.deepcopy-go: 定义了资源的深复制操作，该文件由代码生成器自动生成 ​ 每一个 Kubernetes 资源目录，都通过 register.go 代码文件定义所属的资源组和资源版本，内部版本资源对象通过runtime.APIVersionInternal (即 _internal ) 标识 ，代码示例如下:\n1 2 3 4 5 // pkg/apis/apps/types.go type Deployment struct{ ... } type DeploymentSpec struct {...} ... ​\t以 Deployment 资源为例，它的外部版本定义在 pkg/apis/apps/{vl,v1betal, v1beta2 } 目录下，其资源代码结构如下:\n1 2 3 4 5 6 7 8 9 . ├── conversion.go ├── conversion_test.go ├── defaults.go ├── defaults_test.go ├── doc.go ├── register.go ├── zz_generated.conversion.go └── zz_generated.defaults.go conversion.go : 定义了资源的转换函数 (默认转换函数 )，并将默认转换函数注册到资源注册表中。 zz_generated.conversion.go: 定义了资源的转换西数(自动生成的转换函 数)，并将生成的转换两数注册到资源注册表中。该文件由代码生成器自 动生成。 defaults.go: 定义了资源的默认值函 数 ，并将默认值函数注册到资源注册表中 zz_generated.defaults.go: 定义了资源的默认值函数(自动生成的默认值函数 )，并将生成的默认值两数注册到资源注册表中。该文件由代码生成器自动生成 ​ 外部版本与内部版本资源类型相同，都通过 register.go代码文件定义所属的资源组和资源版本，外部版本资源对象通过资源版本( Alpha、Beta、Stable)标识，代码\n示例如下\n1 2 3 4 5 // GroupName is the group name use in this package const GroupName = \"apps\" // SchemeGroupVersion is group version used to register these objects var SchemeGroupVersion = schema.GroupVersion{Group: GroupName, Version: \"v1\"} 将资源注册到资源注册表中 ​\t在每一个Kubernetes资源组目录中，都拥有一个instal/install.go 代码文件，它负责将资源信息注册到资源注册表(Scheme)中。以 core 核心资源组为例，代码示例如下:\n1 2 3 4 5 6 7 8 9 10 11 12 // pkg/apis/core/install/install.go func init() { Install(legacyscheme.Scheme) } // Install registers the API group and adds types to a scheme func Install(scheme *runtime.Scheme) { utilruntime.Must(core.AddToScheme(scheme)) utilruntime.Must(v1.AddToScheme(scheme)) utilruntime.Must(scheme.SetVersionPriority(v1.SchemeGroupVersion)) } ​ legacyscheme.Scheme 是kube-apiserver 组件的全局资源注册表，Kubernetes 的所有资源信息都交给资源注册表统一管理。core. AddToScheme函数注册core资源组内部版本的资源。v1.AddToScheme 函数注册 core 资源组外部版本的资源。 scheme.SetVersionPriority两数注册资源组的版本顺序，如有多个资源版本，排在最前面的为资源首选版本。\n资源首选版本 ​ 首选版本( Preferred Version )，也称优选版本( Priority Version)，一个资源组下拥有多个资源版本，例如，apps资源组拥有v1、v1betal、v1beta2 等资源版本。当我们使用 apps 资源组下的Deployment 资源时，在一些场景下，如不指定资源版本，则使用该资源的首选版本。\n​\t以apps 资源组为例，注册资源时会注册多个资源版本，分别是v1、v1beta2、 v1betal ，代码示例如下：\n1 2 3 4 5 6 7 8 9 // pkg/apis/apps/install/install.go func Install(scheme *runtime.Scheme) { utilruntime.Must(apps.AddToScheme(scheme)) utilruntime.Must(v1beta1.AddToScheme(scheme)) utilruntime.Must(v1beta2.AddToScheme(scheme)) utilruntime.Must(v1.AddToScheme(scheme)) utilruntime.Must(scheme.SetVersionPriority(v1.SchemeGroupVersion, v1beta2.SchemeGroupVersion, v1beta1.SchemeGroupVersion)) } ​\tscheme.SetVersionPriority 注册版本顺序很重要，apps 资源组的注册版本顺序为 v1 、v1beta2 、v1betal ，那么在资源注册表的 version Priority 结构中 ，资源的首选版本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func (s *Scheme) SetVersionPriority(versions ...schema.GroupVersion) error { groups := sets.String{} order := []string{} for _, version := range versions { if len(version.Version) == 0 || version.Version == APIVersionInternal { return fmt.Errorf(\"internal versions cannot be prioritized: %v\", version) } groups.Insert(version.Group) order = append(order, version.Version) } if len(groups) != 1 { return fmt.Errorf(\"must register versions for exactly one group: %v\", strings.Join(groups.List(), \", \")) } s.versionPriority[groups.List()[0]] = order return nil } 资源操作方法 ​\t在 Kubernetes 系统中 ，针对每一个资源都有一定的操作方法 ( 即 Verbs )，例如 ，对于 Pod 资源对象，可以通过kubectl 命令行工具对其执行 create、delete、get 等操 作。Kubernetes 系统所支持的操作方法目前有8 种操作，分别是 create、delete、 deletecollection、get、list、patch、update、watch。这些操作方法可分为四大类，分别属于增、删、改、查，对资源进行创建、删除、更新和查询。资源操作方法如图\n​\t资源操作方法可以通过metav1.Verbs 数据结构进行描述，代码示例如下:\n1 2 3 4 5 type Verbs []string func (vs Verbs) String() string { return fmt.Sprintf(\"%v\", []string(vs)) } ​\t不同资源拥有不同的操作方法，例如，针对 Pod 资源对象与 pod logs 子资源对象，Pod 资源对象拥有create、delete、deletecollection、get、list、patch、update、watch 等操作方法，pod/logs 子资源对象只拥有get操作方法，因为日志只需要执行查看操作。Pod 资源对象与pod/ logs 子资源对象的操作方法分别通过 metav1. Verbs 进行描述。\n​\t资源对象的操作方法与存储 (Storage )相关联，增、删、改、查实际上都是针对存储的操作。如何解 一个资源对象拥有哪些可操作的方法呢 ?\n​\t需要查看与存储相关联的源码包 registry ，其定义在 vendor/k8s.io/apiserver/pkg/registry/ 目录下。 每种操作方法对应一个操作方法接又 (Interface)，资源对象操作方法接口说明：\n资源与命名空间 ​\tKubernetes 系统支持命名空间(Namespace)，其用来解決Kubernetes 集群中资源对象过多导致管理复杂的问题 。 每个命名空间相当于一个 “ 虚 拟 集 群 ” ，不同命名空间之间可以进行隔离，当然也可以通过某种方式跨命名空间通信。\n​\tKubernetes 系统中默认内置了4个命名空间 ，分别介绍如下。\ndefault: 所有未指定命名空间的资源对象都会被分配给该命名空间\nkube-system: 所有由 Kubernetes 系统创建的资源对象都会被分配给该命名空间\nkube-public: 此命名空间下的资源对象可以被所有人访问 (包括未认证用户)\nkube-node-lease: 此命名空间下存放来自节点的心跳记录(节点租约信息)\n通过运行 kubectl get namespace 命令查看 Kubernetes 系统上所有的命名空间信息 。另外，在Kubernetes 系统中，大部分资源对象都存在于某些命名空间中(例如Pod 资源对象)。但并不是所有的资源对象都存在于某个命名空间中(例如 Node 资源对象)。决定资源对象属于哪个命名空间，可通过资源对象的 ObjectMeta.Namespace描述\n自定义资源 ​\tKubenetes 系统拥有强大的高扩展功能 ，其中自定义资源 (CustomResource ) 就是一种常见的扩展方式，即可将自己定义的资源添加到 Kubemetes 系统中。Kubernetes 系统附带了许多内置资源，但是仍有些需求需要使用自定义资源来扩展 Kubernetes 的功能。\n​\t开发者通过 CRD 可以实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源一样使用 这些资源，例如，在 YAML/JSON 文件中带有 Spec 的资源定义都是对 Kubernetes 中的资源对象的定义，所有的自定义资源都可以与 Kubernetes 系统中的内置资源一样使用 kubectl 或 client- go 进行操作\n资源对象描述文件定义 ​\tKubernetes 资源可分为内置资源(Kubernetes Resources )和自定义资源(Custom Resources)，它们都通过资源对象描述文件(Manifest File)进行定义，资源对象描述文件如图\n​\t一个资源对象需要用5 个字段来描述它分别是Group/Version、KindMetaData、 Spec、Status。这些字段定义在YAML或JSON 文件中。Kubernetes系统中的所有的 资源对象都可以采用YAML或JSON格式的描述文件来定义，下面是某个Pod 文件的资源对象描述文件 。 YAML Manifest File Example 代码示例如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment spec: selector: matchLabels: app: nginx replicas: 2 # 告知 Deployment 运行 2 个与该模板匹配的 Pod template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - containerPort: 80 apiversion: 指定创建资源对象的资源组和资源版本， 其表现形式为 /， 若是core资源组 (即核心资源组 ) 下的资源对象 ，其表现形式为 kind: 指定创建资源对象的种类 metadata: 描述创建资源对象的元数据信息，例如名称、命名空间等 spee: 包含有关Deployment 资源对象的核心信息，告诉Kubernetes 期望的资源状态、副本数量、环境变量、 卷等信息 status: 包含有关正在运行的 Deployment 资源对象的信息 ​\t每一个Kubernetes 资源对象都包含两个嵌套字段，即 spec 字段和 status 字段。 其中spec 字段是必需的，它描述了资源对象的“期望状态”(DesiredState)，而status 字段用于描述资源对象的“ 实际状态” (Actual State) ，它是由Kubernetes 系统提供 和更新的。在任何时刻，Kubernetes控制器一直努力地管理着对象的实际状态以与期望状态相匹配。\n","wordCount":"9050","inLanguage":"en","datePublished":"2024-05-18T00:00:00Z","dateModified":"2024-05-18T00:00:00Z","author":{"@type":"Person","name":"Luenci"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841/"},"publisher":{"@type":"Organization","name":"Luenci","logo":{"@type":"ImageObject","url":"https://luenci.com/images/L.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luenci.com/en/ accesskey=h title="Luenci (Alt + H)"><img src=https://luenci.com/images/avatar.jpg alt aria-label=logo height=35>Luenci</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luenci.com/en/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://luenci.com/en/posts title=📚文章><span>📚文章</span></a></li><li><a href=https://luenci.com/en/search title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://luenci.com/en/archives title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://luenci.com/en/tags title=🔖标签><span>🔖标签</span></a></li><li><a href=https://luenci.com/en/about title=🙋🏻‍♂️关于><span>🙋🏻‍♂️关于</span></a></li><li><a href=https://luenci.com/en/links title=🤝友链><span>🤝友链</span></a></li><li><a href=https://luenci.com/en/index.xml title=📬RSS><span>📬RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luenci.com/en/>Home</a>&nbsp;»&nbsp;<a href=https://luenci.com/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">k8s核心数据结构（1）</h1><div class=post-meta><span title='2024-05-18 00:00:00 +0000 UTC'>2024-05-18</span>&nbsp;·&nbsp;19 min&nbsp;·&nbsp;9050 words&nbsp;·&nbsp;Luenci</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#kubernetes-%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%841 aria-label="Kubernetes 核心数据结构（1）">Kubernetes 核心数据结构（1）</a><ul><li><a href=#groupversionresource-%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84 aria-label="Group、Version、Resource 核心数据结构">Group、Version、Resource 核心数据结构</a><ul><li><a href=#resourcelist aria-label=ResourceList>ResourceList</a></li><li><a href=#group aria-label=Group>Group</a></li><li><a href=#version aria-label=Version>Version</a></li><li><a href=#resource aria-label=Resource>Resource</a><ul><li><a href=#%e8%b5%84%e6%ba%90%e5%a4%96%e9%83%a8%e7%89%88%e6%9c%ac%e4%b8%8e%e5%86%85%e9%83%a8%e7%89%88%e6%9c%ac aria-label=资源外部版本与内部版本>资源外部版本与内部版本</a></li><li><a href=#%e8%b5%84%e6%ba%90%e4%bb%a3%e7%a0%81%e5%ae%9a%e4%b9%89 aria-label=资源代码定义>资源代码定义</a></li><li><a href=#%e5%b0%86%e8%b5%84%e6%ba%90%e6%b3%a8%e5%86%8c%e5%88%b0%e8%b5%84%e6%ba%90%e6%b3%a8%e5%86%8c%e8%a1%a8%e4%b8%ad aria-label=将资源注册到资源注册表中>将资源注册到资源注册表中</a></li><li><a href=#%e8%b5%84%e6%ba%90%e9%a6%96%e9%80%89%e7%89%88%e6%9c%ac aria-label=资源首选版本>资源首选版本</a></li><li><a href=#%e8%b5%84%e6%ba%90%e6%93%8d%e4%bd%9c%e6%96%b9%e6%b3%95 aria-label=资源操作方法>资源操作方法</a></li><li><a href=#%e8%b5%84%e6%ba%90%e4%b8%8e%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4 aria-label=资源与命名空间>资源与命名空间</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90 aria-label=自定义资源>自定义资源</a></li><li><a href=#%e8%b5%84%e6%ba%90%e5%af%b9%e8%b1%a1%e6%8f%8f%e8%bf%b0%e6%96%87%e4%bb%b6%e5%ae%9a%e4%b9%89 aria-label=资源对象描述文件定义>资源对象描述文件定义</a></li></ul></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=kubernetes-核心数据结构1>Kubernetes 核心数据结构（1）<a hidden class=anchor aria-hidden=true href=#kubernetes-核心数据结构1>#</a></h1><blockquote><p>参考书籍：《Kubernetes源码剖析-郑旭东著》</p><p>K8s 是一个完全以资源为中心的系统</p></blockquote><h2 id=groupversionresource-核心数据结构>Group、Version、Resource 核心数据结构<a hidden class=anchor aria-hidden=true href=#groupversionresource-核心数据结构>#</a></h2><p>​ Kuberetes 系统虽然有相当复杂和众多的 功能，但它本质 上是一个资源控制系统——注册、管理、调度资源 并维护资源的状态。</p><p>​ Kuberetes 将资源再次分组和版本化，形成 Group（资源组）、Version（资源版本）、Resource（资源）</p><ul><li>Group: 被称为资源组，在Kubernetes API Server 中也可称其为 APIGroup。</li><li>Version: 被称为资源版本，在Kubernetes API Server 中也可称其为 APIVersions。</li><li>Resource: 被称为资源，在Kubernetes API Server 中也可称其为 APIResource。</li><li>Kind: 资源种类，描述 Resource 的种类，与 Resource 为同一级别。</li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230410172134645.png alt=image-20230410172134645></p><p>​</p><p>​ Kubernetes 系统支持多个Group，每个Group 支持多个Version，每个Version 支 持多个Resource，其中部分资源同时会拥有自己的子资源(即SubResource )。例如， Deployment资源拥有Status 子资源。
​ 资源组、资源版本、资源、子资源的完整表现形式<code>&lt;group>/&lt;version>/&lt;resource>/ &lt;subresource></code>。以常用的 Deployment 资源为例，其完整表现形式为<code>apps/v1/deployments/status</code></p><p>​ 另外资源对象(Resource Object )在本书中也是 一个常用概念，由“ 资源组+ 资源版本+资源种类” 组成，并在实例化后表达一个资源对象，例如 Deployment 资源实例化后拥有资源组、资源版本及资源种类，其表现形式为<code>&lt;group>/&lt;version>, Kind=&lt;kind></code>，例如<code>apps/v1, Kind=Deployment</code>.</p><p>​ 每一个资源都拥有一定数量的资源操作方法(即 Verbs )，资源操作方法用于 Etcd 集群存储中对资源对象的增、删、改、查操作。目前 Kubemetes 系统支持8 种资源操作方法，分别是 create、delete、delete、collection、get、list、patch、update、watch 操作方法。</p><p>​ 每一个资源都至少有两个版本，分别是外部版本(External Version)和内部版本 ( Internal Version )。外部版本用于对外暴露给用户请求的接又所使用的资源对象。内部版本不对外暴露，仅在Kubernetes API Server 内部使用。</p><p>​ Kubernetes 资源也可分为两种， 分别是Kubernetes Resource (Kubermetes 内罝资源 ) 和 Custom Resource( 自 定 义 资 源 )。 开 发 者 通 过 C R D ( 即 Custom Resource Definitions )可实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源 一样使用它们。</p><h3 id=resourcelist>ResourceList<a hidden class=anchor aria-hidden=true href=#resourcelist>#</a></h3><p>​ Kubernetes Group、 Version、Resource 等核心数据结构存放在<code>staging/src/k8s.io/apimachinery/pkg/apis/meta/v1</code> 目录中。它包含了Kubernetes
集群中所有组件使用的通 用核心数据结构，例如APIGroup、APIVersions、APIResource 等。其
中，我们可以 通过 APIResourceList 数据结构描述所有Group、Version、Resource 的结构。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>type</span> APIResourceList <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	TypeMeta <span style=color:#a5d6ff>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// groupVersion is the group and version this APIResourceList is for.</span>
</span></span><span style=display:flex><span>	GroupVersion <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;groupVersion&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// resources contains the name of the resources and if they are namespaced.</span>
</span></span><span style=display:flex><span>	APIResources []APIResource <span style=color:#a5d6ff>`json:&#34;resources&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> TypeMeta <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	Kind <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;kind,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	APIVersion <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;apiVersion,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> APIResource <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// name is the plural name of the resource.</span>
</span></span><span style=display:flex><span>	Name <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// singularName is the singular name of the resource.  This allows clients to handle plural and singular opaquely.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// The singularName is more correct for reporting status on a single item and both singular and plural are allowed</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// from the kubectl CLI interface.</span>
</span></span><span style=display:flex><span>	SingularName <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;singularName&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// namespaced indicates if a resource is namespaced or not.</span>
</span></span><span style=display:flex><span>	Namespaced <span style=color:#ff7b72>bool</span> <span style=color:#a5d6ff>`json:&#34;namespaced&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// group is the preferred group of the resource.  Empty implies the group of the containing resource list.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// For subresources, this may have a different value, for example: Scale&#34;.</span>
</span></span><span style=display:flex><span>	Group <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;group,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// version is the preferred version of the resource.  Empty implies the version of the containing resource list</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// For subresources, this may have a different value, for example: v1 (while inside a v1beta1 version of the core resource&#39;s group)&#34;.</span>
</span></span><span style=display:flex><span>	Version <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;version,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// kind is the kind for the resource (e.g. &#39;Foo&#39; is the kind for a resource &#39;foo&#39;)</span>
</span></span><span style=display:flex><span>	Kind <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;kind&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// verbs is a list of supported kube verbs (this includes get, list, watch, create,</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// update, patch, delete, deletecollection, and proxy)</span>
</span></span><span style=display:flex><span>	Verbs Verbs <span style=color:#a5d6ff>`json:&#34;verbs&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// shortNames is a list of suggested short names of the resource.</span>
</span></span><span style=display:flex><span>	ShortNames []<span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;shortNames,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// categories is a list of the grouped resources this resource belongs to (e.g. &#39;all&#39;)</span>
</span></span><span style=display:flex><span>	Categories []<span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;categories,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	StorageVersionHash <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;storageVersionHash,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ Kubernetes的每个资源可使用<code>metav1.APIResource</code> 结构进行描述，它描述资源的基本信息，例如资源名称 (即 Name 字段)、资源所属的命名空间(即 Namespaced 字段)、资源种类(即 Kind 字段)、资源可操作的方法列表(即 Verbs 字段)。</p><p>​ 每一个资源都属于一个或多个资源版本， 资源所属的版本通过 <code>metavl.APIVersions</code> 结构描述，一个或多个资源版本通过<code>Versions []string</code> 字符串数组进行存储。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411111820480.png alt=image-20230411111820480></p><h3 id=group>Group<a hidden class=anchor aria-hidden=true href=#group>#</a></h3><p>​ Group ( 资源组)，在Kubernetes API Server 中也可称其为 APIGroup。Kubernetes 系统中定义了许多资源组，这些资源组按照不同功能将资源进行了划分，资源组特点如下。</p><ul><li>将众多资源按照功能划分成不同的资源组，并允许单独启用/ 禁用资源组。 当然也可以单独启用/禁用资源组中的资源。</li><li>支持不同资源组中拥有不同的资源版本。这方便组内的资源根据版本进行迭代升级。</li><li>支持同名的资源种类 (即 Kind ) 存在于不同的资源组内 。</li><li>资源组与资源版本通过 Kubernetes API Server 对外暴露，允许开发者通过 HTTP 协议进行交互并通过动态客户端( 即 DynamicClient )进行资源发现。</li><li>支持CRD 自定 义资源扩展。</li><li>用户交互简单，例如在使用kubectl 命令行工具时，可以不填写资源组名称</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>type</span> APIGroup <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	TypeMeta <span style=color:#a5d6ff>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// name is the name of the group.</span>
</span></span><span style=display:flex><span>	Name <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源组下所支持的资源版本.</span>
</span></span><span style=display:flex><span>	Versions []GroupVersionForDiscovery <span style=color:#a5d6ff>`json:&#34;versions&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 首选版本。 当一个资源组内存在多个资源版本时， Kubernetes API Server 在使用资源时会选择一 个首选版本作为当前版本</span>
</span></span><span style=display:flex><span>	PreferredVersion GroupVersionForDiscovery <span style=color:#a5d6ff>`json:&#34;preferredVersion,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// a map of client CIDR to server address that is serving this group.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// This is to help clients reach servers in the most network-efficient way possible.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Clients can use the app ropriate server address as per the CIDR that they match.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// In case of multiple matches, clients should use the longest matching CIDR.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// The server returns only those CIDRs that it thinks that the client can match.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// For example: the master will return an internal IP CIDR only, if the client reaches the server using an internal IP.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Server looks at X-Forwarded-For header or X-Real-Ip header or request.RemoteAddr (in that order) to get the client IP.</span>
</span></span><span style=display:flex><span>	ServerAddressByClientCIDRs []ServerAddressByClientCIDR <span style=color:#a5d6ff>`json:&#34;serverAddressByClientCIDRs,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ 在当前的Kubernetes 系统中，支持两类资源组，分别是拥有组名的资源组和没有组名的资源组。</p><ul><li><p><strong>拥有组名的资源组</strong>: 其表现形式为<code>&lt;group>/&lt;version>/&lt;resource></code>，例如 <code>apps/v1/deployments</code></p></li><li><p><strong>没有组名的资源组</strong>: 被称为 Core Groups ( 即核心资源组)或 Legacy Groups , 也可被称为 Group Less ( 即无组 )。 其表现形式为<code> /&lt;version>/&lt;resource></code> ， 例 如 <code>/v1/pods</code></p><p>两类资源组表现形式不同， 形成的 HTTP PATH 路径也不同。 拥有组名的资源组的 HTTP PATH 以<code>/apis</code> 为前缀，其表现形式为<code>/apis/&lt;group>/&lt;version>/&lt;resource></code>，例如 <code>http://localhost:8080/apis/apps/v1/deployments</code>。没有组名的资源组的 HTTP PATH 以 <code>api</code> 为前缀，其表现形式为<code>/api/&lt;version>/&lt;resource></code>，例如 <code>http://localhost:8080/api/vl/pods</code>.</p></li></ul><h3 id=version>Version<a hidden class=anchor aria-hidden=true href=#version>#</a></h3><p>​ Kubernetes 的资源版本控制可分为了种，分别是 Alpha、Beta、Stable，它们之间的迭代顺序为<code>Alpha -> Beta -> Stable</code>，其通常用来表示软件测试过程中的 了个阶段。 Alpha是第1个阶段，一般用于内部测试; Beta 是第2 个阶段，该版本已经修复了大 部分不完善之处，但仍有可能存在缺陷和漏洞， 一般由特定的用户群来进行测试; Stable 是第了个阶段，此时基本形成了产品并达到了一定的成熟度，可稳定运行。 Kubernetes 资源版本控制详情如下:</p><ul><li>Alpha 版本</li></ul><p>​ Alpha 版本为内部测试版本，用于Kubernetes 开发者内部测试，该版本是不稳定的，可能存在很多缺陷和漏洞，官方随时可能会放弃支持该版本。在默认的情况下， 处于Alpha 版本的功能会被禁用。Alpha 版本名称一般为 vlalphal、vlalpha2、v2alphal 等。</p><ul><li>Beta 版本</li></ul><p>​ Beta 版本为相对稳定的版本， Beta 版本经过官方和社区很多次测试 ， 当功能迭代时，该版本会有较小的改变，但不会被删除。在默认的情况下，处于Beta 版本的功能是开启状态的。Beta 版本命名一般为 v1betal、v1beta2、v2betal。</p><ul><li>Stable 版本</li></ul><p>​ Stable 版本为正式发布的版本, Stable 版本基本形成了产品 ，该版本不会被删除。 在默认的情况下 ，处于 stable 版本的功能全部处于开启状态 。Stable 版本命名一般为 v1、v2、 v3。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>type</span> APIVersions <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	TypeMeta <span style=color:#a5d6ff>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 所支持的资源版本列表.</span>
</span></span><span style=display:flex><span>	Versions []<span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;versions&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// a map of client CIDR to server address that is serving this group.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// This is to help clients reach servers in the most network-efficient way possible.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Clients can use the appropriate server address as per the CIDR that they match.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// In case of multiple matches, clients should use the longest matching CIDR.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// The server returns only those CIDRs that it thinks that the client can match.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// For example: the master will return an internal IP CIDR only, if the client reaches the server using an internal IP.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Server looks at X-Forwarded-For header or X-Real-Ip header or request.RemoteAddr (in that order) to get the client IP.</span>
</span></span><span style=display:flex><span>	ServerAddressByClientCIDRs []ServerAddressByClientCIDR <span style=color:#a5d6ff>`json:&#34;serverAddressByClientCIDRs&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p>CIDR（Classless Inter-Domain Routing）是一个用于给用户分配<a href=https://zh.wikipedia.org/wiki/IP%E5%9C%B0%E5%9D%80>IP地址</a>以及在<a href=https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91>互联网</a>上有效地路由IP<a href=https://zh.wikipedia.org/wiki/%E6%95%B0%E6%8D%AE%E5%8C%85>数据包</a>的对IP地址进行归类的方法。与传统的A类、B类和C类寻址模式相比，CIDR在IP地址分配方面更为高效。CIDR采用斜线记法，表示为：IP地址/网络ID的位数。</p><ul><li><p>示例一：CIDR格式换算为IP地址网段</p><p>例如10.0.0.0/8，换算为32位二进制地址：00001010.00000000.00000000.00000000。其中/8表示8位网络ID，即32位二进制地址中前8位是固定不变的，对应网段为：00001010.00000000.00000000.00000000<del>00001010.11111111.11111111.11111111。则换算为十进制后，10.0.0.0/8表示：子网掩码为255.0.0.0，对应网段为10.0.0.0</del>10.255.255.255。</p></li><li><p>示例二：IP地址网段换算为CIDR格式</p><p>例如192.168.0.0<del>192.168.31.255，后两段IP换算为二进制地址：00000000.00000000</del>00011111.11111111，可以得出前19位（8*2+3）是固定不变的，则换算为CIDR格式后，表示为：192.168.0.0/19</p></li></ul></blockquote><h3 id=resource>Resource<a hidden class=anchor aria-hidden=true href=#resource>#</a></h3><p>​ 一 个资源被实例化后会表达为一 个资源对象(即Resource Object )。在 Kuberetes 系统中定义并运行着各式各样的资源对象，Kubernetes 资源对象如图所示。所有资源对象都是 Entity 。 Entity 翻译成中 文为 “ 实 体” ，Kubernetes 使用这些 Entity 来表示当前状态。可以通过 Kubernetes API Server 进行查询和更新每一个资源对象。 Kubernetes 目前支持两种 Entity，分别介绍如下</p><ul><li><p><strong>持久性实体(Persistent Entity)</strong>: 在资源对象被创建后，Kubernetes 会持久确保该资源对象存在。大部分资源对象属于持久性实体，例如 Deployment 资源对象</p></li><li><p><strong>短暂性实体(Ephemeral Entity</strong>): 也可称其为非持久性实体(Non-Persistent Entity ) 。 在资源对象被创建后，如果出现故障或调度失败 ，不会重新创建该资源对象，例如 Pod 资源对象</p></li><li><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411115903185.png alt=image-20230411115903185></p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>type</span> APIResource <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// name is the plural name of the resource.</span>
</span></span><span style=display:flex><span>	Name <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;name&#34; protobuf:&#34;bytes,1,opt,name=name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源的单数名称，它必须由小写字母组成，默认使用资源种类(Kind)的小写形式进行命名。例如，Pod 资源的单数名称为pod, 复数名称为pods</span>
</span></span><span style=display:flex><span>	SingularName <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;singularName&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源是否拥有所属命名空间</span>
</span></span><span style=display:flex><span>  Namespaced <span style=color:#ff7b72>bool</span> <span style=color:#a5d6ff>`json:&#34;namespaced&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源所在的资源组名称</span>
</span></span><span style=display:flex><span>	Group <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;group,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源所在的资源版本</span>
</span></span><span style=display:flex><span>	Version <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;version,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源种类</span>
</span></span><span style=display:flex><span>  Kind <span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;kind&#34; `</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源可操作的方法列表，例如get 、list、delete、create、update 等</span>
</span></span><span style=display:flex><span>  Verbs Verbs <span style=color:#a5d6ff>`json:&#34;verbs&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// 资源的简称，例如 Pod 资源的简称为 po</span>
</span></span><span style=display:flex><span>  ShortNames []<span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;shortNames,omitempty&#34;`</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 该资源所属的分组资源列表（例如“全部”)</span>
</span></span><span style=display:flex><span>	Categories []<span style=color:#ff7b72>string</span> <span style=color:#a5d6ff>`json:&#34;categories,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#ff7b72;font-weight:700>...</span>	
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=资源外部版本与内部版本>资源外部版本与内部版本<a hidden class=anchor aria-hidden=true href=#资源外部版本与内部版本>#</a></h4><p>​ Kubernetes 资源代码定义在 <code>pkg/apis</code> 目录下， 在详解资源代码定义之前， 先来了解一下资源的外部版本(ExternalVersion )与内部版本(Internal Version )。在 Kubernetes 系统中，同 一资源对应着两个版本，分别是外部版本和内部版本。例如，Deployment 资源，它所属的外部版本表现形式为<code>apps/ v1</code>，内部版本表现形式为<code>apps/_internal</code>'</p><ul><li><p>ExternalObject: 外部版本资源对象，也称为 Versioned Object ( 即拥有资源版本的资源对象)。外部版本用于对外暴露给用户请求的接又所使用的资源对象，例如，用户在通过 YAML 或 JSON 格式的描述文件创建资源对象时，所使用的是外部版本的资源对象。外部版本的资源对象通过资源版本( Alpha 、Beta 、Stable )进行标识</p></li><li><p>Internal Object: 内部版本资源对象。内部版本不对外暴露，仅在 Kubernetes API Server 内部使用。内部版本用于多资源版本的转换，例如将 v1betal 版本转换为 v1 版本，其过程为 <code>v1betal--internal - v1</code>，即先将 v1betal 转换为内部版本(internal )，再由内部版本(internal)转换为V1版本。内部版本资源对象通过 <code>runtime. APIVersionlnternal</code> (即 internal )进行标识。</p><p>资源的外部版本代码定义在 <code>pkg/apis/&lt;group>/&lt;version>/</code>目录下，资源的内部版本代码定义在 <code>pkg/apis/&lt;group>/</code>日 录 下。 例 如 ， Deployment 资源 ，它的外部版本定义在
<code>pkg/apis/apps/{v1,V1betal, v1beta2}/</code> 目录下， 它的内部版本定义在<code>pkg/apis/apps/</code>目录下(内部版本一般与资源组在同一级目录下)。资源的外部版本与内部版本如图所示。</p></li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411141133099.png alt=image-20230411141133099></p><p><strong>资源的外部版本和内部版本是需要相互转换的</strong>，而用于转换的函数需要事先初始化到资源注册表 (Scheme) 中 。 多个外部版本 ( External Version ) 之间的资源进行相互转换，都需要通过内部版本 (Internal Version )进行中转。这也是Kubernetes 能实现多资源版本转换的关键.</p><p>​ 资源的外部版本与内部版本的代码定义也不太一样，外部版本的资源需要对外暴露给用户请求的接又，所以资源代码定义了 <code>JSONTags </code>和 <code>Proto Tags</code>，用于请求的序列化和反序列化操作。内部版本的资源不对外暴露，所以没有任何的 JSON Tags 和ProtoTags定义。以Pod 资源代码定义为例，代码示例如下</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span> <span style=color:#8b949e;font-style:italic>// staging/src/k8s.io/api/core/v1/types.go 外部使用</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Pod <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	metav1.TypeMeta <span style=color:#a5d6ff>`json:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Standard object&#39;s metadata.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	metav1.ObjectMeta <span style=color:#a5d6ff>`json:&#34;metadata,omitempty&#34; protobuf:&#34;bytes,1,opt,name=metadata&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Specification of the desired behavior of the pod.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	Spec PodSpec <span style=color:#a5d6ff>`json:&#34;spec,omitempty&#34; protobuf:&#34;bytes,2,opt,name=spec&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Most recently observed status of the pod.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// This data may not be up to date.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Populated by the system.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Read-only.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	Status PodStatus <span style=color:#a5d6ff>`json:&#34;status,omitempty&#34; protobuf:&#34;bytes,3,opt,name=status&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// pkg/apis/core/types.go  内部使用</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Pod <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>	metav1.TypeMeta
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	metav1.ObjectMeta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Spec defines the behavior of a pod.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	Spec PodSpec
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// Status represents the current information about a pod. This data may not be up</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// to date.</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic>// +optional</span>
</span></span><span style=display:flex><span>	Status PodStatus
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=资源代码定义>资源代码定义<a hidden class=anchor aria-hidden=true href=#资源代码定义>#</a></h4><p>​ Kubernetes资源代码定义在<code>pkg/apis</code>目录下，<strong>同一资源对应着内部版本和外部版本，内部版本和外部版本的资源代码结构并不相同</strong>。</p><p>​ 资源的内部版本定义了所支持的资源类型 ( types.go)、资源验证方法( validation.go )、资源注册至资源注册表的方法 ( install/install.go) 等 。 而资源的外部版本定义了资源的转换方法 (conversion.go )、资源的默认值 (defaults.go) 等。</p><p>​ 以 Deployment 资源为例，它的内部版本定义在 <code>pkg/apis/apps/</code>目录下，其资源代码结构为</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── OWNERS
</span></span><span style=display:flex><span>├── doc.go 
</span></span><span style=display:flex><span>├── fuzzer
</span></span><span style=display:flex><span>├── install
</span></span><span style=display:flex><span>├── register.go
</span></span><span style=display:flex><span>├── types.go
</span></span><span style=display:flex><span>├── v1
</span></span><span style=display:flex><span>├── v1beta1
</span></span><span style=display:flex><span>├── v1beta2
</span></span><span style=display:flex><span>├── validation
</span></span><span style=display:flex><span>└── zz_generated.deepcopy.go
</span></span></code></pre></td></tr></table></div></div><ul><li>doc.go: GoDoc 文件，定义了当前包的注释信息。在 Kubernetes 资源包中， 它还担当了代码生成器的全局 Tags 描述文件</li><li>register. go : 定义了资源组、资源版本及资源的注册信息 。</li><li>types.go: 定义了在当前资源组、资源版本下所支持的资源类型。</li><li>v1、v1betal 、v1beta2 : 定义了资源组下拥有的资源版本的资源 (即外部版本)。</li><li>install : 把当前资源组下的所有资源注册到资源注册表中。</li><li>validation: 定义了资源的验证方法。</li><li>zz_generated.deepcopy-go: 定义了资源的深复制操作，该文件由代码生成器自动生成</li></ul><p>​ 每一个 Kubernetes 资源目录，都通过 register.go 代码文件定义所属的资源组和资源版本，内部版本资源对象通过<code>runtime.APIVersionInternal</code> (即 _internal ) 标识 ，代码示例如下:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// pkg/apis/apps/types.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Deployment <span style=color:#ff7b72>struct</span>{ <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> DeploymentSpec <span style=color:#ff7b72>struct</span> {<span style=color:#ff7b72;font-weight:700>...</span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>...</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 以 Deployment 资源为例，它的外部版本定义在 <code>pkg/apis/apps/{vl,v1betal, v1beta2 } </code>目录下，其资源代码结构如下:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── conversion.go
</span></span><span style=display:flex><span>├── conversion_test.go
</span></span><span style=display:flex><span>├── defaults.go
</span></span><span style=display:flex><span>├── defaults_test.go
</span></span><span style=display:flex><span>├── doc.go
</span></span><span style=display:flex><span>├── register.go
</span></span><span style=display:flex><span>├── zz_generated.conversion.go
</span></span><span style=display:flex><span>└── zz_generated.defaults.go
</span></span></code></pre></td></tr></table></div></div><ul><li><code>conversion.go</code> : 定义了资源的转换函数 (默认转换函数 )，并将默认转换函数注册到资源注册表中。</li><li><code>zz_generated.conversion.go</code>: 定义了资源的转换西数(自动生成的转换函 数)，并将生成的转换两数注册到资源注册表中。该文件由代码生成器自 动生成。</li><li><code>defaults.go</code>: 定义了资源的默认值函 数 ，并将默认值函数注册到资源注册表中</li><li><code>zz_generated.defaults.go</code>: 定义了资源的默认值函数(自动生成的默认值函数 )，并将生成的默认值两数注册到资源注册表中。该文件由代码生成器自动生成</li></ul><p>​ 外部版本与内部版本资源类型相同，都通过 <code>register.go</code>代码文件定义所属的资源组和资源版本，外部版本资源对象通过资源版本( Alpha、Beta、Stable)标识，代码</p><p>示例如下</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// GroupName is the group name use in this package</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> GroupName = <span style=color:#a5d6ff>&#34;apps&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// SchemeGroupVersion is group version used to register these objects</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> SchemeGroupVersion = schema.GroupVersion{Group: GroupName, Version: <span style=color:#a5d6ff>&#34;v1&#34;</span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=将资源注册到资源注册表中>将资源注册到资源注册表中<a hidden class=anchor aria-hidden=true href=#将资源注册到资源注册表中>#</a></h4><p>​ 在每一个Kubernetes资源组目录中，都拥有一个<code>instal/install.go</code> 代码文件，它负责将资源信息注册到资源注册表(Scheme)中。以 core 核心资源组为例，代码示例如下:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// pkg/apis/core/install/install.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#d2a8ff;font-weight:700>Install</span>(legacyscheme.Scheme)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Install registers the API group and adds types to a scheme</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Install</span>(scheme <span style=color:#ff7b72;font-weight:700>*</span>runtime.Scheme) {
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(core.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(v1.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(scheme.<span style=color:#d2a8ff;font-weight:700>SetVersionPriority</span>(v1.SchemeGroupVersion))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ <code>legacyscheme.Scheme</code> 是<code>kube-apiserver</code> 组件的全局资源注册表，Kubernetes 的所有资源信息都交给资源注册表统一管理。<code>core. AddToScheme</code>函数注册<code>core</code>资源组内部版本的资源。<code>v1.AddToScheme</code> 函数注册 <code>core</code> 资源组外部版本的资源。 <code>scheme.SetVersionPriority</code>两数注册资源组的版本顺序，如有多个资源版本，排在最前面的为资源首选版本。</p><h4 id=资源首选版本>资源首选版本<a hidden class=anchor aria-hidden=true href=#资源首选版本>#</a></h4><p>​ 首选版本( Preferred Version )，也称优选版本( Priority Version)，一个资源组下拥有多个资源版本，例如，apps资源组拥有v1、v1betal、v1beta2 等资源版本。当我们使用 apps 资源组下的Deployment 资源时，在一些场景下，如不指定资源版本，则使用该资源的首选版本。</p><p>​ 以apps 资源组为例，注册资源时会注册多个资源版本，分别是v1、v1beta2、 v1betal ，代码示例如下：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// pkg/apis/apps/install/install.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Install</span>(scheme <span style=color:#ff7b72;font-weight:700>*</span>runtime.Scheme) {
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(apps.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(v1beta1.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(v1beta2.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(v1.<span style=color:#d2a8ff;font-weight:700>AddToScheme</span>(scheme))
</span></span><span style=display:flex><span>	utilruntime.<span style=color:#d2a8ff;font-weight:700>Must</span>(scheme.<span style=color:#d2a8ff;font-weight:700>SetVersionPriority</span>(v1.SchemeGroupVersion, v1beta2.SchemeGroupVersion, v1beta1.SchemeGroupVersion))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ <code>scheme.SetVersionPriority</code> 注册版本顺序很重要，apps 资源组的注册版本顺序为 v1 、v1beta2 、v1betal ，那么在资源注册表的 <code>version Priority</code> 结构中 ，资源的首选版本</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>func</span> (s <span style=color:#ff7b72;font-weight:700>*</span>Scheme) <span style=color:#d2a8ff;font-weight:700>SetVersionPriority</span>(versions <span style=color:#ff7b72;font-weight:700>...</span>schema.GroupVersion) <span style=color:#ff7b72>error</span> {
</span></span><span style=display:flex><span>	groups <span style=color:#ff7b72;font-weight:700>:=</span> sets.String{}
</span></span><span style=display:flex><span>	order <span style=color:#ff7b72;font-weight:700>:=</span> []<span style=color:#ff7b72>string</span>{}
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>for</span> _, version <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#ff7b72>range</span> versions {
</span></span><span style=display:flex><span>		<span style=color:#ff7b72>if</span> len(version.Version) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>||</span> version.Version <span style=color:#ff7b72;font-weight:700>==</span> APIVersionInternal {
</span></span><span style=display:flex><span>			<span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;internal versions cannot be prioritized: %v&#34;</span>, version)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		groups.<span style=color:#d2a8ff;font-weight:700>Insert</span>(version.Group)
</span></span><span style=display:flex><span>		order = append(order, version.Version)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>if</span> len(groups) <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#a5d6ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;must register versions for exactly one group: %v&#34;</span>, strings.<span style=color:#d2a8ff;font-weight:700>Join</span>(groups.<span style=color:#d2a8ff;font-weight:700>List</span>(), <span style=color:#a5d6ff>&#34;, &#34;</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	s.versionPriority[groups.<span style=color:#d2a8ff;font-weight:700>List</span>()[<span style=color:#a5d6ff>0</span>]] = order
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>return</span> <span style=color:#79c0ff>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h4 id=资源操作方法>资源操作方法<a hidden class=anchor aria-hidden=true href=#资源操作方法>#</a></h4><p>​ 在 Kubernetes 系统中 ，针对每一个资源都有一定的操作方法 ( 即 Verbs )，例如 ，对于 Pod 资源对象，可以通过kubectl 命令行工具对其执行 create、delete、get 等操 作。Kubernetes 系统所支持的操作方法目前有8 种操作，分别是 create、delete、 deletecollection、get、list、patch、update、watch。这些操作方法可分为四大类，分别属于增、删、改、查，对资源进行创建、删除、更新和查询。资源操作方法如图</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411161222986.png alt=image-20230411161222986></p><p>​ 资源操作方法可以通过<code>metav1.Verbs</code> 数据结构进行描述，代码示例如下:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>type</span> Verbs []<span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (vs Verbs) <span style=color:#d2a8ff;font-weight:700>String</span>() <span style=color:#ff7b72>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Sprintf</span>(<span style=color:#a5d6ff>&#34;%v&#34;</span>, []string(vs))
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ 不同资源拥有不同的操作方法，例如，针对 Pod 资源对象与 pod logs 子资源对象，Pod 资源对象拥有create、delete、deletecollection、get、list、patch、update、watch 等操作方法，pod/logs 子资源对象只拥有get操作方法，因为日志只需要执行查看操作。Pod 资源对象与pod/ logs 子资源对象的操作方法分别通过 metav1. Verbs 进行描述。</p><p>​ 资源对象的操作方法与存储 (Storage )相关联，增、删、改、查实际上都是针对存储的操作。如何解 一个资源对象拥有哪些可操作的方法呢 ?</p><p>​ 需要查看与存储相关联的源码包 <code>registry</code> ，其定义在 <code>vendor/k8s.io/apiserver/pkg/registry/ </code>目录下。 每种操作方法对应一个操作方法接又 (Interface)，资源对象操作方法接口说明：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411162803191.png alt=image-20230411162803191></p><h4 id=资源与命名空间>资源与命名空间<a hidden class=anchor aria-hidden=true href=#资源与命名空间>#</a></h4><p>​ Kubernetes 系统支持命名空间(Namespace)，其用来解決Kubernetes 集群中资源对象过多导致管理复杂的问题 。 每个命名空间相当于一个 “ 虚 拟 集 群 ” ，不同命名空间之间可以进行隔离，当然也可以通过某种方式跨命名空间通信。</p><p>​ Kubernetes 系统中默认内置了4个命名空间 ，分别介绍如下。</p><ul><li><p>default: 所有未指定命名空间的资源对象都会被分配给该命名空间</p></li><li><p>kube-system: 所有由 Kubernetes 系统创建的资源对象都会被分配给该命名空间</p></li><li><p>kube-public: 此命名空间下的资源对象可以被所有人访问 (包括未认证用户)</p></li><li><p>kube-node-lease: 此命名空间下存放来自节点的心跳记录(节点租约信息)</p><p>通过运行 <code>kubectl get namespace</code> 命令查看 <code>Kubernetes</code> 系统上所有的命名空间信息 。另外，在Kubernetes 系统中，大部分资源对象都存在于某些命名空间中(例如Pod 资源对象)。但并不是所有的资源对象都存在于某个命名空间中(例如 Node 资源对象)。决定资源对象属于哪个命名空间，可通过资源对象的 <code>ObjectMeta.Namespace</code>描述</p></li></ul><h4 id=自定义资源>自定义资源<a hidden class=anchor aria-hidden=true href=#自定义资源>#</a></h4><p>​ Kubenetes 系统拥有强大的高扩展功能 ，其中自定义资源 (CustomResource ) 就是一种常见的扩展方式，即可将自己定义的资源添加到 Kubemetes 系统中。Kubernetes 系统附带了许多内置资源，但是仍有些需求需要使用自定义资源来扩展 Kubernetes 的功能。</p><p>​ 开发者通过 CRD 可以实现自定义资源，它允许用户将自己定义的资源添加到 Kubernetes 系统中，并像使用 Kubernetes 内置资源一样使用 这些资源，例如，在 YAML/JSON 文件中带有 Spec 的资源定义都是对 Kubernetes 中的资源对象的定义，所有的自定义资源都可以与 Kubernetes 系统中的内置资源一样使用 kubectl 或 client- go 进行操作</p><h4 id=资源对象描述文件定义>资源对象描述文件定义<a hidden class=anchor aria-hidden=true href=#资源对象描述文件定义>#</a></h4><p>​ Kubernetes 资源可分为内置资源(Kubernetes Resources )和自定义资源(Custom Resources)，它们都通过资源对象描述文件(Manifest File)进行定义，资源对象描述文件如图</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/Lucareful/RepoImg/img/image-20230411171215994.png alt=image-20230411171215994></p><p>​ 一个资源对象需要用5 个字段来描述它分别是Group/Version、KindMetaData、 Spec、Status。这些字段定义在YAML或JSON 文件中。Kubernetes系统中的所有的 资源对象都可以采用YAML或JSON格式的描述文件来定义，下面是某个Pod 文件的资源对象描述文件 。 YAML Manifest File Example 代码示例如下：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>apps/v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx-deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>selector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>matchLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>replicas</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>2</span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic># 告知 Deployment 运行 2 个与该模板匹配的 Pod</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>template</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>containers</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>image</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>nginx:1.14.2</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>ports</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>- <span style=color:#7ee787>containerPort</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>80</span><span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>apiversion: 指定创建资源对象的资源组和资源版本， 其表现形式为 <code>&lt;group>/&lt;version></code>， 若是<code>core</code>资源组 (即核心资源组 ) 下的资源对象 ，其表现形式为<code>&lt;version></code></li><li>kind: 指定创建资源对象的种类</li><li>metadata: 描述创建资源对象的元数据信息，例如名称、命名空间等</li><li>spee: 包含有关Deployment 资源对象的核心信息，告诉Kubernetes 期望的资源状态、副本数量、环境变量、 卷等信息</li><li>status: 包含有关正在运行的 Deployment 资源对象的信息</li></ul><p>​ 每一个Kubernetes 资源对象都包含两个嵌套字段，即 spec 字段和 status 字段。 其中spec 字段是必需的，它描述了资源对象的“期望状态”(DesiredState)，而status 字段用于描述资源对象的“ 实际状态” (Actual State) ，它是由Kubernetes 系统提供 和更新的。在任何时刻，Kubernetes控制器一直努力地管理着对象的实际状态以与期望状态相匹配。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://luenci.com/en/tags/k8s/>K8s</a></li></ul><nav class=paginav><a class=prev href=https://luenci.com/en/posts/k8s%E6%A0%B8%E5%BF%83%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842/><span class=title>« Prev</span><br><span>k8s核心数据结构（2）</span>
</a><a class=next href=https://luenci.com/en/posts/k8s%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/><span class=title>Next »</span><br><span>k8s架构介绍</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on x" href="https://x.com/intent/tweet/?text=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f&amp;hashtags=k8s"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f&amp;title=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89&amp;summary=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89&amp;source=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f&title=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on whatsapp" href="https://api.whatsapp.com/send?text=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89%20-%20https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on telegram" href="https://telegram.me/share/url?text=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share k8s核心数据结构（1） on ycombinator" href="https://news.ycombinator.com/submitlink?t=k8s%e6%a0%b8%e5%bf%83%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%ef%bc%881%ef%bc%89&u=https%3a%2f%2fluenci.com%2fen%2fposts%2fk8s%25E6%25A0%25B8%25E5%25BF%2583%25E6%2595%25B0%25E6%258D%25AE%25E7%25BB%2593%25E6%259E%25841%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=Lucareful/Lucareful.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxOTMzMDM3NDA=" data-category=Q&A data-category-id=DIC_kwDOC4WUvM4ChdIQ data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script><script type=text/javascript>jinrishici.load(function(e){var t=document.querySelector(".poem_sentence"),n=document.querySelector(".poem_info");t.innerHTML=e.data.content,n.innerHTML="—— "+e.data.origin.author})</script><span><a id=running-time></a><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>👁️‍🗨️访客人数: <span id=busuanzi_value_site_uv></span>|
🌐访问量: <span id=busuanzi_value_site_pv></span></span></span><br><span>&copy; 2025 <a href=https://luenci.com/en/>Luenci</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a> 📖
<text class=poem_sentence></text><text class=poem_info></text></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});const RunningTimerInterval=1e3,StartTime=new Date("10/11/2018 00:00:00");function prefixZero(e){return e<10&&(e="0"+e),e}function updateTime(){const r=new Date;let e=r.getTime()-StartTime.getTime();const t=24*60*60*1e3,n=Math.floor(e/t);e-=n*t;const s=60*60*1e3,o=Math.floor(e/s);e-=o*s;const i=60*1e3,a=Math.floor(e/i);e-=a*i;const c=Math.floor(e/1e3),l=document.getElementById("running-time");l.innerText="🕚: "+n+"天"+prefixZero(o)+"小时"+prefixZero(a)+"分"+prefixZero(c)+"秒"}document.addEventListener("DOMContentLoaded",()=>{let e=setInterval(updateTime,RunningTimerInterval)})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>