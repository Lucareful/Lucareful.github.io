<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Luenci</title>
<meta name=keywords content><meta name=description content="ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚ ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤ åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQue"><meta name=author content="Luenci"><link rel=canonical href=https://luenci.me/en/posts/django%E7%9A%84queryset%E8%AF%A6%E8%A7%A3/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://luenci.me/images/L.png><link rel=icon type=image/png sizes=16x16 href=https://luenci.me/images/L.png><link rel=icon type=image/png sizes=32x32 href=https://luenci.me/images/L.png><link rel=apple-touch-icon href=https://luenci.me/L.png><link rel=mask-icon href=https://luenci.me/L.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://luenci.me/en/posts/django%E7%9A%84queryset%E8%AF%A6%E8%A7%A3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content><meta property="og:description" content="ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚ ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤ åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQue"><meta property="og:type" content="article"><meta property="og:url" content="https://luenci.me/en/posts/django%E7%9A%84queryset%E8%AF%A6%E8%A7%A3/"><meta property="article:section" content="posts"><meta property="og:site_name" content="(ã€ƒ'â–½'ã€ƒ)"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚ ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤ åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQue"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://luenci.me/en/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://luenci.me/en/posts/django%E7%9A%84queryset%E8%AF%A6%E8%A7%A3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚ ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤ åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQue","keywords":[],"articleBody":"ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚\nä¸€ã€QuerySetä½•æ—¶è¢«æäº¤ åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQuerySetä¸ä¼šçœŸå®æ“ä½œæ•°æ®åº“ï¼Œåœ¨ä½ å¯¹æŸ¥è¯¢é›†æäº¤ä¹‹å‰ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å®é™…çš„æ•°æ®åº“æ“ä½œã€‚å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•å¯¹QuerySetæäº¤æŸ¥è¯¢æ“ä½œï¼š è¿­ä»£ QuerySetæ˜¯å¯è¿­ä»£çš„ï¼Œåœ¨é¦–æ¬¡è¿­ä»£æŸ¥è¯¢é›†æ—¶æ‰§è¡Œå®é™…çš„æ•°æ®åº“æŸ¥è¯¢ã€‚ ä¾‹å¦‚ï¼Œ ä¸‹é¢çš„è¯­å¥ä¼šå°†æ•°æ®åº“ä¸­æ‰€æœ‰Entryçš„headlineæ‰“å°å‡ºæ¥ï¼š 1 2 for e in Entry.objects.all(): print(e.headline) åˆ‡ç‰‡ï¼šå¦‚æœä½¿ç”¨åˆ‡ç‰‡çš„â€stepâ€œå‚æ•°ï¼ŒDjango å°†æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢å¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚ Pickling/ç¼“å­˜ repr()\nlen()ï¼šå½“ä½ å¯¹QuerySetè°ƒç”¨len()æ—¶ï¼Œ å°†æäº¤æ•°æ®åº“æ“ä½œã€‚\nlist()ï¼šå¯¹QuerySetè°ƒç”¨list()å°†å¼ºåˆ¶æäº¤æ“ä½œentry_list = list(Entry.objects.all())\nbool()\næµ‹è¯•å¸ƒå°”å€¼ï¼Œåƒè¿™æ ·ï¼š\n1 2 if Entry.objects.filter(headline=\"Test\"): print(\"There is at least one Entry with the headline Test\") æ³¨ï¼šå¦‚æœä½ éœ€è¦çŸ¥é“æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€æ¡è®°å½•ï¼ˆè€Œä¸éœ€è¦çœŸå®çš„å¯¹è±¡ï¼‰ï¼Œä½¿ç”¨exists() å°†æ›´åŠ é«˜æ•ˆã€‚\näºŒã€QuerySet ä¸‹é¢æ˜¯å¯¹äºQuerySetçš„æ­£å¼å®šä¹‰ï¼š\nclass QuerySet(model=None, query=None, using=None)[source] QuerySetç±»å…·æœ‰ä¸¤ä¸ªå…¬æœ‰å±æ€§ç”¨äºå†…çœï¼š\norderedï¼šå¦‚æœQuerySetæ˜¯æ’å¥½åºçš„åˆ™ä¸ºTrueï¼Œå¦åˆ™ä¸ºFalseã€‚\ndbï¼šå¦‚æœç°åœ¨æ‰§è¡Œï¼Œåˆ™è¿”å›ä½¿ç”¨çš„æ•°æ®åº“ã€‚\nä¸‰ã€è¿”å›æ–°QuerySetsçš„API ä»¥ä¸‹çš„æ–¹æ³•éƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„QuerySetsã€‚é‡ç‚¹æ˜¯åŠ ç²—çš„å‡ ä¸ªAPIï¼Œå…¶å®ƒçš„ä½¿ç”¨åœºæ™¯å¾ˆå°‘ã€‚ æ–¹æ³•å è§£é‡Š filter() è¿‡æ»¤æŸ¥è¯¢å¯¹è±¡ã€‚\nexclude() æ’é™¤æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡\nannotate() ä½¿ç”¨èšåˆå‡½æ•°\norder_by() å¯¹æŸ¥è¯¢é›†è¿›è¡Œæ’åº\nreverse() åå‘æ’åº\ndistinct() å¯¹æŸ¥è¯¢é›†å»é‡\nvalues() è¿”å›åŒ…å«å¯¹è±¡å…·ä½“å€¼çš„å­—å…¸çš„QuerySet\nvalues_list() ä¸values()ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›çš„æ˜¯å…ƒç»„è€Œä¸æ˜¯å­—å…¸ã€‚\ndates() æ ¹æ®æ—¥æœŸè·å–æŸ¥è¯¢é›†\ndatetimes() æ ¹æ®æ—¶é—´è·å–æŸ¥è¯¢é›†\nnone() åˆ›å»ºç©ºçš„æŸ¥è¯¢é›†\nall() è·å–æ‰€æœ‰çš„å¯¹è±¡\nunion() å¹¶é›†\nintersection() äº¤é›†\ndifference() å·®é›†\nselect_related() é™„å¸¦æŸ¥è¯¢å…³è”å¯¹è±¡\nprefetch_related()é¢„å…ˆæŸ¥è¯¢\nextra() é™„åŠ SQLæŸ¥è¯¢\ndefer() ä¸åŠ è½½æŒ‡å®šå­—æ®µ\nonly() åªåŠ è½½æŒ‡å®šçš„å­—æ®µ\nusing() é€‰æ‹©æ•°æ®åº“\nselect_for_update()é”ä½é€‰æ‹©çš„å¯¹è±¡ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚\nraw() æ¥æ”¶ä¸€ä¸ªåŸå§‹çš„SQLæŸ¥è¯¢\n1. filter() filter(**kwargs)\nè¿”å›æ»¡è¶³æŸ¥è¯¢å‚æ•°çš„å¯¹è±¡é›†åˆã€‚\næŸ¥æ‰¾çš„å‚æ•°ï¼ˆ**kwargsï¼‰åº”è¯¥æ»¡è¶³ä¸‹æ–‡å­—æ®µæŸ¥æ‰¾ä¸­çš„æ ¼å¼ã€‚å¤šä¸ªå‚æ•°ä¹‹é—´æ˜¯å’ŒANDçš„å…³ç³»ã€‚\n2. exclude() exclude(**kwargs)\nè¿”å›ä¸€ä¸ªæ–°çš„QuerySetï¼Œå®ƒåŒ…å«ä¸æ»¡è¶³ç»™å®šçš„æŸ¥æ‰¾å‚æ•°çš„å¯¹è±¡ã€‚\næŸ¥æ‰¾çš„å‚æ•°ï¼ˆ**kwargsï¼‰åº”è¯¥æ»¡è¶³ä¸‹æ–‡å­—æ®µæŸ¥æ‰¾ä¸­çš„æ ¼å¼ã€‚å¤šä¸ªå‚æ•°é€šè¿‡ANDè¿æ¥ï¼Œç„¶åæ‰€æœ‰çš„å†…å®¹æ”¾å…¥NOT() ä¸­ã€‚\n1 2 3 4 5 6 7 # ä¸‹é¢çš„ç¤ºä¾‹æ’é™¤æ‰€æœ‰pub_dateæ™šäº2005-1-3ä¸”headlineä¸ºâ€œHelloâ€ çš„è®°å½•ï¼š Entry.objects.exclude(pub_date__gt=[datetime.date](2005, 1, 3), headline='Hello') # ä¸‹é¢çš„ç¤ºä¾‹æ’é™¤æ‰€æœ‰pub_dateæ™šäº2005-1-3æˆ–è€…headline ä¸ºâ€œHelloâ€ çš„è®°å½•ï¼š Entry.objects.exclude(pub_date__gt=[datetime.date](2005, 1, 3)).exclude(headline='Hello') 3. annotate() annotate(args, *kwargs)\nä½¿ç”¨æä¾›çš„èšåˆè¡¨è¾¾å¼æŸ¥è¯¢å¯¹è±¡ã€‚\nè¡¨è¾¾å¼å¯ä»¥æ˜¯ç®€å•çš„å€¼ã€å¯¹æ¨¡å‹ï¼ˆæˆ–ä»»ä½•å…³è”æ¨¡å‹ï¼‰ä¸Šçš„å­—æ®µçš„å¼•ç”¨æˆ–è€…èšåˆè¡¨è¾¾å¼ï¼ˆå¹³å‡å€¼ã€æ€»å’Œç­‰ï¼‰ã€‚\nannotate()çš„æ¯ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªannotationï¼Œå®ƒå°†æ·»åŠ åˆ°è¿”å›çš„QuerySetæ¯ä¸ªå¯¹è±¡ä¸­ã€‚\nå…³é”®å­—å‚æ•°æŒ‡å®šçš„Annotationå°†ä½¿ç”¨å…³é”®å­—ä½œä¸ºAnnotation çš„åˆ«åã€‚ åŒ¿åå‚æ•°çš„åˆ«åå°†åŸºäºèšåˆå‡½æ•°çš„åç§°å’Œæ¨¡å‹çš„å­—æ®µç”Ÿæˆã€‚ åªæœ‰å¼•ç”¨å•ä¸ªå­—æ®µçš„èšåˆè¡¨è¾¾å¼æ‰å¯ä»¥ä½¿ç”¨åŒ¿åå‚æ•°ã€‚ å…¶å®ƒæ‰€æœ‰å½¢å¼éƒ½å¿…é¡»ç”¨å…³é”®å­—å‚æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # ä¾‹å¦‚ï¼Œå¦‚æœæ­£åœ¨æ“ä½œä¸€ä¸ªBlogåˆ—è¡¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æ¯ä¸ªBlogæœ‰å¤šå°‘Entryï¼š \u003e\u003e\u003e from django.db.models import Count \u003e\u003e\u003e q = Blog.objects.annotate(Count('entry')) # The name of the first blog \u003e\u003e\u003e q[0].name 'Blogasaurus' # The number of entries on the first blog \u003e\u003e\u003e q[0].entry__count 42 # Blogæ¨¡å‹æœ¬èº«æ²¡æœ‰å®šä¹‰entry__countå±æ€§ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…³é”®å­—å‚æ•°æ¥æŒ‡å®šèšåˆå‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶Annotationçš„åç§°ï¼š \u003e\u003e\u003e q = Blog.objects.annotate(number_of_entries=Count('entry')) # The number of entries on the first blog, using the name provided \u003e\u003e\u003e q[0].number_of_entries 42 4. order_by() order_by(*fields)\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¹æ®æ¨¡å‹çš„Metaç±»ä¸­çš„orderingå±æ€§å¯¹QuerySetä¸­çš„å¯¹è±¡è¿›è¡Œæ’åº Entry.objects.filter(pub_date__year=2005).order_by('-pub_date', 'headline')\nä¸Šé¢çš„ç»“æœå°†æŒ‰ç…§pub_dateé™åºæ’åºï¼Œç„¶åå†æŒ‰ç…§headlineå‡åºæ’åºã€‚\"-pub_date\"å‰é¢çš„è´Ÿå·è¡¨ç¤ºé™åºé¡ºåºã€‚ å‡åºæ˜¯é»˜è®¤çš„ã€‚ è¦éšæœºæ’åºï¼Œä½¿ç”¨\"?\"ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nEntry.objects.order_by(â€™?')\næ³¨ï¼šorder_by(â€™?â€™)å¯èƒ½è€—è´¹èµ„æºä¸”å¾ˆæ…¢ï¼Œè¿™å–å†³äºä½¿ç”¨çš„æ•°æ®åº“ã€‚\nè‹¥è¦æŒ‰ç…§å¦å¤–ä¸€ä¸ªæ¨¡å‹ä¸­çš„å­—æ®µæ’åºï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢å…³è”æ¨¡å‹çš„è¯­æ³•ã€‚å³é€šè¿‡å­—æ®µçš„åç§°åé¢è·Ÿä¸¤ä¸ªä¸‹åˆ’çº¿ï¼ˆ__ï¼‰ï¼Œå†åŠ ä¸Šæ–°æ¨¡å‹ä¸­çš„å­—æ®µçš„åç§°ï¼Œç›´åˆ°å¸Œæœ›è¿æ¥çš„æ¨¡å‹ã€‚ åƒè¿™æ ·ï¼š\nEntry.objects.order_by(â€˜blog__nameâ€™, â€˜headlineâ€™)\nå¦‚æœæ’åºçš„å­—æ®µä¸å¦å¤–ä¸€ä¸ªæ¨¡å‹å…³è”ï¼ŒDjangoå°†ä½¿ç”¨å…³è”çš„æ¨¡å‹çš„é»˜è®¤æ’åºï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰æŒ‡å®šMeta.orderingå°†é€šè¿‡å…³è”çš„æ¨¡å‹çš„ä¸»é”®æ’åºã€‚ ä¾‹å¦‚ï¼Œå› ä¸ºBlogæ¨¡å‹æ²¡æœ‰æŒ‡å®šé»˜è®¤çš„æ’åºï¼š\nEntry.objects.order_by(â€˜blogâ€™)\nä¸ä»¥ä¸‹ç›¸åŒï¼š\nEntry.objects.order_by('blog__id')\nå¦‚æœBlogè®¾ç½®äº†ordering = [â€™nameâ€™]ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªQuerySetå°†ç­‰åŒäºï¼š\nEntry.objects.order_by(â€˜blog__nameâ€™)\nè¿˜å¯ä»¥é€šè¿‡è°ƒç”¨è¡¨è¾¾å¼çš„desc()æˆ–è€…asc()æ–¹æ³•ï¼š\nEntry.objects.order_by(Coalesce(â€˜summaryâ€™, â€˜headlineâ€™).desc())\nè€ƒè™‘ä¸‹é¢çš„æƒ…å†µï¼ŒæŒ‡å®šä¸€ä¸ªå¤šå€¼å­—æ®µæ¥æ’åºï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªManyToManyField å­—æ®µæˆ–è€…ForeignKey å­—æ®µçš„åå‘å…³è”ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class Event(Model): parent = models.ForeignKey( 'self', on_delete=models.CASCADE, related_name='children', ) date = models.DateField() Event.objects.order_by('children__date') åœ¨è¿™é‡Œï¼Œæ¯ä¸ªEventå¯èƒ½æœ‰å¤šä¸ªæ’åºæ•°æ®ï¼›å…·æœ‰å¤šä¸ªchildrençš„æ¯ä¸ªEventå°†è¢«å¤šæ¬¡è¿”å›åˆ°order_by()åˆ›å»ºçš„æ–°çš„QuerySetä¸­ã€‚ æ¢å¥è¯è¯´ï¼Œç”¨order_by()æ–¹æ³•å¯¹QuerySetå¯¹è±¡è¿›è¡Œæ“ä½œä¼šè¿”å›ä¸€ä¸ªæ‰©å¤§ç‰ˆçš„æ–°QuerySetå¯¹è±¡ã€‚å› æ­¤ï¼Œä½¿ç”¨å¤šå€¼å­—æ®µå¯¹ç»“æœè¿›è¡Œæ’åºæ—¶è¦æ ¼å¤–å°å¿ƒã€‚\næ²¡æœ‰æ–¹æ³•æŒ‡å®šæ’åºæ˜¯å¦è€ƒè™‘å¤§å°å†™ã€‚ å¯¹äºå¤§å°å†™çš„æ•æ„Ÿæ€§ï¼ŒDjangoå°†æ ¹æ®æ•°æ®åº“ä¸­çš„æ’åºæ–¹å¼æ’åºç»“æœã€‚\nå¯ä»¥é€šè¿‡Lowerå°†ä¸€ä¸ªå­—æ®µè½¬æ¢ä¸ºå°å†™æ¥æ’åºï¼Œå®ƒå°†è¾¾åˆ°å¤§å°å†™ä¸€è‡´çš„æ’åºï¼š\nEntry.objects.order_by(Lower('headline').desc())\nå¯ä»¥é€šè¿‡æ£€æŸ¥QuerySet.orderedå±æ€§æ¥çŸ¥é“æŸ¥è¯¢æ˜¯å¦æ˜¯æ’åºçš„ã€‚\næ¯ä¸ªorder_by()éƒ½å°†æ¸…é™¤å‰é¢çš„ä»»ä½•æ’åºã€‚ ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢å°†æŒ‰ç…§pub_dateæ’åºï¼Œè€Œä¸æ˜¯headlineï¼š\nEntry.objects.order_by('headline').order_by('pub_date')\n5. reverse() reverse()\nåå‘æ’åºQuerySetä¸­è¿”å›çš„å…ƒç´ ã€‚ ç¬¬äºŒæ¬¡è°ƒç”¨reverse()å°†æ¢å¤åˆ°åŸæœ‰çš„æ’åºã€‚\nå¦‚è¦è·å–QuerySetä¸­æœ€åäº”ä¸ªå…ƒç´ ï¼Œå¯ä»¥è¿™æ ·åšï¼š\nmy_queryset.reverse()[:5]\nè¿™ä¸Pythonç›´æ¥ä½¿ç”¨è´Ÿç´¢å¼•æœ‰ç‚¹ä¸ä¸€æ ·ã€‚ Djangoä¸æ”¯æŒè´Ÿç´¢å¼•ï¼Œåªèƒ½æ›²çº¿æ•‘å›½ã€‚\n6. distinct() distinct(*fields)\nå»é™¤æŸ¥è¯¢ç»“æœä¸­é‡å¤çš„è¡Œã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒQuerySetä¸ä¼šå»é™¤é‡å¤çš„è¡Œã€‚å½“æŸ¥è¯¢è·¨è¶Šå¤šå¼ è¡¨çš„æ•°æ®æ—¶ï¼ŒQuerySetå¯èƒ½å¾—åˆ°é‡å¤çš„ç»“æœï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨distinct()è¿›è¡Œå»é‡ã€‚\n7. values() values(fields, *expressions)\nè¿”å›ä¸€ä¸ªåŒ…å«æ•°æ®çš„å­—å…¸çš„querysetï¼Œè€Œä¸æ˜¯æ¨¡å‹å®ä¾‹ã€‚\næ¯ä¸ªå­—å…¸è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œé”®å¯¹åº”äºæ¨¡å‹å¯¹è±¡çš„å±æ€§åç§°ã€‚\nä¸‹é¢çš„ä¾‹å­å°†values() ä¸æ™®é€šçš„æ¨¡å‹å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 # åˆ—è¡¨ä¸­åŒ…å«çš„æ˜¯Blogå¯¹è±¡ \u003e\u003e\u003e Blog.objects.filter(name__startswith='Beatles') \u003cQuerySet [\u003cBlog: Beatles Blog\u003e]\u003e # åˆ—è¡¨ä¸­åŒ…å«çš„æ˜¯æ•°æ®å­—å…¸ \u003e\u003e\u003e Blog.objects.filter(name__startswith='Beatles').values() \u003cQuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]\u003e è¯¥æ–¹æ³•æ¥æ”¶å¯é€‰çš„ä½ç½®å‚æ•°*fieldsï¼Œå®ƒæŒ‡å®švalues()åº”è¯¥é™åˆ¶å“ªäº›å­—æ®µã€‚å¦‚æœæŒ‡å®šå­—æ®µï¼Œæ¯ä¸ªå­—å…¸å°†åªåŒ…å«æŒ‡å®šçš„å­—æ®µçš„é”®/å€¼ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µï¼Œæ¯ä¸ªå­—å…¸å°†åŒ…å«æ•°æ®åº“è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„é”®å’Œå€¼ã€‚ ä¾‹å¦‚ï¼š \u003e\u003e\u003e Blog.objects.values() \u003cQuerySet [{'id': 1, 'name': 'Beatles Blog', 'tagline': 'All the latest Beatles news.'}]\u003e \u003e\u003e\u003e Blog.objects.values('id', 'name') \u003cQuerySet [{'id': 1, 'name': 'Beatles Blog'}]\u003e values()æ–¹æ³•è¿˜æœ‰å…³é”®å­—å‚æ•°**expressionsï¼Œè¿™äº›å‚æ•°å°†ä¼ é€’ç»™annotate()ï¼š \u003e\u003e\u003e from django.db.models.functions import Lower \u003e\u003e\u003e Blog.objects.values(lower_name=Lower('name')) \u003cQuerySet [{'lower_name': 'beatles blog'}]\u003e åœ¨values()å­å¥ä¸­çš„èšåˆåº”ç”¨äºç›¸åŒvalues()å­å¥ä¸­çš„å…¶ä»–å‚æ•°ä¹‹å‰ã€‚ å¦‚æœéœ€è¦æŒ‰å¦ä¸€ä¸ªå€¼åˆ†ç»„ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°è¾ƒæ—©çš„values()å­å¥ä¸­ã€‚ åƒè¿™æ ·ï¼š \u003e\u003e\u003e from django.db.models import Count \u003e\u003e\u003e Blog.objects.values('author', entries=Count('entry')) \u003cQuerySet [{'author': 1, 'entries': 20}, {'author': 1, 'entries': 13}]\u003e \u003e\u003e\u003e Blog.objects.values('author').annotate(entries=Count('entry')) \u003cQuerySet [{'author': 1, 'entries': 33}]\u003e æ³¨æ„ï¼š å¦‚æœä½ æœ‰ä¸€ä¸ªå­—æ®µfooæ˜¯ä¸€ä¸ªForeignKeyï¼Œé»˜è®¤çš„foo_idå‚æ•°è¿”å›çš„å­—å…¸ä¸­å°†æœ‰ä¸€ä¸ªå«åšfoo çš„é”®ï¼Œå› ä¸ºè¿™æ˜¯ä¿å­˜å®é™…å€¼çš„é‚£ä¸ªéšè—çš„æ¨¡å‹å±æ€§çš„åç§°ã€‚ å½“è°ƒç”¨foo_idå¹¶ä¼ é€’å­—æ®µçš„åç§°ï¼Œä¼ é€’foo æˆ–values()éƒ½å¯ä»¥ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚åƒè¿™æ ·ï¼š \u003e\u003e\u003e Entry.objects.values() \u003cQuerySet [{'blog_id': 1, 'headline': 'First Entry', ...}, ...]\u003e \u003e\u003e\u003e Entry.objects.values('blog') \u003cQuerySet [{'blog': 1}, ...]\u003e \u003e\u003e\u003e Entry.objects.values('blog_id') \u003cQuerySet [{'blog_id': 1}, ...]\u003e å½“values()ä¸distinct()ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ³¨æ„æ’åºå¯èƒ½å½±å“æœ€ç»ˆçš„ç»“æœã€‚ å¦‚æœvalues()å­å¥ä½äºextra()è°ƒç”¨ä¹‹åï¼Œextra()ä¸­çš„selectå‚æ•°å®šä¹‰çš„å­—æ®µå¿…é¡»æ˜¾å¼åŒ…å«åœ¨values()è°ƒç”¨ä¸­ã€‚ values( è°ƒç”¨åé¢çš„extra( è°ƒç”¨å°†å¿½ç•¥é€‰æ‹©çš„é¢å¤–çš„å­—æ®µã€‚åœ¨values()ä¹‹åè°ƒç”¨only()å’Œdefer()ä¸å¤ªåˆç†ï¼Œæ‰€ä»¥å°†å¼•å‘ä¸€ä¸ªNotImplementedErrorã€‚å¯ä»¥é€šè¿‡ManyToManyFieldã€ForeignKey å’Œ OneToOneFiel å±æ€§åå‘å¼•ç”¨å…³è”çš„æ¨¡å‹çš„å­—æ®µï¼š \u003e\u003e\u003e Blog.objects.values('name', 'entry__headline') \u003cQuerySet [{'name': 'My blog', 'entry__headline': 'An entry'},{'name': 'My blog', 'entry__headline': 'Another entry'}, ...]\u003e 8. values_list() values_list(*fields, flat=False)\nä¸values()ç±»ä¼¼ï¼Œåªæ˜¯åœ¨è¿­ä»£æ—¶è¿”å›çš„æ˜¯å…ƒç»„è€Œä¸æ˜¯å­—å…¸ã€‚æ¯ä¸ªå…ƒç»„åŒ…å«ä¼ é€’ç»™values_list()è°ƒç”¨çš„ç›¸åº”å­—æ®µæˆ–è¡¨è¾¾å¼çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µç­‰ã€‚ åƒè¿™æ ·ï¼š 1 2 3 4 5 6 7 8 9 \u003e\u003e\u003e Entry.objects.values_list('id', 'headline') \u003cQuerySet [(1, 'First entry'), ...]\u003e \u003e\u003e\u003e from django.db.models.functions import Lower \u003e\u003e\u003e Entry.objects.values_list('id', Lower('headline')) \u003cQuerySet [(1, 'first entry'), ...]\u003e å¦‚æœåªä¼ é€’ä¸€ä¸ªå­—æ®µï¼Œè¿˜å¯ä»¥ä¼ é€’flatå‚æ•°ã€‚ å¦‚æœä¸ºTrueï¼Œå®ƒè¡¨ç¤ºè¿”å›çš„ç»“æœä¸ºå•ä¸ªå€¼è€Œä¸æ˜¯å…ƒç»„ã€‚ å¦‚ä¸‹æ‰€ç¤ºï¼š 1 2 3 4 5 6 7 \u003e\u003e\u003e Entry.objects.values_list('id').order_by('id') \u003cQuerySet[(1,), (2,), (3,), ...]\u003e \u003e\u003e\u003e Entry.objects.values_list('id', flat=True).order_by('id') \u003cQuerySet [1, 2, 3, ...]\u003e å¦‚æœæœ‰å¤šä¸ªå­—æ®µï¼Œä¼ é€’flatå°†å‘ç”Ÿé”™è¯¯ã€‚\nå¦‚æœä¸ä¼ é€’ä»»ä½•å€¼ç»™values_list()ï¼Œå®ƒå°†è¿”å›æ¨¡å‹ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œä»¥åœ¨æ¨¡å‹ä¸­å®šä¹‰çš„é¡ºåºã€‚\nå¸¸è§çš„æƒ…å†µæ˜¯è·å–æŸä¸ªæ¨¡å‹å®ä¾‹çš„ç‰¹å®šå­—æ®µå€¼ã€‚å¯ä»¥ä½¿ç”¨values_list()ï¼Œç„¶åè°ƒç”¨get()ï¼š\n1 2 \u003e\u003e\u003e Entry.objects.values_list('headline', flat=True).get(pk=1) 'First entry' values()å’Œvalues_list()éƒ½ç”¨äºç‰¹å®šæƒ…å†µä¸‹çš„ä¼˜åŒ–ï¼šæ£€ç´¢æ•°æ®å­é›†ï¼Œè€Œæ— éœ€åˆ›å»ºæ¨¡å‹å®ä¾‹ã€‚ æ³¨æ„é€šè¿‡ManyToManyFieldè¿›è¡ŒæŸ¥è¯¢æ—¶çš„è¡Œä¸ºï¼š 1 2 3 4 5 6 7 8 9 10 \u003e\u003e\u003e Author.objects.values_list('name', 'entry__headline') \u003cQuerySet [('Noam Chomsky', 'Impressions of Gaza'),('George Orwell', 'Why Socialists Do Not Believe in Fun'), ('George Orwell', 'In Defence of English Cooking'),('Don Quixote', None)]\u003e # ç±»ä¼¼åœ°ï¼Œå½“æŸ¥è¯¢åå‘å¤–é”®æ—¶ï¼Œå¯¹äºæ²¡æœ‰ä»»ä½•ä½œè€…çš„æ¡ç›®ï¼Œè¿”å›Noneã€‚ \u003e\u003e\u003e Entry.objects.values_list('authors') \u003cQuerySet [('Noam Chomsky',), ('George Orwell',), (None,)]\u003e 9. dates() dates(field, kind, order='ASC')\nè¿”å›ä¸€ä¸ªQuerySetï¼Œè¡¨ç¤ºQuerySetå†…å®¹ä¸­ç‰¹å®šç±»å‹çš„æ‰€æœ‰å¯ç”¨æ—¥æœŸçš„datetime.dateå¯¹è±¡åˆ—è¡¨ã€‚\nfieldå‚æ•°æ˜¯æ¨¡å‹çš„DateFieldçš„åç§°ã€‚ kindå‚æ•°åº”ä¸º\"year\"ï¼Œâ€œmonth\"æˆ–\"dayâ€ã€‚ ç»“æœåˆ—è¡¨ä¸­çš„æ¯ä¸ªdatetime.dateå¯¹è±¡è¢«æˆªå–ä¸ºç»™å®šçš„ç±»å‹ã€‚\nâ€œyearâ€ è¿”å›å¯¹åº”è¯¥fieldçš„æ‰€æœ‰ä¸åŒå¹´ä»½å€¼çš„åˆ—è¡¨ã€‚\nâ€œmonth\"è¿”å›å­—æ®µçš„æ‰€æœ‰ä¸åŒå¹´/æœˆå€¼çš„åˆ—è¡¨ã€‚\nâ€œday\"è¿”å›å­—æ®µçš„æ‰€æœ‰ä¸åŒå¹´/æœˆ/æ—¥å€¼çš„åˆ—è¡¨ã€‚\norderå‚æ•°é»˜è®¤ä¸ºâ€™ASCâ€™ï¼Œæˆ–è€…â€™DESCâ€™ã€‚ å®ƒæŒ‡å®šå¦‚ä½•æ’åºç»“æœã€‚\nä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u003e\u003e\u003e Entry.objects.dates('pub_date', 'year') [[datetime.date](2005, 1, 1)] \u003e\u003e\u003e Entry.objects.dates('pub_date', 'month') [[datetime.date](2005, 3, 1)] \u003e\u003e\u003e Entry.objects.dates('pub_date', 'day') [[datetime.date](2005, 3, 20)] \u003e\u003e\u003e Entry.objects.dates('pub_date', 'day', order='DESC') [[datetime.date](2005, 2, 20)] \u003e\u003e\u003e Entry.objects.filter(headline__contains='Lennon').dates('pub_date', 'day') [[datetime.date](2005, 3, 20)] 10. datetimes() datetimes(field_name, kind, order='ASC', tzinfo=None)\nè¿”å›QuerySetï¼Œä¸ºdatetime.datetimeå¯¹è±¡çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºQuerySetå†…å®¹ä¸­ç‰¹å®šç§ç±»çš„æ‰€æœ‰å¯ç”¨æ—¥æœŸã€‚\nfield_nameåº”ä¸ºæ¨¡å‹çš„DateTimeFieldçš„åç§°ã€‚\nkindå‚æ•°åº”ä¸º\"hourâ€ï¼Œâ€œminuteâ€ï¼Œâ€œmonthâ€ï¼Œâ€œyearâ€ï¼Œâ€œsecond\"æˆ–\"dayâ€ã€‚\nç»“æœåˆ—è¡¨ä¸­çš„æ¯ä¸ªdatetime.datetimeå¯¹è±¡è¢«æˆªå–åˆ°ç»™å®šçš„ç±»å‹ã€‚\norderå‚æ•°é»˜è®¤ä¸ºâ€™ASCâ€™ï¼Œæˆ–è€…â€™DESCâ€™ã€‚ å®ƒæŒ‡å®šå¦‚ä½•æ’åºç»“æœã€‚\ntzinfoå‚æ•°å®šä¹‰åœ¨æˆªå–ä¹‹å‰å°†æ•°æ®æ—¶é—´è½¬æ¢åˆ°çš„æ—¶åŒºã€‚\n11. none() none()\nè°ƒç”¨none()å°†åˆ›å»ºä¸€ä¸ªä¸è¿”å›ä»»ä½•å¯¹è±¡çš„æŸ¥è¯¢é›†ï¼Œå¹¶ä¸”åœ¨è®¿é—®ç»“æœæ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•æŸ¥è¯¢ã€‚ 1 2 3 4 5 6 7 8 9 10 11 ä¾‹å­ï¼š \u003e\u003e\u003e Entry.objects.none() \u003cQuerySet []\u003e \u003e\u003e\u003e from django.db.models.query import EmptyQuerySet \u003e\u003e\u003e isinstance(Entry.objects.none(), EmptyQuerySet) True 12. all() all()\nè¿”å›å½“å‰QuerySetï¼ˆæˆ–QuerySetå­ç±»ï¼‰çš„å‰¯æœ¬ã€‚é€šå¸¸ç”¨äºè·å–å…¨éƒ¨QuerySetå¯¹è±¡ã€‚ 13. union() union(*other_qs, all=False)\nDjangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­å¹¶é›†çš„æ¦‚å¿µï¼\nä½¿ç”¨SQLçš„UNIONè¿ç®—ç¬¦ç»„åˆä¸¤ä¸ªæˆ–æ›´å¤šä¸ªQuerySetçš„ç»“æœã€‚ä¾‹å¦‚ï¼š\nqs1.union(qs2, qs3)\né»˜è®¤æƒ…å†µä¸‹ï¼ŒUNIONæ“ä½œç¬¦ä»…é€‰æ‹©ä¸åŒçš„å€¼ã€‚ è¦å…è®¸é‡å¤å€¼ï¼Œè¯·ä½¿ç”¨all=Trueå‚æ•°ã€‚ 14. intersection() intersection(*other_qs)\nDjangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­äº¤é›†çš„æ¦‚å¿µï¼\nä½¿ç”¨SQLçš„INTERSECTè¿ç®—ç¬¦è¿”å›ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªQuerySetçš„å…±æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nqs1.intersection(qs2, qs3)\n15. difference() difference(*other_qs)\nDjangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­å·®é›†çš„æ¦‚å¿µï¼\nä½¿ç”¨SQLçš„EXCEPTè¿ç®—ç¬¦åªä¿ç•™QuerySetä¸­çš„å…ƒç´ ï¼Œä½†ä¸ä¿ç•™å…¶ä»–QuerySetä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nqs1.difference(qs2, qs3)\n16. select_related() select_related(*fields)\næ²¿ç€å¤–é”®å…³ç³»æŸ¥è¯¢å…³è”çš„å¯¹è±¡çš„æ•°æ®ã€‚è¿™ä¼šç”Ÿæˆä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢å¹¶å¼•èµ·æ€§èƒ½çš„æŸè€—ï¼Œä½†æ˜¯åœ¨ä»¥åä½¿ç”¨å¤–é”®å…³ç³»æ—¶å°†ä¸éœ€è¦å†æ¬¡æ•°æ®åº“æŸ¥è¯¢ã€‚\nä¸‹é¢çš„ä¾‹å­è§£é‡Šäº†æ™®é€šæŸ¥è¯¢å’Œselect_related()æŸ¥è¯¢çš„åŒºåˆ«ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æŸ¥è¯¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # è®¿é—®æ•°æ®åº“ã€‚ e = Entry.objects.get(id=5) # å†æ¬¡è®¿é—®æ•°æ®åº“ä»¥å¾—åˆ°å…³è”çš„Blogå¯¹è±¡ã€‚ b = [e.blog] ä¸‹é¢æ˜¯ä¸€ä¸ªselect_relatedæŸ¥è¯¢ï¼š # è®¿é—®æ•°æ®åº“ã€‚ e = Entry.objects.select_related('blog').get(id=5) # ä¸ä¼šè®¿é—®æ•°æ®åº“ï¼Œå› ä¸ºe.blogå·²ç»åœ¨å‰é¢çš„æŸ¥è¯¢ä¸­è·å¾—äº†ã€‚ b = [e.blog] select_related()å¯ç”¨äºobjectsä»»ä½•çš„æŸ¥è¯¢é›†ï¼š from django.utils import timezone # Find all the blogs with entries scheduled to be published in the future. blogs = set() for e in Entry.objects.filter(pub_date__gt=[timezone.now]()).select_related('blog'): # æ²¡æœ‰select_related()ï¼Œä¸‹é¢çš„è¯­å¥å°†ä¸ºæ¯æ¬¡å¾ªç¯è¿­ä»£ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢,ä»¥è·å¾—æ¯ä¸ªentryå…³è”çš„blogã€‚ blogs.add([e.blog]) filter()å’Œselect_related()çš„é¡ºåºä¸é‡è¦ã€‚ ä¸‹é¢çš„æŸ¥è¯¢é›†æ˜¯ç­‰åŒçš„ï¼š Entry.objects.filter(pub_date__gt=[timezone.now].select_related('blog') Entry.objects.select_related('blog').filter(pub_date__gt=[timezone.now]()) å¯ä»¥æ²¿ç€å¤–é”®æŸ¥è¯¢ã€‚ å¦‚æœæœ‰ä»¥ä¸‹æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 from django.db import models class City(models.Model): # ... pass class Person(models.Model): # ... hometown = models.ForeignKey( City, on_delete=models.SET_NULL, blank=True, null=True, ) class Book(models.Model): # ... author = models.ForeignKey(Person, on_delete=models.CASCADE) è°ƒç”¨Book.objects.select_related(â€˜author__hometownâ€™).get(id=4)å°†ç¼“å­˜ç›¸å…³çš„Person å’Œç›¸å…³çš„Cityï¼š\n1 2 3 4 5 6 7 8 9 10 11 b = Book.objects.select_related('author__hometown').get(id=4) p = [b.author] # Doesn't hit the database. c = p.hometown # Doesn't hit the database. b = Book.objects.get(id=4) # No select_related() in this example. p = [b.author] # Hits the database. c = p.hometown # Hits the database. åœ¨ä¼ é€’ç»™select_related()çš„å­—æ®µä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•ForeignKeyå’ŒOneToOneFieldã€‚\nåœ¨ä¼ é€’ç»™select_related()çš„å­—æ®µä¸­ï¼Œè¿˜å¯ä»¥åå‘å¼•ç”¨OneToOneFieldã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å›æº¯åˆ°å®šä¹‰OneToOneField çš„å­—æ®µã€‚ æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³è”å¯¹è±¡å­—æ®µçš„related_nameï¼Œè€Œä¸è¦æŒ‡å®šå­—æ®µçš„åç§°ã€‚\n17. prefetch_related() prefetch_related(*lookups)\nåœ¨å•ä¸ªæ‰¹å¤„ç†ä¸­è‡ªåŠ¨æ£€ç´¢æ¯ä¸ªæŒ‡å®šæŸ¥æ‰¾çš„ç›¸å…³å¯¹è±¡ã€‚\nä¸select_relatedç±»ä¼¼ï¼Œä½†æ˜¯ç­–ç•¥æ˜¯å®Œå…¨ä¸åŒçš„ã€‚\nå‡è®¾æœ‰è¿™äº›æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 from django.db import models class weightping(models.Model): name = models.CharField(max_length=30) class Pizza(models.Model): name = models.CharField(max_length=50) weightpings = models.ManyToManyField(weightping) def __str__(self): # __unicode__ on Python 2 return \"%s (%s)\" % ( self.name, \", \".join(weightping.name for weightping in self.weightpings.all()), ) å¹¶è¿è¡Œï¼š\n1 2 3 \u003e\u003e\u003e Pizza.objects.all() [\"Hawaiian (ham, pineapple)\", \"Seafood (prawns, smoked salmon)\" é—®é¢˜æ˜¯æ¯æ¬¡QuerySetè¦æ±‚Pizza.objects.all()æŸ¥è¯¢æ•°æ®åº“ï¼Œå› æ­¤self.weightpings.all()å°†åœ¨Pizza Pizza.__str__()ä¸­çš„æ¯ä¸ªé¡¹ç›®çš„weightpingsè¡¨ä¸Šè¿è¡ŒæŸ¥è¯¢ã€‚\nå¯ä»¥ä½¿ç”¨prefetch_relatedå‡å°‘ä¸ºåªæœ‰ä¸¤ä¸ªæŸ¥è¯¢ï¼š\nPizza.objects.all().prefetch_related('weightpings')\nè¿™æ„å‘³ç€ç°åœ¨æ¯æ¬¡self.weightpings.all()è¢«è°ƒç”¨ï¼Œä¸ä¼šå†å»æ•°æ®åº“æŸ¥æ‰¾ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªé¢„å–çš„QuerySetç¼“å­˜ä¸­æŸ¥æ‰¾ã€‚\nè¿˜å¯ä»¥ä½¿ç”¨æ­£å¸¸è¿æ¥è¯­æ³•æ¥æ‰§è¡Œç›¸å…³å­—æ®µçš„ç›¸å…³å­—æ®µã€‚ å‡è®¾åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å¢åŠ ä¸€ä¸ªé¢å¤–çš„æ¨¡å‹ï¼š\n1 2 3 4 5 class Restaurant(models.Model): pizzas = models.ManyToManyField(Pizza, related_name='restaurants') best_pizza = models.ForeignKey(Pizza, related_name='championed_by') ä»¥ä¸‹æ˜¯åˆæ³•çš„ï¼š\nRestaurant.objects.prefetch_related('pizzas__weightpings')\nè¿™å°†é¢„å–æ‰€æœ‰å±äºé¤å…çš„æ¯”è¨é¥¼ï¼Œå’Œæ‰€æœ‰å±äºé‚£äº›æ¯”è¨é¥¼çš„é…æ–™ã€‚ è¿™å°†å¯¼è‡´æ€»å…±3ä¸ªæŸ¥è¯¢ - ä¸€ä¸ªç”¨äºé¤é¦†ï¼Œä¸€ä¸ªç”¨äºæ¯”è¨é¥¼ï¼Œä¸€ä¸ªç”¨äºé…æ–™ã€‚ Restaurant.objects.prefetch_related('best_pizza__weightpings')\nè¿™å°†è·å–æœ€å¥½çš„æ¯”è¨é¥¼å’Œæ¯ä¸ªé¤å…æœ€å¥½çš„æŠ«è¨çš„æ‰€æœ‰é…æ–™ã€‚ è¿™å°†åœ¨3ä¸ªè¡¨ä¸­æŸ¥è¯¢ - ä¸€ä¸ªä¸ºé¤å…ï¼Œä¸€ä¸ªä¸ºâ€œæœ€ä½³æ¯”è¨é¥¼â€ï¼Œä¸€ä¸ªä¸ºé…æ–™ã€‚\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨best_pizzaæ¥è·å–select_relatedå…³ç³»ï¼Œä»¥å°†æŸ¥è¯¢æ•°å‡å°‘ä¸º2ï¼š\nRestaurant.objects.select_related('best_pizza').prefetch_related('best_pizza__weightpings')\n18. extra() extra(select=None, where=None, params=None, tables=None, order_by=None, select_params=None)\næœ‰äº›æƒ…å†µä¸‹ï¼ŒDjangoçš„æŸ¥è¯¢è¯­æ³•éš¾ä»¥ç®€å•çš„è¡¨è¾¾å¤æ‚çš„WHEREå­å¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µ,å¯ä»¥åœ¨extra()ç”Ÿæˆçš„SQLä»å¥ä¸­æ³¨å…¥æ–°å­å¥ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œè¿™æ˜¯ä¸€ä¸ªæ—§çš„APIï¼Œåœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™å¯èƒ½è¢«å¼ƒç”¨ã€‚ä»…å½“æ— æ³•ä½¿ç”¨å…¶ä»–æŸ¥è¯¢æ–¹æ³•è¡¨è¾¾æŸ¥è¯¢æ—¶æ‰ä½¿ç”¨å®ƒã€‚ ä¾‹å¦‚ï¼š\n1 2 3 4 qs.extra( select={'val': \"select col from sometable where othercol = %s\"}, select_params=(someparam,), ) ç›¸å½“äºï¼š\nqs.annotate(val=RawSQL(\"select col from sometable where othercol = %s\", (someparam,)))\n19. defer() defer(*fields)\nåœ¨ä¸€äº›å¤æ‚çš„æ•°æ®å»ºæ¨¡æƒ…å†µä¸‹ï¼Œæ¨¡å‹å¯èƒ½åŒ…å«å¤§é‡å­—æ®µï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½åŒ…å«å¤§å°ºå¯¸æ•°æ®ï¼ˆä¾‹å¦‚æ–‡æœ¬å­—æ®µï¼‰ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºPythonå¯¹è±¡éœ€è¦èŠ±è´¹å¾ˆå¤§çš„ä»£ä»·ã€‚\nå½“æœ€åˆè·å–æ•°æ®æ—¶ä¸çŸ¥é“æ˜¯å¦éœ€è¦è¿™äº›ç‰¹å®šå­—æ®µçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨æŸ¥è¯¢é›†çš„ç»“æœï¼Œå¯ä»¥å‘Šè¯‰Djangoä¸è¦ä»æ•°æ®åº“ä¸­æ£€ç´¢å®ƒä»¬ã€‚\né€šè¿‡ä¼ é€’å­—æ®µåç§°åˆ°defer()å®ç°ä¸åŠ è½½ï¼š\nEntry.objects.defer(\"headline\", \"body\")\nå…·æœ‰å»¶è¿ŸåŠ è½½å­—æ®µçš„æŸ¥è¯¢é›†ä»å°†è¿”å›æ¨¡å‹å®ä¾‹ã€‚\næ¯ä¸ªå»¶è¿Ÿå­—æ®µå°†åœ¨ä½ è®¿é—®è¯¥å­—æ®µæ—¶ä»æ•°æ®åº“ä¸­æ£€ç´¢ï¼ˆæ¯æ¬¡åªæ£€ç´¢ä¸€ä¸ªï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ£€ç´¢æ‰€æœ‰çš„å»¶è¿Ÿå­—æ®µï¼‰ã€‚\nå¯ä»¥å¤šæ¬¡è°ƒç”¨defer()ã€‚ æ¯ä¸ªè°ƒç”¨éƒ½å‘å»¶è¿Ÿé›†æ·»åŠ æ–°å­—æ®µï¼š\nå»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µã€‚ Entry.objects.defer(\"body\").filter(rating=5).defer(\"headline\")\nå­—æ®µæ·»åŠ åˆ°å»¶è¿Ÿé›†çš„é¡ºåºæ— å…³ç´§è¦ã€‚å¯¹å·²ç»å»¶è¿Ÿçš„å­—æ®µåç§°å†æ¬¡defer()æ²¡æœ‰é—®é¢˜ï¼ˆè¯¥å­—æ®µä»å°†è¢«å»¶è¿Ÿï¼‰ã€‚\nå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„åŒä¸‹åˆ’çº¿ç¬¦å·æ¥åˆ†éš”å…³è”çš„å­—æ®µï¼Œä»è€ŒåŠ è½½å…³è”æ¨¡å‹ä¸­çš„å­—æ®µï¼š\nBlog.objects.select_related().defer(\"entry__headline\", \"entry__body\")\nå¦‚æœè¦æ¸…é™¤å»¶è¿Ÿå­—æ®µé›†ï¼Œå°†Noneä½œä¸ºå‚æ•°ä¼ é€’åˆ°defer()ï¼š ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µã€‚ my_queryset.defer(None)\ndefer()æ–¹æ³•ï¼ˆåŠå…¶å…„å¼Ÿï¼Œonly()ï¼‰ä»…é€‚ç”¨äºé«˜çº§ç”¨ä¾‹ï¼Œå®ƒä»¬æä¾›äº†æ•°æ®åŠ è½½çš„ä¼˜åŒ–æ–¹æ³•ã€‚\n20. only() only(*fields)\nonly()æ–¹æ³•ä¸defer()ç›¸åã€‚\nå¦‚æœæœ‰ä¸€ä¸ªæ¨¡å‹å‡ ä¹æ‰€æœ‰çš„å­—æ®µéœ€è¦å»¶è¿Ÿï¼Œä½¿ç”¨only()æŒ‡å®šè¡¥å……çš„å­—æ®µé›†å¯ä»¥ä½¿ä»£ç æ›´ç®€å•ã€‚\nå‡è®¾æœ‰ä¸€ä¸ªåŒ…å«å­—æ®µbiographyã€ageå’Œnameçš„æ¨¡å‹ã€‚ ä»¥ä¸‹ä¸¤ä¸ªæŸ¥è¯¢é›†æ˜¯ç›¸åŒçš„ï¼Œå°±å»¶è¿Ÿå­—æ®µè€Œè¨€ï¼š\nPerson.objects.defer(â€œageâ€, â€œbiographyâ€) Person.objects.only(â€œnameâ€) æ¯å½“ä½ è°ƒç”¨only()æ—¶ï¼Œå®ƒå°†æ›¿æ¢ç«‹å³åŠ è½½çš„å­—æ®µé›†ã€‚å› æ­¤ï¼Œå¯¹only()çš„è¿ç»­è°ƒç”¨çš„ç»“æœæ˜¯åªæœ‰æœ€åä¸€æ¬¡è°ƒç”¨çš„å­—æ®µè¢«è€ƒè™‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # This will defer all fields except the headline. Entry.objects.only(\"body\", \"rating\").only(\"headline\") ç”±äºdefer()ä»¥é€’å¢æ–¹å¼åŠ¨ä½œï¼ˆå‘å»¶è¿Ÿåˆ—è¡¨ä¸­æ·»åŠ å­—æ®µï¼‰ï¼Œå› æ­¤ä½ å¯ä»¥ç»“åˆonly()å’Œdefer()è°ƒç”¨ï¼š # Final result is that everything except \"headline\" is deferred. Entry.objects.only(\"headline\", \"body\").defer(\"body\") # Final result loads headline and body immediately (only() replaces any # existing set of fields). Entry.objects.defer(\"body\").only(\"headline\", \"body\") å½“å¯¹å…·æœ‰å»¶è¿Ÿå­—æ®µçš„å®ä¾‹è°ƒç”¨save()æ—¶ï¼Œä»…ä¿å­˜åŠ è½½çš„å­—æ®µã€‚\n21. using() using(alias)\nå¦‚æœæ­£åœ¨ä½¿ç”¨å¤šä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºæŒ‡å®šåœ¨å“ªä¸ªæ•°æ®åº“ä¸ŠæŸ¥è¯¢QuerySetã€‚æ–¹æ³•çš„å”¯ä¸€å‚æ•°æ˜¯æ•°æ®åº“çš„åˆ«åï¼Œå®šä¹‰åœ¨DATABASESã€‚ ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 # queries the database with the 'default' alias. \u003e\u003e\u003e Entry.objects.all() # queries the database with the 'backup' alias \u003e\u003e\u003e Entry.objects.using('backup') 22. select_for_update() select_for_update(nowait=False, skip_locked=False)\nè¿”å›ä¸€ä¸ªé”ä½è¡Œç›´åˆ°äº‹åŠ¡ç»“æŸçš„æŸ¥è¯¢é›†ï¼Œå¦‚æœæ•°æ®åº“æ”¯æŒï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªSELECT â€¦ FOR UPDATEè¯­å¥ã€‚ ä¾‹å¦‚ï¼š\nentries = Entry.objects.select_for_update().filter(author=request.user)\næ‰€æœ‰åŒ¹é…çš„è¡Œå°†è¢«é”å®šï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡é”é˜²æ­¢æ•°æ®è¢«å…¶å®ƒäº‹åŠ¡ä¿®æ”¹ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœå…¶ä»–äº‹åŠ¡é”å®šäº†ç›¸å…³è¡Œï¼Œé‚£ä¹ˆæœ¬æŸ¥è¯¢å°†è¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚ä½¿ç”¨select_for_update(nowait=True)å°†ä½¿æŸ¥è¯¢ä¸é˜»å¡ã€‚å¦‚æœå…¶å®ƒäº‹åŠ¡æŒæœ‰å†²çªçš„é”,é‚£ä¹ˆæŸ¥è¯¢å°†å¼•å‘DatabaseErrorå¼‚å¸¸ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨select_for_update(skip_locked=True)å¿½ç•¥é”å®šçš„è¡Œã€‚nowaitå’Œskip_lockedæ˜¯äº’æ–¥çš„ã€‚\nç›®å‰ï¼Œpostgresqlï¼Œoracleå’Œmysqlæ•°æ®åº“åç«¯æ”¯æŒselect_for_update()ã€‚ä½†æ˜¯ï¼ŒMySQLä¸æ”¯æŒnowaitå’Œskip_lockedå‚æ•°ã€‚\n23. raw() raw(raw_query, params=None, translations=None)\næ¥æ”¶ä¸€ä¸ªåŸå§‹çš„SQLæŸ¥è¯¢ï¼Œæ‰§è¡Œå®ƒå¹¶è¿”å›ä¸€ä¸ªdjango.db.models.query.RawQuerySetå®ä¾‹ã€‚\nè¿™ä¸ªRawQuerySetå®ä¾‹å¯ä»¥è¿­ä»£ï¼Œå°±åƒæ™®é€šçš„QuerySetä¸€æ ·ã€‚\nå››ã€ä¸è¿”å›QuerySetsçš„API ä»¥ä¸‹çš„æ–¹æ³•ä¸ä¼šè¿”å›QuerySetsï¼Œä½†æ˜¯ä½œç”¨éå¸¸å¼ºå¤§ï¼Œå°¤å…¶æ˜¯ç²—ä½“æ˜¾ç¤ºçš„æ–¹æ³•ï¼Œéœ€è¦èƒŒä¸‹æ¥ã€‚ æ–¹æ³•å è§£é‡Š get() è·å–å•ä¸ªå¯¹è±¡\ncreate() åˆ›å»ºå¯¹è±¡ï¼Œæ— éœ€save()\nget_or_create() æŸ¥è¯¢å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±æ–°å»ºå¯¹è±¡\nupdate_or_create() æ›´æ–°å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±åˆ›å»ºå¯¹è±¡\nbulk_create()\næ‰¹é‡åˆ›å»ºå¯¹è±¡\ncount() ç»Ÿè®¡å¯¹è±¡çš„ä¸ªæ•°\nin_bulk()\næ ¹æ®ä¸»é”®å€¼çš„åˆ—è¡¨ï¼Œæ‰¹é‡è¿”å›å¯¹è±¡\niterator()\nè·å–åŒ…å«å¯¹è±¡çš„è¿­ä»£å™¨\nlatest() è·å–æœ€è¿‘çš„å¯¹è±¡\nearliest() è·å–æœ€æ—©çš„å¯¹è±¡\nfirst() è·å–ç¬¬ä¸€ä¸ªå¯¹è±¡\nlast() è·å–æœ€åä¸€ä¸ªå¯¹è±¡\naggregate() èšåˆæ“ä½œ\nexists() åˆ¤æ–­querysetä¸­æ˜¯å¦æœ‰å¯¹è±¡\nupdate() æ‰¹é‡æ›´æ–°å¯¹è±¡\ndelete() æ‰¹é‡åˆ é™¤å¯¹è±¡\nas_manager() è·å–ç®¡ç†å™¨\n1. get() get(**kwargs)\nè¿”å›æŒ‰ç…§æŸ¥è¯¢å‚æ•°åŒ¹é…åˆ°çš„å•ä¸ªå¯¹è±¡ï¼Œå‚æ•°çš„æ ¼å¼åº”è¯¥ç¬¦åˆField lookupsçš„è¦æ±‚ã€‚\nå¦‚æœåŒ¹é…åˆ°çš„å¯¹è±¡ä¸ªæ•°ä¸åªä¸€ä¸ªçš„è¯ï¼Œè§¦å‘MultipleObjectsReturnedå¼‚å¸¸\nå¦‚æœæ ¹æ®ç»™å‡ºçš„å‚æ•°åŒ¹é…ä¸åˆ°å¯¹è±¡çš„è¯ï¼Œè§¦å‘DoesNotExistå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š\nEntry.objects.get(id='foo') # raises Entry.DoesNotExist\nDoesNotExistå¼‚å¸¸ä»django.core.exceptions.ObjectDoesNotExistç»§æ‰¿ï¼Œå¯ä»¥å®šä½å¤šä¸ªDoesNotExistå¼‚å¸¸ã€‚ ä¾‹å¦‚ï¼š 1 2 3 4 5 6 7 from django.core.exceptions import ObjectDoesNotExist try: e = Entry.objects.get(id=3) b = Blog.objects.get(id=1) except ObjectDoesNotExist: print(\"Either the entry or blog doesn't exist.\") å¦‚æœå¸Œæœ›æŸ¥è¯¢å™¨åªè¿”å›ä¸€è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨get()è€Œä¸ä½¿ç”¨ä»»ä½•å‚æ•°æ¥è¿”å›è¯¥è¡Œçš„å¯¹è±¡ï¼š entry = Entry.objects.filter(...).exclude(...).get()\n2. create() create(**kwargs)\nåœ¨ä¸€æ­¥æ“ä½œä¸­åŒæ—¶åˆ›å»ºå¹¶ä¸”ä¿å­˜å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•. p = Person.objects.create(first_name=\"Bruce\", last_name=\"Springsteen\")\nç­‰äº:\np = Person(first_name=\"Bruce\", last_name=\"Springsteen\")\np.save(force_insert=True)\nå‚æ•°force_insertè¡¨ç¤ºå¼ºåˆ¶åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœmodelä¸­æœ‰ä¸€ä¸ªä½ æ‰‹åŠ¨è®¾ç½®çš„ä¸»é”®ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­, è°ƒç”¨create()å°†ä¼šå¤±è´¥å¹¶ä¸”è§¦å‘IntegrityErrorå› ä¸ºä¸»é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä½ æ‰‹åŠ¨è®¾ç½®äº†ä¸»é”®ï¼Œåšå¥½å¼‚å¸¸å¤„ç†çš„å‡†å¤‡ã€‚ 3. get_or_create() get_or_create(defaults=None, **kwargs)\né€šè¿‡kwargsæ¥æŸ¥è¯¢å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•ï¼ˆå¦‚æœæ¨¡å‹ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸ºç©ºï¼‰ï¼Œå¦‚æœè¯¥å¯¹è±¡ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚\nè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªç”±(object, created)ç»„æˆçš„å…ƒç»„ï¼Œå…ƒç»„ä¸­çš„object æ˜¯ä¸€ä¸ªæŸ¥è¯¢åˆ°çš„æˆ–è€…æ˜¯è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œ createdæ˜¯ä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°çš„å¯¹è±¡çš„å¸ƒå°”å€¼ã€‚\nå¯¹äºä¸‹é¢çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 try: obj = Person.objects.get(first_name='John', last_name='Lennon') except Person.DoesNotExist: obj = Person(first_name='John', last_name='Lennon', birthday=date(1940, 10, 9)) obj.save() å¦‚æœæ¨¡å‹çš„å­—æ®µæ•°é‡è¾ƒå¤§çš„è¯ï¼Œè¿™ç§æ¨¡å¼å°±å˜çš„éå¸¸ä¸æ˜“ç”¨äº†ã€‚ ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ç”¨get_or_create()é‡å†™ :\n1 2 3 4 5 obj, created = Person.objects.get_or_create( first_name='John', last_name='Lennon', defaults={'birthday': date(1940, 10, 9)}, ) ä»»ä½•ä¼ é€’ç»™get_or_create()çš„å…³é”®å­—å‚æ•°ï¼Œé™¤äº†ä¸€ä¸ªå¯é€‰çš„defaultsï¼Œéƒ½å°†ä¼ é€’ç»™get()è°ƒç”¨ã€‚ å¦‚æœæŸ¥æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«åŒ¹é…åˆ°çš„å¯¹è±¡ä»¥åŠFalse ç»„æˆçš„å…ƒç»„ã€‚ å¦‚æœæŸ¥æ‰¾åˆ°çš„å¯¹è±¡è¶…è¿‡ä¸€ä¸ªä»¥ä¸Šï¼Œå°†å¼•å‘MultipleObjectsReturnedã€‚å¦‚æœæŸ¥æ‰¾ä¸åˆ°å¯¹è±¡ï¼Œget_or_create()å°†ä¼šå®ä¾‹åŒ–å¹¶ä¿å­˜ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªç”±æ–°çš„å¯¹è±¡ä»¥åŠTrueç»„æˆçš„å…ƒç»„ã€‚æ–°çš„å¯¹è±¡å°†ä¼šæŒ‰ç…§ä»¥ä¸‹çš„é€»è¾‘åˆ›å»º: 1 2 3 4 5 6 7 params = {k: v for k, v in kwargs.items() if '__' not in k} params.update({k: v() if callable(v) else v for k, v in defaults.items()}) obj = self.model(**params) obj.save() å®ƒè¡¨ç¤ºä»éâ€™defaultsâ€™ ä¸”ä¸åŒ…å«åŒä¸‹åˆ’çº¿çš„å…³é”®å­—å‚æ•°å¼€å§‹ã€‚ç„¶åå°†defaultsçš„å†…å®¹æ·»åŠ è¿›æ¥ï¼Œè¦†ç›–å¿…è¦çš„é”®ï¼Œå¹¶ä½¿ç”¨ç»“æœä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¨¡å‹ç±»ã€‚\nå¦‚æœæœ‰ä¸€ä¸ªåä¸ºdefaults__exactçš„å­—æ®µï¼Œå¹¶ä¸”æƒ³åœ¨get_or_create()æ—¶ç”¨å®ƒä½œä¸ºç²¾ç¡®æŸ¥è¯¢ï¼Œåªéœ€è¦ä½¿ç”¨defaultsï¼Œåƒè¿™æ ·ï¼š\nFoo.objects.get_or_create(defaults__exact='bar', defaults={'defaults': 'baz'})\nå½“ä½ ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šçš„ä¸»é”®æ—¶ï¼Œget_or_create()æ–¹æ³•ä¸create()æ–¹æ³•æœ‰ç›¸ä¼¼çš„é”™è¯¯è¡Œä¸º ã€‚ å¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡è€Œè¯¥å¯¹è±¡çš„ä¸»é”®æ—©å·²å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼ŒIntegrityErrorå¼‚å¸¸å°†ä¼šè¢«è§¦å‘ã€‚\nè¿™ä¸ªæ–¹æ³•å‡è®¾è¿›è¡Œçš„æ˜¯åŸå­æ“ä½œï¼Œå¹¶ä¸”æ­£ç¡®åœ°é…ç½®äº†æ•°æ®åº“å’Œæ­£ç¡®çš„åº•å±‚æ•°æ®åº“è¡Œä¸ºã€‚å¦‚æœæ•°æ®åº“çº§åˆ«æ²¡æœ‰å¯¹get_or_createä¸­ç”¨åˆ°çš„kwargså¼ºåˆ¶è¦æ±‚å”¯ä¸€æ€§ï¼ˆuniqueå’Œunique_togetherï¼‰ï¼Œæ–¹æ³•å®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå¯èƒ½ä¼šæœ‰ç›¸åŒå‚æ•°çš„å¤šè¡ŒåŒæ—¶æ’å…¥ã€‚ï¼ˆç®€å•ç†è§£ï¼Œkwargså¿…é¡»æŒ‡å®šçš„æ˜¯ä¸»é”®æˆ–è€…uniqueå±æ€§çš„å­—æ®µæ‰å®‰å…¨ã€‚ï¼‰\næœ€åå»ºè®®åªåœ¨Djangoè§†å›¾çš„POSTè¯·æ±‚ä¸­ä½¿ç”¨get_or_create()ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¿®æ”¹æ€§è´¨çš„åŠ¨ä½œï¼Œä¸åº”è¯¥ä½¿ç”¨åœ¨GETè¯·æ±‚ä¸­ï¼Œé‚£æ ·ä¸å®‰å…¨ã€‚\nå¯ä»¥é€šè¿‡ManyToManyFieldå±æ€§å’Œåå‘å…³è”ä½¿ç”¨get_or_create()ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é™åˆ¶æŸ¥è¯¢åœ¨å…³è”çš„ä¸Šä¸‹æ–‡å†…éƒ¨ã€‚ å¦åˆ™ï¼Œå¯èƒ½å¯¼è‡´å®Œæ•´æ€§é—®é¢˜ã€‚\nä¾‹å¦‚ä¸‹é¢çš„æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 class Chapter(models.Model): title = models.CharField(max_length=255, unique=True) class Book(models.Model): title = models.CharField(max_length=256) chapters = models.ManyToManyField(Chapter) å¯ä»¥é€šè¿‡Bookçš„chapterså­—æ®µä½¿ç”¨get_or_create()ï¼Œä½†æ˜¯å®ƒåªä¼šè·å–è¯¥Bookå†…éƒ¨çš„ä¸Šä¸‹æ–‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u003e\u003e\u003e book = Book.objects.create(title=\"Ulysses\") \u003e\u003e\u003e book.chapters.get_or_create(title=\"Telemachus\") (\u003cChapter: Telemachus\u003e, True) \u003e\u003e\u003e book.chapters.get_or_create(title=\"Telemachus\") (\u003cChapter: Telemachus\u003e, False) \u003e\u003e\u003e Chapter.objects.create(title=\"Chapter 1\") \u003cChapter: Chapter 1\u003e \u003e\u003e\u003e book.chapters.get_or_create(title=\"Chapter 1\") # Raises IntegrityError å‘ç”Ÿè¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºå°è¯•é€šè¿‡Book â€œUlyssesâ€è·å–æˆ–è€…åˆ›å»ºâ€œChapter 1â€ï¼Œä½†æ˜¯å®ƒä¸èƒ½ï¼Œå› ä¸ºå®ƒä¸è¿™ä¸ªbookä¸å…³è”ï¼Œä½†å› ä¸ºtitle å­—æ®µæ˜¯å”¯ä¸€çš„å®ƒä»ç„¶ä¸èƒ½åˆ›å»ºã€‚ åœ¨Django1.11åœ¨defaultsä¸­å¢åŠ äº†å¯¹å¯è°ƒç”¨å€¼çš„æ”¯æŒã€‚\n4. update_or_create() update_or_create(defaults=None, **kwargs)\nç±»ä¼¼å‰é¢çš„get_or_create()ã€‚\né€šè¿‡ç»™å‡ºçš„kwargsæ¥æ›´æ–°å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•ï¼Œ å¦‚æœæ²¡æ‰¾åˆ°å¯¹è±¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚defaultsæ˜¯ä¸€ä¸ªç”± (field, value)å¯¹ç»„æˆçš„å­—å…¸ï¼Œç”¨äºæ›´æ–°å¯¹è±¡ã€‚defaultsä¸­çš„å€¼å¯ä»¥æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯è¯´å‡½æ•°ç­‰ï¼‰ã€‚\nè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªç”±(object, created)ç»„æˆçš„å…ƒç»„,å…ƒç»„ä¸­çš„objectæ˜¯ä¸€ä¸ªåˆ›å»ºçš„æˆ–è€…æ˜¯è¢«æ›´æ–°çš„å¯¹è±¡ï¼Œ createdæ˜¯ä¸€ä¸ªæ ‡ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°çš„å¯¹è±¡çš„å¸ƒå°”å€¼ã€‚\nupdate_or_createæ–¹æ³•å°è¯•é€šè¿‡ç»™å‡ºçš„kwargs å»ä»æ•°æ®åº“ä¸­è·å–åŒ¹é…çš„å¯¹è±¡ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„å¯¹è±¡ï¼Œå®ƒå°†ä¼šä¾æ®defaults å­—å…¸ç»™å‡ºçš„å€¼æ›´æ–°å­—æ®µã€‚\nåƒä¸‹é¢çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 defaults = {'first_name': 'Bob'} try: obj = Person.objects.get(first_name='John', last_name='Lennon') for key, value in defaults.items(): setattr(obj, key, value) obj.save() except Person.DoesNotExist: new_values = {'first_name': 'John', 'last_name': 'Lennon'} new_values.update(defaults) obj = Person(**new_values) obj.save() å¦‚æœæ¨¡å‹çš„å­—æ®µæ•°é‡è¾ƒå¤§çš„è¯ï¼Œè¿™ç§æ¨¡å¼å°±å˜çš„éå¸¸ä¸æ˜“ç”¨äº†ã€‚ ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ç”¨update_or_create() é‡å†™:\n1 2 3 4 5 6 7 obj, created = Person.objects.update_or_create( first_name='John', last_name='Lennon', defaults={'first_name': 'Bob'}, ) kwargsä¸­çš„åç§°å¦‚ä½•è§£æçš„è¯¦ç»†æè¿°å¯ä»¥å‚è§get_or_create()ã€‚\nå’Œget_or_create()ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå¦‚æœæ•°æ®åº“å±‚çº§æ²¡æœ‰å‰ç½®å”¯ä¸€æ€§ä¼šè®©å¤šè¡ŒåŒæ—¶æ’å…¥ã€‚\nåœ¨Django1.11åœ¨defaultsä¸­å¢åŠ äº†å¯¹å¯è°ƒç”¨å€¼çš„æ”¯æŒã€‚\n5. bulk_create() bulk_create(objs, batch_size=None)\nä»¥é«˜æ•ˆçš„æ–¹å¼ï¼ˆé€šå¸¸åªæœ‰1ä¸ªæŸ¥è¯¢ï¼Œæ— è®ºæœ‰å¤šå°‘å¯¹è±¡ï¼‰å°†æä¾›çš„å¯¹è±¡åˆ—è¡¨æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼š 1 2 3 4 5 6 7 \u003e\u003e\u003e Entry.objects.bulk_create([ ... Entry(headline='This is a test'), ... Entry(headline='This is only a test'), ... ]) æ³¨æ„äº‹é¡¹ï¼š\nä¸ä¼šè°ƒç”¨æ¨¡å‹çš„save()æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ä¼šå‘é€pre_saveå’Œpost_saveä¿¡å·ã€‚\nä¸é€‚ç”¨äºå¤šè¡¨ç»§æ‰¿åœºæ™¯ä¸­çš„å­æ¨¡å‹ã€‚\nå¦‚æœæ¨¡å‹çš„ä¸»é”®æ˜¯AutoFieldï¼Œåˆ™ä¸ä¼šåƒsave()é‚£æ ·æ£€ç´¢å¹¶è®¾ç½®ä¸»é”®å±æ€§ï¼Œé™¤éæ•°æ®åº“åç«¯æ”¯æŒã€‚\nä¸é€‚ç”¨äºå¤šå¯¹å¤šå…³ç³»ã€‚\nbatch_sizeå‚æ•°æ§åˆ¶åœ¨å•ä¸ªæŸ¥è¯¢ä¸­åˆ›å»ºçš„å¯¹è±¡æ•°ã€‚\n6. count() count()\nè¿”å›åœ¨æ•°æ®åº“ä¸­å¯¹åº”çš„QuerySetå¯¹è±¡çš„ä¸ªæ•°ã€‚count()æ°¸è¿œä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚ ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 # è¿”å›æ€»ä¸ªæ•°. Entry.objects.count() # è¿”å›åŒ…å«æœ‰'Lennon'çš„å¯¹è±¡çš„æ€»æ•° Entry.objects.filter(headline__contains='Lennon').count() 7. in_bulk() in_bulk(id_list=None)\nè·å–ä¸»é”®å€¼çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›å°†æ¯ä¸ªä¸»é”®å€¼æ˜ å°„åˆ°å…·æœ‰ç»™å®šIDçš„å¯¹è±¡çš„å®ä¾‹çš„å­—å…¸ã€‚ å¦‚æœæœªæä¾›åˆ—è¡¨ï¼Œåˆ™ä¼šè¿”å›æŸ¥è¯¢é›†ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u003e\u003e\u003e Blog.objects.in_bulk([1]) {1: \u003cBlog: Beatles Blog\u003e} \u003e\u003e\u003e Blog.objects.in_bulk([1, 2]) {1: \u003cBlog: Beatles Blog\u003e, 2: \u003cBlog: Cheddar Talk\u003e} \u003e\u003e\u003e Blog.objects.in_bulk([]) {} \u003e\u003e\u003e Blog.objects.in_bulk() {1: \u003cBlog: Beatles Blog\u003e, 2: \u003cBlog: Cheddar Talk\u003e, 3: \u003cBlog: Django Weblog\u003e} å¦‚æœå‘in_bulk()ä¼ é€’ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç©ºçš„å­—å…¸ã€‚\nåœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œid_listæ˜¯å¿…éœ€çš„å‚æ•°ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚\n8. iterator() iterator()\næäº¤æ•°æ®åº“æ“ä½œï¼Œè·å–QuerySetï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚\nQuerySeté€šå¸¸ä¼šåœ¨å†…éƒ¨ç¼“å­˜å…¶ç»“æœï¼Œä»¥ä¾¿åœ¨é‡å¤è®¡ç®—æ—¶ä¸ä¼šå¯¼è‡´é¢å¤–çš„æŸ¥è¯¢ã€‚è€Œiterator()å°†ç›´æ¥è¯»å–ç»“æœï¼Œä¸åœ¨QuerySetçº§åˆ«æ‰§è¡Œä»»ä½•ç¼“å­˜ã€‚å¯¹äºè¿”å›å¤§é‡åªéœ€è¦è®¿é—®ä¸€æ¬¡çš„å¯¹è±¡çš„QuerySetï¼Œè¿™å¯ä»¥å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ã€‚\nè¯·æ³¨æ„ï¼Œåœ¨å·²ç»æäº¤äº†çš„iterator()ä¸Šä½¿ç”¨QuerySetä¼šå¼ºåˆ¶å®ƒå†æ¬¡æäº¤æ•°æ®åº“æ“ä½œï¼Œè¿›è¡Œé‡å¤æŸ¥è¯¢ã€‚æ­¤å¤–ï¼Œä½¿ç”¨iterator()ä¼šå¯¼è‡´å…ˆå‰çš„prefetch_related()è°ƒç”¨è¢«å¿½ç•¥ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¸€èµ·ä¼˜åŒ–æ²¡æœ‰æ„ä¹‰ã€‚\n9. latest() latest(field_name=None)\nä½¿ç”¨æ—¥æœŸå­—æ®µfield_nameï¼ŒæŒ‰æ—¥æœŸè¿”å›æœ€æ–°å¯¹è±¡ã€‚\nä¸‹ä¾‹æ ¹æ®Entryçš„â€™pub_dateâ€™å­—æ®µè¿”å›æœ€æ–°å‘å¸ƒçš„entryï¼š\nEntry.objects.latest('pub_date')\nå¦‚æœæ¨¡å‹çš„MetaæŒ‡å®šäº†get_latest_byï¼Œåˆ™å¯ä»¥å°†latest()å‚æ•°ç•™ç»™earliest()æˆ–è€…field_nameã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒDjangoå°†ä½¿ç”¨get_latest_byä¸­æŒ‡å®šçš„å­—æ®µã€‚\nearliest()å’Œlatest()å¯èƒ½ä¼šè¿”å›ç©ºæ—¥æœŸçš„å®ä¾‹,å¯èƒ½éœ€è¦è¿‡æ»¤æ‰ç©ºå€¼ï¼š\nEntry.objects.filter(pub_date__isnull=False).latest('pub_date')\n10. earliest() earliest(field_name=None)\nç±»åŒlatest()ã€‚\n11. first() first()\nè¿”å›ç»“æœé›†çš„ç¬¬ä¸€ä¸ªå¯¹è±¡, å½“æ²¡æœ‰æ‰¾åˆ°æ—¶è¿”å›Noneã€‚å¦‚æœQuerySetæ²¡æœ‰è®¾ç½®æ’åº,åˆ™å°†ä¼šè‡ªåŠ¨æŒ‰ä¸»é”®è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š p = Article.objects.order_by('title', 'pub_date').first()\nfirst()æ˜¯ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ï¼Œä¸‹é¢çš„ä¾‹å­å’Œä¸Šé¢çš„ä»£ç æ•ˆæœæ˜¯ä¸€æ ·ï¼š 1 2 3 4 try: p = Article.objects.order_by('title', 'pub_date')[0] except IndexError: p = None 12. last() last()\nå·¥ä½œæ–¹å¼ç±»ä¼¼first()ï¼Œåªæ˜¯è¿”å›çš„æ˜¯æŸ¥è¯¢é›†ä¸­æœ€åä¸€ä¸ªå¯¹è±¡ã€‚\n13. aggregate() aggregate(args, *kwargs)\nè¿”å›æ±‡æ€»å€¼çš„å­—å…¸ï¼ˆå¹³å‡å€¼ï¼Œæ€»å’Œç­‰ï¼‰,é€šè¿‡QuerySetè¿›è¡Œè®¡ç®—ã€‚æ¯ä¸ªå‚æ•°æŒ‡å®šè¿”å›çš„å­—å…¸ä¸­å°†è¦åŒ…å«çš„å€¼ã€‚\nä½¿ç”¨å…³é”®å­—å‚æ•°æŒ‡å®šçš„èšåˆå°†ä½¿ç”¨å…³é”®å­—å‚æ•°çš„åç§°ä½œä¸ºAnnotation çš„åç§°ã€‚ åŒ¿åå‚æ•°çš„åç§°å°†åŸºäºèšåˆå‡½æ•°çš„åç§°å’Œæ¨¡å‹å­—æ®µç”Ÿæˆã€‚ å¤æ‚çš„èšåˆä¸å¯ä»¥ä½¿ç”¨åŒ¿åå‚æ•°ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªå…³é”®å­—å‚æ•°ä½œä¸ºåˆ«åã€‚\nä¾‹å¦‚ï¼Œæƒ³çŸ¥é“Blog Entry çš„æ•°ç›®ï¼š\n1 2 3 4 from django.db.models import Count q = Blog.objects.aggregate(Count('entry')) {'entry__count': 16} é€šè¿‡ä½¿ç”¨å…³é”®å­—å‚æ•°æ¥æŒ‡å®šèšåˆå‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶è¿”å›çš„èšåˆçš„å€¼çš„åç§°ï¼š\n1 2 3 q = Blog.objects.aggregate(number_of_entries=Count('entry')) {'number_of_entries': 16} 14. exists() exists()\nå¦‚æœQuerySetåŒ…å«ä»»ä½•ç»“æœï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›Falseã€‚\næŸ¥æ‰¾å…·æœ‰å”¯ä¸€æ€§å­—æ®µï¼ˆä¾‹å¦‚primary_keyï¼‰çš„æ¨¡å‹æ˜¯å¦åœ¨ä¸€ä¸ªQuerySetä¸­çš„æœ€é«˜æ•ˆçš„æ–¹æ³•æ˜¯ï¼š\n1 2 3 4 5 entry = Entry.objects.get(pk=123) if some_queryset.filter(pk=entry.pk).exists(): print(\"Entry contained in queryset\") å®ƒå°†æ¯”ä¸‹é¢çš„æ–¹æ³•å¿«å¾ˆå¤šï¼Œè¿™ä¸ªæ–¹æ³•è¦æ±‚å¯¹QuerySetæ±‚å€¼å¹¶è¿­ä»£æ•´ä¸ªQuerySetï¼š\n1 2 if entry in some_queryset: print(\"Entry contained in QuerySet\") è‹¥è¦æŸ¥æ‰¾ä¸€ä¸ªQuerySetæ˜¯å¦åŒ…å«ä»»ä½•å…ƒç´ ï¼š\n1 2 3 4 5 if some_queryset.exists(): print(\"There is at least one object in some_queryset\") å°†å¿«äºï¼š if some_queryset: print(\"There is at least one object in some_queryset\") 15. update() update(**kwargs)\nå¯¹æŒ‡å®šçš„å­—æ®µæ‰§è¡Œæ‰¹é‡æ›´æ–°æ“ä½œï¼Œå¹¶è¿”å›åŒ¹é…çš„è¡Œæ•°ï¼ˆå¦‚æœæŸäº›è¡Œå·²å…·æœ‰æ–°å€¼ï¼Œåˆ™å¯èƒ½ä¸ç­‰äºå·²æ›´æ–°çš„è¡Œæ•°ï¼‰ã€‚\nä¾‹å¦‚ï¼Œè¦å¯¹2010å¹´å‘å¸ƒçš„æ‰€æœ‰åšå®¢æ¡ç›®å¯ç”¨è¯„è®ºï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\nEntry.objects.filter(pub_date__year=2010).update(comments_on=False)\nå¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µ ï¼ˆæ²¡æœ‰å¤šå°‘å­—æ®µçš„é™åˆ¶ï¼‰ã€‚ ä¾‹å¦‚åŒæ—¶æ›´æ–°comments_onå’Œheadlineå­—æ®µï¼š Entry.objects.filter(pub_date__year=2010).update(comments_on=False, headline='This is old')\nupdate()æ–¹æ³•æ— éœ€saveæ“ä½œã€‚å”¯ä¸€é™åˆ¶æ˜¯å®ƒåªèƒ½æ›´æ–°æ¨¡å‹ä¸»è¡¨ä¸­çš„åˆ—ï¼Œè€Œä¸æ˜¯å…³è”çš„æ¨¡å‹ï¼Œä¾‹å¦‚ä¸èƒ½è¿™æ ·åšï¼š\nEntry.objects.update(blog__name='foo') # Won't work!\nä»ç„¶å¯ä»¥æ ¹æ®ç›¸å…³å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼š\nEntry.objects.filter(blog__id=1).update(comments_on=True)\nupdate()æ–¹æ³•è¿”å›å—å½±å“çš„è¡Œæ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 Entry.objects.filter(id=64).update(comments_on=True) 1 \u003e\u003e\u003e Entry.objects.filter(slug='nonexistent-slug').update(comments_on=True) 0 \u003e\u003e\u003e Entry.objects.filter(pub_date__year=2010).update(comments_on=False) 132 å¦‚æœä½ åªæ˜¯æ›´æ–°ä¸€ä¸‹å¯¹è±¡ï¼Œä¸éœ€è¦ä¸ºå¯¹è±¡åšåˆ«çš„äº‹æƒ…ï¼Œæœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯è°ƒç”¨update()ï¼Œè€Œä¸æ˜¯å°†æ¨¡å‹å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ä¾‹å¦‚ï¼Œä¸è¦è¿™æ ·åšï¼š\n1 2 3 4 5 e = Entry.objects.get(id=10) e.comments_on = False e.save() å»ºè®®å¦‚ä¸‹æ“ä½œï¼š\nEntry.objects.filter(id=10).update(comments_on=False)\nç”¨update()è¿˜å¯ä»¥é˜²æ­¢åœ¨åŠ è½½å¯¹è±¡å’Œè°ƒç”¨save()ä¹‹é—´çš„çŸ­æ—¶é—´å†…æ•°æ®åº“ä¸­æŸäº›å†…å®¹å¯èƒ½å‘ç”Ÿæ›´æ”¹çš„ç«äº‰æ¡ä»¶ã€‚\nå¦‚æœæƒ³æ›´æ–°ä¸€ä¸ªå…·æœ‰è‡ªå®šä¹‰save()æ–¹æ³•çš„æ¨¡å‹çš„è®°å½•ï¼Œè¯·å¾ªç¯éå†å®ƒä»¬å¹¶è°ƒç”¨save()ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 for e in Entry.objects.filter(pub_date__year=2010): e.comments_on = False e.save() 16. delete() delete()\næ‰¹é‡åˆ é™¤QuerySetä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶è¿”å›åˆ é™¤çš„å¯¹è±¡ä¸ªæ•°å’Œæ¯ä¸ªå¯¹è±¡ç±»å‹çš„åˆ é™¤æ¬¡æ•°çš„å­—å…¸ã€‚\ndelete()åŠ¨ä½œæ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚\nä¸èƒ½åœ¨QuerySetä¸Šè°ƒç”¨delete()ã€‚\nä¾‹å¦‚ï¼Œè¦åˆ é™¤ç‰¹å®šåšå®¢ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼š\n1 2 3 4 5 b = Blog.objects.get(pk=1) # Delete all the entries belonging to this Blog. Entry.objects.filter(blog=b).delete() (4, {'weblog.Entry': 2, 'weblog.Entry_authors': 2}) é»˜è®¤æƒ…å†µä¸‹ï¼ŒDjangoçš„ForeignKeyä½¿ç”¨SQLçº¦æŸON DELETE CASCADEï¼Œä»»ä½•å…·æœ‰æŒ‡å‘è¦åˆ é™¤çš„å¯¹è±¡çš„å¤–é”®çš„å¯¹è±¡å°†ä¸å®ƒä»¬ä¸€èµ·è¢«åˆ é™¤ã€‚ åƒè¿™æ ·ï¼š\n1 2 3 4 5 blogs = Blog.objects.all() # This will delete all Blogs and all of their Entry objects. blogs.delete() (5, {'weblog.Blog': 1, 'weblog.Entry': 2, 'weblog.Entry_authors': 2}) è¿™ç§çº§è”çš„è¡Œä¸ºå¯ä»¥é€šè¿‡çš„ForeignKeyçš„on_deleteå‚æ•°è‡ªå®šä¹‰ã€‚ï¼ˆä»€ä¹ˆæ—¶å€™è¦æ”¹å˜è¿™ç§è¡Œä¸ºå‘¢ï¼Ÿæ¯”å¦‚æ—¥å¿—æ•°æ®ï¼Œå°±ä¸èƒ½å’Œå®ƒå…³è”çš„ä¸»ä½“ä¸€å¹¶è¢«åˆ é™¤ï¼ï¼‰\ndelete()ä¼šä¸ºæ‰€æœ‰å·²åˆ é™¤çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬çº§è”åˆ é™¤ï¼‰å‘å‡ºpre_deleteå’Œpost_deleteä¿¡å·ã€‚\n17. as_manager() classmethod as_manager()\nä¸€ä¸ªç±»æ–¹æ³•ï¼Œè¿”å›Managerçš„å®ä¾‹ä¸QuerySetçš„æ–¹æ³•çš„å‰¯æœ¬ ","wordCount":"12928","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Luenci"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luenci.me/en/posts/django%E7%9A%84queryset%E8%AF%A6%E8%A7%A3/"},"publisher":{"@type":"Organization","name":"Luenci","logo":{"@type":"ImageObject","url":"https://luenci.me/images/L.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luenci.me/en/ accesskey=h title="Luenci (Alt + H)"><img src=https://luenci.me/images/avatar.jpg alt aria-label=logo height=35>Luenci</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luenci.me/en/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://luenci.me/en/posts title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://luenci.me/en/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://luenci.me/en/archives title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://luenci.me/en/tags title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://luenci.me/en/about title=ğŸ™‹ğŸ»â€â™‚ï¸å…³äº><span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span></a></li><li><a href=https://luenci.me/en/links title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luenci.me/en/>Home</a>&nbsp;Â»&nbsp;<a href=https://luenci.me/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent"></h1><div class=post-meta>26 min&nbsp;Â·&nbsp;12928 words&nbsp;Â·&nbsp;Luenci</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80queryset%e4%bd%95%e6%97%b6%e8%a2%ab%e6%8f%90%e4%ba%a4 aria-label=ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤>ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤</a><ul><li><a href=#%e8%bf%ad%e4%bb%a3 aria-label=è¿­ä»£>è¿­ä»£</a></li><li><a href=#pickling%e7%bc%93%e5%ad%98 aria-label=Pickling/ç¼“å­˜>Pickling/ç¼“å­˜</a></li></ul></li><li><a href=#%e4%ba%8cqueryset aria-label=äºŒã€QuerySet>äºŒã€QuerySet</a></li><li><a href=#%e4%b8%89%e8%bf%94%e5%9b%9e%e6%96%b0querysets%e7%9a%84api aria-label=ä¸‰ã€è¿”å›æ–°QuerySetsçš„API>ä¸‰ã€è¿”å›æ–°QuerySetsçš„API</a><ul><li><a href=#%e6%96%b9%e6%b3%95%e5%90%8d-%e8%a7%a3%e9%87%8a aria-label="æ–¹æ³•å è§£é‡Š"><strong>æ–¹æ³•å è§£é‡Š</strong></a><ul><li><a href=#1-filter aria-label="1. filter()">1. filter()</a></li><li><a href=#2-exclude aria-label="2. exclude()">2. exclude()</a></li><li><a href=#3-annotate aria-label="3. annotate()">3. annotate()</a></li><li><a href=#4-order_by aria-label="4. order_by()">4. order_by()</a></li><li><a href=#5-reverse aria-label="5. reverse()">5. reverse()</a></li><li><a href=#6-distinct aria-label="6. distinct()">6. distinct()</a></li><li><a href=#7-values aria-label="7. values()">7. values()</a></li><li><a href=#8-values_list aria-label="8. values_list()">8. values_list()</a></li><li><a href=#9-dates aria-label="9. dates()">9. dates()</a></li><li><a href=#10-datetimes aria-label="10. datetimes()">10. datetimes()</a></li><li><a href=#11-none aria-label="11. none()">11. none()</a></li><li><a href=#12-all aria-label="12. all()">12. all()</a></li><li><a href=#13-union aria-label="13. union()">13. union()</a></li><li><a href=#14-intersection aria-label="14. intersection()">14. intersection()</a></li><li><a href=#15-difference aria-label="15. difference()">15. difference()</a></li><li><a href=#16-select_related aria-label="16. select_related()">16. select_related()</a></li><li><a href=#17-prefetch_related aria-label="17. prefetch_related()">17. prefetch_related()</a></li><li><a href=#18-extra aria-label="18. extra()">18. extra()</a></li><li><a href=#19-defer aria-label="19. defer()">19. defer()</a><ul><li><a href=#%e5%bb%b6%e8%bf%9fbody%e5%92%8cheadline%e4%b8%a4%e4%b8%aa%e5%ad%97%e6%ae%b5 aria-label=å»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µã€‚>å»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µã€‚</a></li><li><a href=#%e7%ab%8b%e5%8d%b3%e5%8a%a0%e8%bd%bd%e6%89%80%e6%9c%89%e7%9a%84%e5%ad%97%e6%ae%b5 aria-label=ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µã€‚>ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µã€‚</a></li></ul></li><li><a href=#20-only aria-label="20. only()">20. only()</a></li><li><a href=#21-using aria-label="21. using()">21. using()</a></li><li><a href=#22-select_for_update aria-label="22. select_for_update()">22. select_for_update()</a></li><li><a href=#23-raw aria-label="23. raw()">23. raw()</a></li></ul></li></ul></li><li><a href=#%e5%9b%9b%e4%b8%8d%e8%bf%94%e5%9b%9equerysets%e7%9a%84api aria-label=å››ã€ä¸è¿”å›QuerySetsçš„API>å››ã€ä¸è¿”å›QuerySetsçš„API</a><ul><li><a href=#%e6%96%b9%e6%b3%95%e5%90%8d-%e8%a7%a3%e9%87%8a-1 aria-label="æ–¹æ³•å è§£é‡Š"><strong>æ–¹æ³•å è§£é‡Š</strong></a><ul><li><a href=#1-get aria-label="1. get()">1. get()</a></li><li><a href=#2-create aria-label="2. create()">2. create()</a></li><li><a href=#3-get_or_create aria-label="3. get_or_create()">3. get_or_create()</a></li><li><a href=#4-update_or_create aria-label="4. update_or_create()">4. update_or_create()</a></li><li><a href=#5-bulk_create aria-label="5. bulk_create()">5. bulk_create()</a></li><li><a href=#6-count aria-label="6. count()">6. count()</a></li><li><a href=#7-in_bulk aria-label="7. in_bulk()">7. in_bulk()</a></li><li><a href=#8-iterator aria-label="8. iterator()">8. iterator()</a></li><li><a href=#9-latest aria-label="9. latest()">9. latest()</a></li><li><a href=#10-earliest aria-label="10. earliest()">10. earliest()</a></li><li><a href=#11-first aria-label="11. first()">11. first()</a></li><li><a href=#12-last aria-label="12. last()">12. last()</a></li><li><a href=#13-aggregate aria-label="13. aggregate()">13. aggregate()</a></li><li><a href=#14-exists aria-label="14. exists()">14. exists()</a></li><li><a href=#15-update aria-label="15. update()">15. update()</a></li><li><a href=#16-delete aria-label="16. delete()">16. delete()</a></li><li><a href=#17-as_manager aria-label="17. as_manager()">17. as_manager()</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«åš QuerySetã€‚</p><h1 id=ä¸€querysetä½•æ—¶è¢«æäº¤>ä¸€ã€QuerySetä½•æ—¶è¢«æäº¤<a hidden class=anchor aria-hidden=true href=#ä¸€querysetä½•æ—¶è¢«æäº¤>#</a></h1><ul><li>åœ¨å†…éƒ¨ï¼Œåˆ›å»ºã€è¿‡æ»¤ã€åˆ‡ç‰‡å’Œä¼ é€’ä¸€ä¸ªQuerySetä¸ä¼šçœŸå®æ“ä½œæ•°æ®åº“ï¼Œåœ¨ä½ å¯¹æŸ¥è¯¢é›†æäº¤ä¹‹å‰ï¼Œä¸ä¼šå‘ç”Ÿä»»ä½•å®é™…çš„æ•°æ®åº“æ“ä½œã€‚å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•å¯¹QuerySetæäº¤æŸ¥è¯¢æ“ä½œï¼š</li></ul><h2 id=è¿­ä»£>è¿­ä»£<a hidden class=anchor aria-hidden=true href=#è¿­ä»£>#</a></h2><ul><li>QuerySetæ˜¯å¯è¿­ä»£çš„ï¼Œåœ¨é¦–æ¬¡è¿­ä»£æŸ¥è¯¢é›†æ—¶æ‰§è¡Œå®é™…çš„æ•°æ®åº“æŸ¥è¯¢ã€‚ ä¾‹å¦‚ï¼Œ ä¸‹é¢çš„è¯­å¥ä¼šå°†æ•°æ®åº“ä¸­æ‰€æœ‰Entryçš„headlineæ‰“å°å‡ºæ¥ï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>for</span> e <span style=color:#ff7b72;font-weight:700>in</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>all():
</span></span><span style=display:flex><span>	print(e<span style=color:#ff7b72;font-weight:700>.</span>headline)
</span></span></code></pre></td></tr></table></div></div><ul><li>åˆ‡ç‰‡ï¼šå¦‚æœä½¿ç”¨åˆ‡ç‰‡çš„â€stepâ€œå‚æ•°ï¼ŒDjango å°†æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢å¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚</li></ul><h2 id=picklingç¼“å­˜>Pickling/ç¼“å­˜<a hidden class=anchor aria-hidden=true href=#picklingç¼“å­˜>#</a></h2><ul><li><p>repr()</p></li><li><p>len()ï¼šå½“ä½ å¯¹QuerySetè°ƒç”¨len()æ—¶ï¼Œ å°†æäº¤æ•°æ®åº“æ“ä½œã€‚</p></li><li><p>list()ï¼šå¯¹QuerySetè°ƒç”¨list()å°†å¼ºåˆ¶æäº¤æ“ä½œentry_list = list(Entry.objects.all())</p></li><li><p>bool()</p><ul><li><p>æµ‹è¯•å¸ƒå°”å€¼ï¼Œåƒè¿™æ ·ï¼š</p></li><li><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>if</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(headline<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Test&#34;</span>):
</span></span><span style=display:flex><span>  print(<span style=color:#a5d6ff>&#34;There is at least one Entry with the headline Test&#34;</span>)
</span></span></code></pre></td></tr></table></div></div></li></ul></li></ul><p>æ³¨ï¼šå¦‚æœä½ éœ€è¦çŸ¥é“æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€æ¡è®°å½•ï¼ˆè€Œä¸éœ€è¦çœŸå®çš„å¯¹è±¡ï¼‰ï¼Œä½¿ç”¨exists() å°†æ›´åŠ é«˜æ•ˆã€‚</p><h1 id=äºŒqueryset>äºŒã€QuerySet<a hidden class=anchor aria-hidden=true href=#äºŒqueryset>#</a></h1><p>ä¸‹é¢æ˜¯å¯¹äºQuerySetçš„æ­£å¼å®šä¹‰ï¼š</p><ul><li>class QuerySet(model=None, query=None, using=None)[source]</li></ul><p>QuerySetç±»å…·æœ‰ä¸¤ä¸ªå…¬æœ‰å±æ€§ç”¨äºå†…çœï¼š</p><ul><li><p>orderedï¼šå¦‚æœQuerySetæ˜¯æ’å¥½åºçš„åˆ™ä¸ºTrueï¼Œå¦åˆ™ä¸ºFalseã€‚</p></li><li><p>dbï¼šå¦‚æœç°åœ¨æ‰§è¡Œï¼Œåˆ™è¿”å›ä½¿ç”¨çš„æ•°æ®åº“ã€‚</p></li></ul><h1 id=ä¸‰è¿”å›æ–°querysetsçš„api>ä¸‰ã€è¿”å›æ–°QuerySetsçš„API<a hidden class=anchor aria-hidden=true href=#ä¸‰è¿”å›æ–°querysetsçš„api>#</a></h1><ul><li>ä»¥ä¸‹çš„æ–¹æ³•éƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„QuerySetsã€‚é‡ç‚¹æ˜¯åŠ ç²—çš„å‡ ä¸ªAPIï¼Œå…¶å®ƒçš„ä½¿ç”¨åœºæ™¯å¾ˆå°‘ã€‚</li></ul><h2 id=æ–¹æ³•å-è§£é‡Š><strong>æ–¹æ³•å è§£é‡Š</strong><a hidden class=anchor aria-hidden=true href=#æ–¹æ³•å-è§£é‡Š>#</a></h2><ul><li><p>filter() è¿‡æ»¤æŸ¥è¯¢å¯¹è±¡ã€‚</p></li><li><p>exclude() æ’é™¤æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡</p></li><li><p>annotate() ä½¿ç”¨èšåˆå‡½æ•°</p></li><li><p>order_by() å¯¹æŸ¥è¯¢é›†è¿›è¡Œæ’åº</p></li><li><p>reverse() åå‘æ’åº</p></li><li><p>distinct() å¯¹æŸ¥è¯¢é›†å»é‡</p></li><li><p>values() è¿”å›åŒ…å«å¯¹è±¡å…·ä½“å€¼çš„å­—å…¸çš„QuerySet</p></li><li><p>values_list() ä¸values()ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›çš„æ˜¯å…ƒç»„è€Œä¸æ˜¯å­—å…¸ã€‚</p></li><li><p>dates() æ ¹æ®æ—¥æœŸè·å–æŸ¥è¯¢é›†</p></li><li><p>datetimes() æ ¹æ®æ—¶é—´è·å–æŸ¥è¯¢é›†</p></li><li><p>none() åˆ›å»ºç©ºçš„æŸ¥è¯¢é›†</p></li><li><p>all() è·å–æ‰€æœ‰çš„å¯¹è±¡</p></li><li><p>union() å¹¶é›†</p></li><li><p>intersection() äº¤é›†</p></li><li><p>difference() å·®é›†</p></li><li><p>select_related() é™„å¸¦æŸ¥è¯¢å…³è”å¯¹è±¡</p></li><li><p>prefetch_related()é¢„å…ˆæŸ¥è¯¢</p></li><li><p>extra() é™„åŠ SQLæŸ¥è¯¢</p></li><li><p>defer() ä¸åŠ è½½æŒ‡å®šå­—æ®µ</p></li><li><p>only() åªåŠ è½½æŒ‡å®šçš„å­—æ®µ</p></li><li><p>using() é€‰æ‹©æ•°æ®åº“</p></li><li><p>select_for_update()é”ä½é€‰æ‹©çš„å¯¹è±¡ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚</p></li><li><p>raw() æ¥æ”¶ä¸€ä¸ªåŸå§‹çš„SQLæŸ¥è¯¢</p></li></ul><h3 id=1-filter>1. filter()<a hidden class=anchor aria-hidden=true href=#1-filter>#</a></h3><p><code>filter(**kwargs)</code></p><ul><li><p>è¿”å›æ»¡è¶³æŸ¥è¯¢å‚æ•°çš„å¯¹è±¡é›†åˆã€‚</p></li><li><p>æŸ¥æ‰¾çš„å‚æ•°ï¼ˆ**kwargsï¼‰åº”è¯¥æ»¡è¶³ä¸‹æ–‡å­—æ®µæŸ¥æ‰¾ä¸­çš„æ ¼å¼ã€‚å¤šä¸ªå‚æ•°ä¹‹é—´æ˜¯å’ŒANDçš„å…³ç³»ã€‚</p></li></ul><h3 id=2-exclude>2. exclude()<a hidden class=anchor aria-hidden=true href=#2-exclude>#</a></h3><p><code>exclude(**kwargs)</code></p><ul><li><p>è¿”å›ä¸€ä¸ªæ–°çš„<code>QuerySet</code>ï¼Œå®ƒåŒ…å«<code>ä¸æ»¡è¶³ç»™å®šçš„æŸ¥æ‰¾å‚æ•°çš„å¯¹è±¡</code>ã€‚</p></li><li><p>æŸ¥æ‰¾çš„å‚æ•°ï¼ˆ**kwargsï¼‰åº”è¯¥æ»¡è¶³ä¸‹æ–‡å­—æ®µæŸ¥æ‰¾ä¸­çš„æ ¼å¼ã€‚å¤šä¸ªå‚æ•°é€šè¿‡<code>ANDè¿æ¥</code>ï¼Œç„¶åæ‰€æœ‰çš„å†…å®¹æ”¾å…¥<code>NOT() </code>ä¸­ã€‚</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸‹é¢çš„ç¤ºä¾‹æ’é™¤æ‰€æœ‰pub_dateæ™šäº2005-1-3ä¸”headlineä¸ºâ€œHelloâ€ çš„è®°å½•ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>exclude(pub_date__gt<span style=color:#ff7b72;font-weight:700>=</span>[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>3</span>), headline<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Hello&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸‹é¢çš„ç¤ºä¾‹æ’é™¤æ‰€æœ‰pub_dateæ™šäº2005-1-3æˆ–è€…headline ä¸ºâ€œHelloâ€ çš„è®°å½•ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>exclude(pub_date__gt<span style=color:#ff7b72;font-weight:700>=</span>[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>3</span>))<span style=color:#ff7b72;font-weight:700>.</span>exclude(headline<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Hello&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=3-annotate>3. annotate()<a hidden class=anchor aria-hidden=true href=#3-annotate>#</a></h3><p><code>annotate(args, *kwargs)</code></p><ul><li><p>ä½¿ç”¨æä¾›çš„èšåˆè¡¨è¾¾å¼æŸ¥è¯¢å¯¹è±¡ã€‚</p></li><li><p>è¡¨è¾¾å¼å¯ä»¥æ˜¯ç®€å•çš„å€¼ã€å¯¹æ¨¡å‹ï¼ˆæˆ–ä»»ä½•å…³è”æ¨¡å‹ï¼‰ä¸Šçš„å­—æ®µçš„å¼•ç”¨æˆ–è€…èšåˆè¡¨è¾¾å¼ï¼ˆ<code>å¹³å‡å€¼ã€æ€»å’Œç­‰</code>ï¼‰ã€‚</p></li><li><p>annotate()çš„æ¯ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªannotationï¼Œå®ƒå°†æ·»åŠ åˆ°è¿”å›çš„QuerySetæ¯ä¸ªå¯¹è±¡ä¸­ã€‚</p></li><li><p>å…³é”®å­—å‚æ•°æŒ‡å®šçš„Annotationå°†ä½¿ç”¨å…³é”®å­—ä½œä¸ºAnnotation çš„åˆ«åã€‚ åŒ¿åå‚æ•°çš„åˆ«åå°†åŸºäºèšåˆå‡½æ•°çš„åç§°å’Œæ¨¡å‹çš„å­—æ®µç”Ÿæˆã€‚ åªæœ‰å¼•ç”¨å•ä¸ªå­—æ®µçš„èšåˆè¡¨è¾¾å¼æ‰å¯ä»¥ä½¿ç”¨åŒ¿åå‚æ•°ã€‚ å…¶å®ƒæ‰€æœ‰å½¢å¼éƒ½å¿…é¡»ç”¨å…³é”®å­—å‚æ•°ã€‚</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¾‹å¦‚ï¼Œå¦‚æœæ­£åœ¨æ“ä½œä¸€ä¸ªBlogåˆ—è¡¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æ¯ä¸ªBlogæœ‰å¤šå°‘Entryï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models</span> <span style=color:#ff7b72>import</span> Count
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> q <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>annotate(Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># The name of the first blog</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> q[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#39;Blogasaurus&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># The number of entries on the first blog</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> q[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>entry__count
</span></span><span style=display:flex><span><span style=color:#a5d6ff>42</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Blogæ¨¡å‹æœ¬èº«æ²¡æœ‰å®šä¹‰entry__countå±æ€§ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…³é”®å­—å‚æ•°æ¥æŒ‡å®šèšåˆå‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶Annotationçš„åç§°ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> q <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>annotate(number_of_entries<span style=color:#ff7b72;font-weight:700>=</span>Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># The number of entries on the first blog, using the name provided</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> q[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>number_of_entries
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>42</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-order_by>4. order_by()<a hidden class=anchor aria-hidden=true href=#4-order_by>#</a></h3><p><code>order_by(*fields)</code></p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¹æ®æ¨¡å‹çš„Metaç±»ä¸­çš„orderingå±æ€§å¯¹QuerySetä¸­çš„å¯¹è±¡è¿›è¡Œæ’åº</li></ul><p><code>Entry.objects.filter(pub_date__year=2005).order_by('-pub_date', 'headline')</code></p><ul><li><p>ä¸Šé¢çš„ç»“æœå°†æŒ‰ç…§pub_dateé™åºæ’åºï¼Œç„¶åå†æŒ‰ç…§headlineå‡åºæ’åºã€‚"-pub_date"å‰é¢çš„è´Ÿå·è¡¨ç¤ºé™åºé¡ºåºã€‚ å‡åºæ˜¯é»˜è®¤çš„ã€‚ è¦éšæœºæ’åºï¼Œä½¿ç”¨"?"ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p></li><li><p>Entry.objects.order_by(&rsquo;?')</p></li></ul><blockquote><p>æ³¨ï¼šorder_by(&rsquo;?&rsquo;)å¯èƒ½è€—è´¹èµ„æºä¸”å¾ˆæ…¢ï¼Œè¿™å–å†³äºä½¿ç”¨çš„æ•°æ®åº“ã€‚</p></blockquote><ul><li><p>è‹¥è¦æŒ‰ç…§å¦å¤–ä¸€ä¸ªæ¨¡å‹ä¸­çš„å­—æ®µæ’åºï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢å…³è”æ¨¡å‹çš„è¯­æ³•ã€‚å³é€šè¿‡å­—æ®µçš„åç§°åé¢è·Ÿä¸¤ä¸ªä¸‹åˆ’çº¿ï¼ˆ__ï¼‰ï¼Œå†åŠ ä¸Šæ–°æ¨¡å‹ä¸­çš„å­—æ®µçš„åç§°ï¼Œç›´åˆ°å¸Œæœ›è¿æ¥çš„æ¨¡å‹ã€‚ åƒè¿™æ ·ï¼š</p></li><li><p>Entry.objects.order_by(&lsquo;blog__name&rsquo;, &lsquo;headline&rsquo;)</p></li><li><p>å¦‚æœæ’åºçš„å­—æ®µä¸å¦å¤–ä¸€ä¸ªæ¨¡å‹å…³è”ï¼ŒDjangoå°†ä½¿ç”¨å…³è”çš„æ¨¡å‹çš„é»˜è®¤æ’åºï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰æŒ‡å®šMeta.orderingå°†é€šè¿‡å…³è”çš„æ¨¡å‹çš„ä¸»é”®æ’åºã€‚ ä¾‹å¦‚ï¼Œå› ä¸ºBlogæ¨¡å‹æ²¡æœ‰æŒ‡å®šé»˜è®¤çš„æ’åºï¼š</p></li><li><p>Entry.objects.order_by(&lsquo;blog&rsquo;)</p></li></ul><p>ä¸ä»¥ä¸‹ç›¸åŒï¼š</p><p><code>Entry.objects.order_by('blog__id')</code></p><ul><li><p>å¦‚æœBlogè®¾ç½®äº†ordering = [&rsquo;name&rsquo;]ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªQuerySetå°†ç­‰åŒäºï¼š</p></li><li><p>Entry.objects.order_by(&lsquo;blog__name&rsquo;)</p></li><li><p>è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨è¡¨è¾¾å¼çš„<code>desc()</code>æˆ–è€…<code>asc()</code>æ–¹æ³•ï¼š</p></li><li><p>Entry.objects.order_by(Coalesce(&lsquo;summary&rsquo;, &lsquo;headline&rsquo;).desc())</p></li></ul><p>è€ƒè™‘ä¸‹é¢çš„æƒ…å†µï¼ŒæŒ‡å®šä¸€ä¸ªå¤šå€¼å­—æ®µæ¥æ’åºï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªManyToManyField å­—æ®µæˆ–è€…ForeignKey å­—æ®µçš„åå‘å…³è”ï¼‰ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Event</span>(Model):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>parent <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>ForeignKey(
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#39;self&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on_delete<span style=color:#ff7b72;font-weight:700>=</span>models<span style=color:#ff7b72;font-weight:700>.</span>CASCADE,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>related_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;children&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>date <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>DateField()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Event<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>order_by(<span style=color:#a5d6ff>&#39;children__date&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><ul><li><p>åœ¨è¿™é‡Œï¼Œæ¯ä¸ªEventå¯èƒ½æœ‰å¤šä¸ªæ’åºæ•°æ®ï¼›å…·æœ‰å¤šä¸ªchildrençš„æ¯ä¸ªEventå°†è¢«å¤šæ¬¡è¿”å›åˆ°order_by()åˆ›å»ºçš„æ–°çš„QuerySetä¸­ã€‚ æ¢å¥è¯è¯´ï¼Œç”¨order_by()æ–¹æ³•å¯¹QuerySetå¯¹è±¡è¿›è¡Œæ“ä½œä¼šè¿”å›ä¸€ä¸ªæ‰©å¤§ç‰ˆçš„æ–°QuerySetå¯¹è±¡ã€‚å› æ­¤ï¼Œä½¿ç”¨å¤šå€¼å­—æ®µå¯¹ç»“æœè¿›è¡Œæ’åºæ—¶è¦æ ¼å¤–å°å¿ƒã€‚</p></li><li><p>æ²¡æœ‰æ–¹æ³•æŒ‡å®šæ’åºæ˜¯å¦è€ƒè™‘å¤§å°å†™ã€‚ å¯¹äºå¤§å°å†™çš„æ•æ„Ÿæ€§ï¼ŒDjangoå°†æ ¹æ®æ•°æ®åº“ä¸­çš„æ’åºæ–¹å¼æ’åºç»“æœã€‚</p></li><li><p>å¯ä»¥é€šè¿‡Lowerå°†ä¸€ä¸ªå­—æ®µè½¬æ¢ä¸ºå°å†™æ¥æ’åºï¼Œå®ƒå°†è¾¾åˆ°å¤§å°å†™ä¸€è‡´çš„æ’åºï¼š</p></li><li><p><code>Entry.objects.order_by(Lower('headline').desc())</code></p></li><li><p>å¯ä»¥é€šè¿‡æ£€æŸ¥QuerySet.orderedå±æ€§æ¥çŸ¥é“æŸ¥è¯¢æ˜¯å¦æ˜¯æ’åºçš„ã€‚</p></li><li><p>æ¯ä¸ª<code>order_by()</code>éƒ½å°†æ¸…é™¤å‰é¢çš„ä»»ä½•æ’åºã€‚ ä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢å°†æŒ‰ç…§pub_dateæ’åºï¼Œè€Œä¸æ˜¯headlineï¼š</p></li><li><p><code>Entry.objects.order_by('headline').order_by('pub_date')</code></p></li></ul><h3 id=5-reverse>5. reverse()<a hidden class=anchor aria-hidden=true href=#5-reverse>#</a></h3><p><code>reverse()</code></p><ul><li><p>åå‘æ’åºQuerySetä¸­è¿”å›çš„å…ƒç´ ã€‚ ç¬¬äºŒæ¬¡è°ƒç”¨reverse()å°†æ¢å¤åˆ°åŸæœ‰çš„æ’åºã€‚</p></li><li><p>å¦‚è¦è·å–QuerySetä¸­æœ€åäº”ä¸ªå…ƒç´ ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p></li><li><p>my_queryset.reverse()[:5]</p></li><li><p>è¿™ä¸Pythonç›´æ¥ä½¿ç”¨è´Ÿç´¢å¼•æœ‰ç‚¹ä¸ä¸€æ ·ã€‚ <code>Djangoä¸æ”¯æŒè´Ÿç´¢å¼•ï¼Œåªèƒ½æ›²çº¿æ•‘å›½</code>ã€‚</p></li></ul><h3 id=6-distinct>6. distinct()<a hidden class=anchor aria-hidden=true href=#6-distinct>#</a></h3><p><code>distinct(*fields)</code></p><ul><li><p>å»é™¤æŸ¥è¯¢ç»“æœä¸­é‡å¤çš„è¡Œã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒQuerySetä¸ä¼šå»é™¤é‡å¤çš„è¡Œã€‚å½“æŸ¥è¯¢è·¨è¶Šå¤šå¼ è¡¨çš„æ•°æ®æ—¶ï¼ŒQuerySetå¯èƒ½å¾—åˆ°é‡å¤çš„ç»“æœï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>distinct()</code>è¿›è¡Œå»é‡ã€‚</p></li></ul><h3 id=7-values>7. values()<a hidden class=anchor aria-hidden=true href=#7-values>#</a></h3><p><code>values(fields, *expressions)</code></p><ul><li><p>è¿”å›ä¸€ä¸ªåŒ…å«æ•°æ®çš„å­—å…¸çš„querysetï¼Œè€Œä¸æ˜¯æ¨¡å‹å®ä¾‹ã€‚</p></li><li><p>æ¯ä¸ªå­—å…¸è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œé”®å¯¹åº”äºæ¨¡å‹å¯¹è±¡çš„å±æ€§åç§°ã€‚</p></li></ul><p>ä¸‹é¢çš„ä¾‹å­å°†values() ä¸æ™®é€šçš„æ¨¡å‹å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åˆ—è¡¨ä¸­åŒ…å«çš„æ˜¯Blogå¯¹è±¡</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(name__startswith<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Beatles&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [<span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Beatles Blog<span style=color:#ff7b72;font-weight:700>&gt;</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åˆ—è¡¨ä¸­åŒ…å«çš„æ˜¯æ•°æ®å­—å…¸</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(name__startswith<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Beatles&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>values()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;id&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;Beatles Blog&#39;</span>, <span style=color:#a5d6ff>&#39;tagline&#39;</span>: <span style=color:#a5d6ff>&#39;All the latest Beatles news.&#39;</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>è¯¥æ–¹æ³•æ¥æ”¶å¯é€‰çš„ä½ç½®å‚æ•°<span style=color:#ff7b72;font-weight:700>*</span>fields<span style=color:#f85149>ï¼Œ</span>å®ƒæŒ‡å®švalues()åº”è¯¥é™åˆ¶å“ªäº›å­—æ®µ<span style=color:#f85149>ã€‚</span>å¦‚æœæŒ‡å®šå­—æ®µ<span style=color:#f85149>ï¼Œ</span>æ¯ä¸ªå­—å…¸å°†åªåŒ…å«æŒ‡å®šçš„å­—æ®µçš„é”®<span style=color:#ff7b72;font-weight:700>/</span>å€¼<span style=color:#f85149>ã€‚</span>å¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µ<span style=color:#f85149>ï¼Œ</span>æ¯ä¸ªå­—å…¸å°†åŒ…å«æ•°æ®åº“è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„é”®å’Œå€¼<span style=color:#f85149>ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ä¾‹å¦‚<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;id&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;Beatles Blog&#39;</span>, <span style=color:#a5d6ff>&#39;tagline&#39;</span>: <span style=color:#a5d6ff>&#39;All the latest Beatles news.&#39;</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;id&#39;</span>, <span style=color:#a5d6ff>&#39;name&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;id&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;Beatles Blog&#39;</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>values()æ–¹æ³•è¿˜æœ‰å…³é”®å­—å‚æ•°<span style=color:#ff7b72;font-weight:700>**</span>expressions<span style=color:#f85149>ï¼Œ</span>è¿™äº›å‚æ•°å°†ä¼ é€’ç»™annotate()<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models.functions</span> <span style=color:#ff7b72>import</span> Lower
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(lower_name<span style=color:#ff7b72;font-weight:700>=</span>Lower(<span style=color:#a5d6ff>&#39;name&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;lower_name&#39;</span>: <span style=color:#a5d6ff>&#39;beatles blog&#39;</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>åœ¨values()å­å¥ä¸­çš„èšåˆåº”ç”¨äºç›¸åŒvalues()å­å¥ä¸­çš„å…¶ä»–å‚æ•°ä¹‹å‰<span style=color:#f85149>ã€‚</span> å¦‚æœéœ€è¦æŒ‰å¦ä¸€ä¸ªå€¼åˆ†ç»„<span style=color:#f85149>ï¼Œ</span>è¯·å°†å…¶æ·»åŠ åˆ°è¾ƒæ—©çš„values()å­å¥ä¸­<span style=color:#f85149>ã€‚</span> åƒè¿™æ ·<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models</span> <span style=color:#ff7b72>import</span> Count
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;author&#39;</span>, entries<span style=color:#ff7b72;font-weight:700>=</span>Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;author&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;entries&#39;</span>: <span style=color:#a5d6ff>20</span>}, {<span style=color:#a5d6ff>&#39;author&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;entries&#39;</span>: <span style=color:#a5d6ff>13</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;author&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>annotate(entries<span style=color:#ff7b72;font-weight:700>=</span>Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;author&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;entries&#39;</span>: <span style=color:#a5d6ff>33</span>}]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>æ³¨æ„<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>å¦‚æœä½ æœ‰ä¸€ä¸ªå­—æ®µfooæ˜¯ä¸€ä¸ªForeignKey<span style=color:#f85149>ï¼Œ</span>é»˜è®¤çš„foo_idå‚æ•°è¿”å›çš„å­—å…¸ä¸­å°†æœ‰ä¸€ä¸ªå«åšfoo çš„é”®<span style=color:#f85149>ï¼Œ</span>å› ä¸ºè¿™æ˜¯ä¿å­˜å®é™…å€¼çš„é‚£ä¸ªéšè—çš„æ¨¡å‹å±æ€§çš„åç§°<span style=color:#f85149>ã€‚</span> å½“è°ƒç”¨foo_idå¹¶ä¼ é€’å­—æ®µçš„åç§°<span style=color:#f85149>ï¼Œ</span>ä¼ é€’foo æˆ–values()éƒ½å¯ä»¥<span style=color:#f85149>ï¼Œ</span>å¾—åˆ°çš„ç»“æœæ˜¯ç›¸åŒçš„<span style=color:#f85149>ã€‚</span>åƒè¿™æ ·<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;blog_id&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;headline&#39;</span>: <span style=color:#a5d6ff>&#39;First Entry&#39;</span>, <span style=color:#ff7b72;font-weight:700>...</span>}, <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;blog&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;blog&#39;</span>: <span style=color:#a5d6ff>1</span>}, <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;blog_id&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;blog_id&#39;</span>: <span style=color:#a5d6ff>1</span>}, <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å½“values()ä¸distinct()ä¸€èµ·ä½¿ç”¨æ—¶<span style=color:#f85149>ï¼Œ</span>æ³¨æ„æ’åºå¯èƒ½å½±å“æœ€ç»ˆçš„ç»“æœ<span style=color:#f85149>ã€‚</span>
</span></span><span style=display:flex><span>å¦‚æœvalues()å­å¥ä½äºextra()è°ƒç”¨ä¹‹å<span style=color:#f85149>ï¼Œ</span>extra()ä¸­çš„selectå‚æ•°å®šä¹‰çš„å­—æ®µå¿…é¡»æ˜¾å¼åŒ…å«åœ¨values()è°ƒç”¨ä¸­<span style=color:#f85149>ã€‚</span> values( è°ƒç”¨åé¢çš„extra( è°ƒç”¨å°†å¿½ç•¥é€‰æ‹©çš„é¢å¤–çš„å­—æ®µ<span style=color:#f85149>ã€‚</span>åœ¨values()ä¹‹åè°ƒç”¨only()å’Œdefer()ä¸å¤ªåˆç†<span style=color:#f85149>ï¼Œ</span>æ‰€ä»¥å°†å¼•å‘ä¸€ä¸ªNotImplementedError<span style=color:#f85149>ã€‚</span>å¯ä»¥é€šè¿‡ManyToManyField<span style=color:#f85149>ã€</span>ForeignKey å’Œ OneToOneFiel å±æ€§åå‘å¼•ç”¨å…³è”çš„æ¨¡å‹çš„å­—æ®µ<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values(<span style=color:#a5d6ff>&#39;name&#39;</span>, <span style=color:#a5d6ff>&#39;entry__headline&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [{<span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;My blog&#39;</span>, <span style=color:#a5d6ff>&#39;entry__headline&#39;</span>: <span style=color:#a5d6ff>&#39;An entry&#39;</span>},{<span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;My blog&#39;</span>, <span style=color:#a5d6ff>&#39;entry__headline&#39;</span>: <span style=color:#a5d6ff>&#39;Another entry&#39;</span>}, <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=8-values_list>8. values_list()<a hidden class=anchor aria-hidden=true href=#8-values_list>#</a></h3><p><code>values_list(*fields, flat=False)</code></p><ul><li>ä¸values()ç±»ä¼¼ï¼Œåªæ˜¯åœ¨è¿­ä»£æ—¶è¿”å›çš„æ˜¯å…ƒç»„è€Œä¸æ˜¯å­—å…¸ã€‚æ¯ä¸ªå…ƒç»„åŒ…å«ä¼ é€’ç»™values_list()è°ƒç”¨çš„ç›¸åº”å­—æ®µæˆ–è¡¨è¾¾å¼çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µç­‰ã€‚ åƒè¿™æ ·ï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;id&#39;</span>, <span style=color:#a5d6ff>&#39;headline&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [(<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;First entry&#39;</span>), <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models.functions</span> <span style=color:#ff7b72>import</span> Lower
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;id&#39;</span>, Lower(<span style=color:#a5d6ff>&#39;headline&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [(<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;first entry&#39;</span>), <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>å¦‚æœåªä¼ é€’ä¸€ä¸ªå­—æ®µï¼Œè¿˜å¯ä»¥ä¼ é€’<code>flat</code>å‚æ•°ã€‚ å¦‚æœä¸ºTrueï¼Œå®ƒè¡¨ç¤ºè¿”å›çš„ç»“æœä¸ºå•ä¸ªå€¼è€Œä¸æ˜¯å…ƒç»„ã€‚ å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>order_by(<span style=color:#a5d6ff>&#39;id&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet[(<span style=color:#a5d6ff>1</span>,), (<span style=color:#a5d6ff>2</span>,), (<span style=color:#a5d6ff>3</span>,), <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;id&#39;</span>, flat<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)<span style=color:#ff7b72;font-weight:700>.</span>order_by(<span style=color:#a5d6ff>&#39;id&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#ff7b72;font-weight:700>...</span>]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>å¦‚æœæœ‰å¤šä¸ªå­—æ®µï¼Œä¼ é€’flatå°†å‘ç”Ÿé”™è¯¯ã€‚</p></li><li><p>å¦‚æœä¸ä¼ é€’ä»»ä½•å€¼ç»™values_list()ï¼Œå®ƒå°†è¿”å›æ¨¡å‹ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œä»¥åœ¨æ¨¡å‹ä¸­å®šä¹‰çš„é¡ºåºã€‚</p></li><li><p>å¸¸è§çš„æƒ…å†µæ˜¯è·å–æŸä¸ªæ¨¡å‹å®ä¾‹çš„ç‰¹å®šå­—æ®µå€¼ã€‚å¯ä»¥ä½¿ç”¨values_list()ï¼Œç„¶åè°ƒç”¨get()ï¼š</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;headline&#39;</span>, flat<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)<span style=color:#ff7b72;font-weight:700>.</span>get(pk<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#39;First entry&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>values()å’Œvalues_list()éƒ½ç”¨äºç‰¹å®šæƒ…å†µä¸‹çš„ä¼˜åŒ–ï¼šæ£€ç´¢æ•°æ®å­é›†ï¼Œè€Œæ— éœ€åˆ›å»ºæ¨¡å‹å®ä¾‹ã€‚</li><li>æ³¨æ„é€šè¿‡ManyToManyFieldè¿›è¡ŒæŸ¥è¯¢æ—¶çš„è¡Œä¸ºï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Author<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;name&#39;</span>, <span style=color:#a5d6ff>&#39;entry__headline&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [(<span style=color:#a5d6ff>&#39;Noam Chomsky&#39;</span>, <span style=color:#a5d6ff>&#39;Impressions of Gaza&#39;</span>),(<span style=color:#a5d6ff>&#39;George Orwell&#39;</span>, <span style=color:#a5d6ff>&#39;Why Socialists Do Not Believe in Fun&#39;</span>),
</span></span><span style=display:flex><span>(<span style=color:#a5d6ff>&#39;George Orwell&#39;</span>, <span style=color:#a5d6ff>&#39;In Defence of English Cooking&#39;</span>),(<span style=color:#a5d6ff>&#39;Don Quixote&#39;</span>, <span style=color:#79c0ff>None</span>)]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç±»ä¼¼åœ°ï¼Œå½“æŸ¥è¯¢åå‘å¤–é”®æ—¶ï¼Œå¯¹äºæ²¡æœ‰ä»»ä½•ä½œè€…çš„æ¡ç›®ï¼Œè¿”å›Noneã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>values_list(<span style=color:#a5d6ff>&#39;authors&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet [(<span style=color:#a5d6ff>&#39;Noam Chomsky&#39;</span>,), (<span style=color:#a5d6ff>&#39;George Orwell&#39;</span>,), (<span style=color:#79c0ff>None</span>,)]<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=9-dates>9. dates()<a hidden class=anchor aria-hidden=true href=#9-dates>#</a></h3><p><code>dates(field, kind, order='ASC')</code></p><ul><li><p>è¿”å›ä¸€ä¸ªQuerySetï¼Œè¡¨ç¤ºQuerySetå†…å®¹ä¸­ç‰¹å®šç±»å‹çš„æ‰€æœ‰å¯ç”¨æ—¥æœŸçš„datetime.dateå¯¹è±¡åˆ—è¡¨ã€‚</p></li><li><p>fieldå‚æ•°æ˜¯æ¨¡å‹çš„DateFieldçš„åç§°ã€‚ kindå‚æ•°åº”ä¸º"year"ï¼Œ&ldquo;month"æˆ–"day&rdquo;ã€‚ ç»“æœåˆ—è¡¨ä¸­çš„æ¯ä¸ªdatetime.dateå¯¹è±¡è¢«æˆªå–ä¸ºç»™å®šçš„ç±»å‹ã€‚</p></li><li><p>&ldquo;year&rdquo; è¿”å›å¯¹åº”è¯¥fieldçš„æ‰€æœ‰ä¸åŒå¹´ä»½å€¼çš„åˆ—è¡¨ã€‚</p></li><li><p>&ldquo;month"è¿”å›å­—æ®µçš„æ‰€æœ‰ä¸åŒå¹´/æœˆå€¼çš„åˆ—è¡¨ã€‚</p></li><li><p>&ldquo;day"è¿”å›å­—æ®µçš„æ‰€æœ‰ä¸åŒå¹´/æœˆ/æ—¥å€¼çš„åˆ—è¡¨ã€‚</p></li><li><p>orderå‚æ•°é»˜è®¤ä¸º&rsquo;ASC&rsquo;ï¼Œæˆ–è€…&rsquo;DESC&rsquo;ã€‚ å®ƒæŒ‡å®šå¦‚ä½•æ’åºç»“æœã€‚</p></li></ul><p>ä¾‹å­ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>dates(<span style=color:#a5d6ff>&#39;pub_date&#39;</span>, <span style=color:#a5d6ff>&#39;year&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>1</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>dates(<span style=color:#a5d6ff>&#39;pub_date&#39;</span>, <span style=color:#a5d6ff>&#39;month&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>1</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>dates(<span style=color:#a5d6ff>&#39;pub_date&#39;</span>, <span style=color:#a5d6ff>&#39;day&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>20</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>dates(<span style=color:#a5d6ff>&#39;pub_date&#39;</span>, <span style=color:#a5d6ff>&#39;day&#39;</span>, order<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;DESC&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>20</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(headline__contains<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>dates(<span style=color:#a5d6ff>&#39;pub_date&#39;</span>, <span style=color:#a5d6ff>&#39;day&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[[datetime<span style=color:#ff7b72;font-weight:700>.</span>date](<span style=color:#a5d6ff>2005</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>20</span>)]
</span></span></code></pre></td></tr></table></div></div><h3 id=10-datetimes>10. datetimes()<a hidden class=anchor aria-hidden=true href=#10-datetimes>#</a></h3><p><code>datetimes(field_name, kind, order='ASC', tzinfo=None)</code></p><ul><li><p>è¿”å›QuerySetï¼Œä¸ºdatetime.datetimeå¯¹è±¡çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºQuerySetå†…å®¹ä¸­ç‰¹å®šç§ç±»çš„æ‰€æœ‰å¯ç”¨æ—¥æœŸã€‚</p></li><li><p>field_nameåº”ä¸ºæ¨¡å‹çš„DateTimeFieldçš„åç§°ã€‚</p></li><li><p>kindå‚æ•°åº”ä¸º"hour&rdquo;ï¼Œ&ldquo;minute&rdquo;ï¼Œ&ldquo;month&rdquo;ï¼Œ&ldquo;year&rdquo;ï¼Œ&ldquo;second"æˆ–"day&rdquo;ã€‚</p></li><li><p>ç»“æœåˆ—è¡¨ä¸­çš„æ¯ä¸ªdatetime.datetimeå¯¹è±¡è¢«æˆªå–åˆ°ç»™å®šçš„ç±»å‹ã€‚</p></li><li><p>orderå‚æ•°é»˜è®¤ä¸º&rsquo;ASC&rsquo;ï¼Œæˆ–è€…&rsquo;DESC&rsquo;ã€‚ å®ƒæŒ‡å®šå¦‚ä½•æ’åºç»“æœã€‚</p></li><li><p>tzinfoå‚æ•°å®šä¹‰åœ¨æˆªå–ä¹‹å‰å°†æ•°æ®æ—¶é—´è½¬æ¢åˆ°çš„æ—¶åŒºã€‚</p></li></ul><h3 id=11-none>11. none()<a hidden class=anchor aria-hidden=true href=#11-none>#</a></h3><p><code>none()</code></p><ul><li>è°ƒç”¨none()å°†åˆ›å»ºä¸€ä¸ªä¸è¿”å›ä»»ä½•å¯¹è±¡çš„æŸ¥è¯¢é›†ï¼Œå¹¶ä¸”åœ¨è®¿é—®ç»“æœæ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•æŸ¥è¯¢ã€‚</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ä¾‹å­<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>none()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>QuerySet []<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models.query</span> <span style=color:#ff7b72>import</span> EmptyQuerySet
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> isinstance(Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>none(), EmptyQuerySet)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>True</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=12-all>12. all()<a hidden class=anchor aria-hidden=true href=#12-all>#</a></h3><p><code>all()</code></p><ul><li>è¿”å›å½“å‰QuerySetï¼ˆæˆ–QuerySetå­ç±»ï¼‰çš„å‰¯æœ¬ã€‚é€šå¸¸ç”¨äºè·å–å…¨éƒ¨QuerySetå¯¹è±¡ã€‚</li></ul><h3 id=13-union>13. union()<a hidden class=anchor aria-hidden=true href=#13-union>#</a></h3><p><code>union(*other_qs, all=False)</code></p><ul><li><p>Djangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­å¹¶é›†çš„æ¦‚å¿µï¼</p></li><li><p>ä½¿ç”¨SQLçš„UNIONè¿ç®—ç¬¦ç»„åˆä¸¤ä¸ªæˆ–æ›´å¤šä¸ªQuerySetçš„ç»“æœã€‚ä¾‹å¦‚ï¼š</p></li></ul><p><code>qs1.union(qs2, qs3)</code></p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒUNIONæ“ä½œç¬¦ä»…é€‰æ‹©ä¸åŒçš„å€¼ã€‚ è¦å…è®¸é‡å¤å€¼ï¼Œè¯·ä½¿ç”¨all=Trueå‚æ•°ã€‚</li></ul><h3 id=14-intersection>14. intersection()<a hidden class=anchor aria-hidden=true href=#14-intersection>#</a></h3><ul><li><p>intersection(*other_qs)</p></li><li><p>Djangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­<code>äº¤é›†</code>çš„æ¦‚å¿µï¼</p></li><li><p>ä½¿ç”¨SQLçš„INTERSECTè¿ç®—ç¬¦è¿”å›ä¸¤ä¸ªæˆ–æ›´å¤šä¸ªQuerySetçš„å…±æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p></li></ul><p><code>qs1.intersection(qs2, qs3)</code></p><h3 id=15-difference>15. difference()<a hidden class=anchor aria-hidden=true href=#15-difference>#</a></h3><p><code>difference(*other_qs)</code></p><ul><li><p>Djangoä¸­çš„æ–°åŠŸèƒ½1.11ã€‚ä¹Ÿå°±æ˜¯é›†åˆä¸­<code>å·®é›†</code>çš„æ¦‚å¿µï¼</p></li><li><p>ä½¿ç”¨SQLçš„EXCEPTè¿ç®—ç¬¦åªä¿ç•™QuerySetä¸­çš„å…ƒç´ ï¼Œä½†ä¸ä¿ç•™å…¶ä»–QuerySetä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p></li></ul><p><code>qs1.difference(qs2, qs3)</code></p><h3 id=16-select_related>16. select_related()<a hidden class=anchor aria-hidden=true href=#16-select_related>#</a></h3><p><code>select_related(*fields)</code></p><ul><li><p>æ²¿ç€å¤–é”®å…³ç³»æŸ¥è¯¢å…³è”çš„å¯¹è±¡çš„æ•°æ®ã€‚è¿™ä¼šç”Ÿæˆä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢å¹¶å¼•èµ·æ€§èƒ½çš„æŸè€—ï¼Œä½†æ˜¯åœ¨ä»¥åä½¿ç”¨å¤–é”®å…³ç³»æ—¶å°†ä¸éœ€è¦å†æ¬¡æ•°æ®åº“æŸ¥è¯¢ã€‚</p></li><li><p>ä¸‹é¢çš„ä¾‹å­è§£é‡Šäº†æ™®é€šæŸ¥è¯¢å’Œselect_related()æŸ¥è¯¢çš„åŒºåˆ«ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æŸ¥è¯¢ï¼š</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è®¿é—®æ•°æ®åº“ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e <span style=color:#ff7b72;font-weight:700>=</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å†æ¬¡è®¿é—®æ•°æ®åº“ä»¥å¾—åˆ°å…³è”çš„Blogå¯¹è±¡ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b <span style=color:#ff7b72;font-weight:700>=</span> [e<span style=color:#ff7b72;font-weight:700>.</span>blog]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ä¸‹é¢æ˜¯ä¸€ä¸ªselect_relatedæŸ¥è¯¢<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è®¿é—®æ•°æ®åº“ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e <span style=color:#ff7b72;font-weight:700>=</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>select_related(<span style=color:#a5d6ff>&#39;blog&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸ä¼šè®¿é—®æ•°æ®åº“ï¼Œå› ä¸ºe.blogå·²ç»åœ¨å‰é¢çš„æŸ¥è¯¢ä¸­è·å¾—äº†ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b <span style=color:#ff7b72;font-weight:700>=</span> [e<span style=color:#ff7b72;font-weight:700>.</span>blog]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>select_related()å¯ç”¨äºobjectsä»»ä½•çš„æŸ¥è¯¢é›†<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.utils</span> <span style=color:#ff7b72>import</span> timezone
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Find all the blogs with entries scheduled to be published in the future.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>blogs <span style=color:#ff7b72;font-weight:700>=</span> set()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> e <span style=color:#ff7b72;font-weight:700>in</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(pub_date__gt<span style=color:#ff7b72;font-weight:700>=</span>[timezone<span style=color:#ff7b72;font-weight:700>.</span>now]())<span style=color:#ff7b72;font-weight:700>.</span>select_related(<span style=color:#a5d6ff>&#39;blog&#39;</span>):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ²¡æœ‰select_related()ï¼Œä¸‹é¢çš„è¯­å¥å°†ä¸ºæ¯æ¬¡å¾ªç¯è¿­ä»£ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢,ä»¥è·å¾—æ¯ä¸ªentryå…³è”çš„blogã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>blogs<span style=color:#ff7b72;font-weight:700>.</span>add([e<span style=color:#ff7b72;font-weight:700>.</span>blog])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filter()å’Œselect_related()çš„é¡ºåºä¸é‡è¦<span style=color:#f85149>ã€‚</span> ä¸‹é¢çš„æŸ¥è¯¢é›†æ˜¯ç­‰åŒçš„<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(pub_date__gt<span style=color:#ff7b72;font-weight:700>=</span>[timezone<span style=color:#ff7b72;font-weight:700>.</span>now]<span style=color:#ff7b72;font-weight:700>.</span>select_related(<span style=color:#a5d6ff>&#39;blog&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>select_related(<span style=color:#a5d6ff>&#39;blog&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>filter(pub_date__gt<span style=color:#ff7b72;font-weight:700>=</span>[timezone<span style=color:#ff7b72;font-weight:700>.</span>now]())
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥æ²¿ç€å¤–é”®æŸ¥è¯¢ã€‚ å¦‚æœæœ‰ä»¥ä¸‹æ¨¡å‹ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>from django.db import models
</span></span><span style=display:flex><span>class City(models.Model):
</span></span><span style=display:flex><span>    # ...
</span></span><span style=display:flex><span>    pass
</span></span><span style=display:flex><span>class Person(models.Model):
</span></span><span style=display:flex><span>    # ...
</span></span><span style=display:flex><span>    hometown = models.ForeignKey(
</span></span><span style=display:flex><span>        City,
</span></span><span style=display:flex><span>        on_delete=models.SET_NULL,
</span></span><span style=display:flex><span>        blank=True,
</span></span><span style=display:flex><span>        null=True,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>class Book(models.Model):
</span></span><span style=display:flex><span>    # ...
</span></span><span style=display:flex><span>    author = models.ForeignKey(Person, on_delete=models.CASCADE)
</span></span></code></pre></td></tr></table></div></div><p>è°ƒç”¨Book.objects.select_related(&lsquo;author__hometown&rsquo;).get(id=4)å°†ç¼“å­˜ç›¸å…³çš„Person å’Œç›¸å…³çš„Cityï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>b <span style=color:#ff7b72;font-weight:700>=</span> Book<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>select_related(<span style=color:#a5d6ff>&#39;author__hometown&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#ff7b72;font-weight:700>=</span> [b<span style=color:#ff7b72;font-weight:700>.</span>author] <span style=color:#8b949e;font-style:italic># Doesn&#39;t hit the database.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c <span style=color:#ff7b72;font-weight:700>=</span> p<span style=color:#ff7b72;font-weight:700>.</span>hometown <span style=color:#8b949e;font-style:italic># Doesn&#39;t hit the database.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b <span style=color:#ff7b72;font-weight:700>=</span> Book<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span>) <span style=color:#8b949e;font-style:italic># No select_related() in this example.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p <span style=color:#ff7b72;font-weight:700>=</span> [b<span style=color:#ff7b72;font-weight:700>.</span>author] <span style=color:#8b949e;font-style:italic># Hits the database.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c <span style=color:#ff7b72;font-weight:700>=</span> p<span style=color:#ff7b72;font-weight:700>.</span>hometown <span style=color:#8b949e;font-style:italic># Hits the database.</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>åœ¨ä¼ é€’ç»™select_related()çš„å­—æ®µä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>ä»»ä½•ForeignKey</code>å’Œ<code>OneToOneField</code>ã€‚</p></li><li><p>åœ¨ä¼ é€’ç»™select_related()çš„å­—æ®µä¸­ï¼Œè¿˜å¯ä»¥åå‘å¼•ç”¨OneToOneFieldã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å›æº¯åˆ°å®šä¹‰OneToOneField çš„å­—æ®µã€‚ æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³è”å¯¹è±¡å­—æ®µçš„related_nameï¼Œè€Œä¸è¦æŒ‡å®šå­—æ®µçš„åç§°ã€‚</p></li></ul><h3 id=17-prefetch_related>17. prefetch_related()<a hidden class=anchor aria-hidden=true href=#17-prefetch_related>#</a></h3><p><code>prefetch_related(*lookups)</code></p><ul><li><p>åœ¨å•ä¸ªæ‰¹å¤„ç†ä¸­è‡ªåŠ¨æ£€ç´¢æ¯ä¸ªæŒ‡å®šæŸ¥æ‰¾çš„ç›¸å…³å¯¹è±¡ã€‚</p></li><li><p>ä¸select_relatedç±»ä¼¼ï¼Œä½†æ˜¯ç­–ç•¥æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p></li></ul><p>å‡è®¾æœ‰è¿™äº›æ¨¡å‹ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>from django.db import models
</span></span><span style=display:flex><span>class weightping(models.Model):
</span></span><span style=display:flex><span>    name = models.CharField(max_length=30)
</span></span><span style=display:flex><span>class Pizza(models.Model):
</span></span><span style=display:flex><span>    name = models.CharField(max_length=50)
</span></span><span style=display:flex><span>    weightpings = models.ManyToManyField(weightping)
</span></span><span style=display:flex><span>    def __str__(self):              # __unicode__ on Python 2
</span></span><span style=display:flex><span>        return &#34;%s (%s)&#34; % (
</span></span><span style=display:flex><span>            self.name,
</span></span><span style=display:flex><span>            &#34;, &#34;.join(weightping.name for weightping in self.weightpings.all()),
</span></span><span style=display:flex><span>        )
</span></span></code></pre></td></tr></table></div></div><p>å¹¶è¿è¡Œï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Pizza<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>all()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a5d6ff>&#34;Hawaiian (ham, pineapple)&#34;</span>, <span style=color:#a5d6ff>&#34;Seafood (prawns, smoked salmon)&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>é—®é¢˜æ˜¯æ¯æ¬¡QuerySetè¦æ±‚Pizza.objects.all()æŸ¥è¯¢æ•°æ®åº“ï¼Œå› æ­¤<code>self.weightpings.all()</code>å°†åœ¨<code>Pizza Pizza.__str__()</code>ä¸­çš„æ¯ä¸ªé¡¹ç›®çš„<code>weightpings</code>è¡¨ä¸Šè¿è¡ŒæŸ¥è¯¢ã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨prefetch_relatedå‡å°‘ä¸ºåªæœ‰ä¸¤ä¸ªæŸ¥è¯¢ï¼š</p></li></ul><p><code>Pizza.objects.all().prefetch_related('weightpings')</code></p><ul><li><p>è¿™æ„å‘³ç€ç°åœ¨æ¯æ¬¡<code>self.weightpings.all()</code>è¢«è°ƒç”¨ï¼Œä¸ä¼šå†å»æ•°æ®åº“æŸ¥æ‰¾ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªé¢„å–çš„QuerySetç¼“å­˜ä¸­æŸ¥æ‰¾ã€‚</p></li><li><p>è¿˜å¯ä»¥ä½¿ç”¨æ­£å¸¸è¿æ¥è¯­æ³•æ¥æ‰§è¡Œç›¸å…³å­—æ®µçš„ç›¸å…³å­—æ®µã€‚ å‡è®¾åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å¢åŠ ä¸€ä¸ªé¢å¤–çš„æ¨¡å‹ï¼š</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Restaurant</span>(models<span style=color:#ff7b72;font-weight:700>.</span>Model):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	pizzas <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>ManyToManyField(Pizza, related_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;restaurants&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	best_pizza <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>ForeignKey(Pizza, related_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;championed_by&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><p>ä»¥ä¸‹æ˜¯åˆæ³•çš„ï¼š</p><p><code>Restaurant.objects.prefetch_related('pizzas__weightpings')</code></p><ul><li>è¿™å°†é¢„å–æ‰€æœ‰å±äºé¤å…çš„æ¯”è¨é¥¼ï¼Œå’Œæ‰€æœ‰å±äºé‚£äº›æ¯”è¨é¥¼çš„é…æ–™ã€‚ è¿™å°†å¯¼è‡´æ€»å…±3ä¸ªæŸ¥è¯¢ - ä¸€ä¸ªç”¨äºé¤é¦†ï¼Œä¸€ä¸ªç”¨äºæ¯”è¨é¥¼ï¼Œä¸€ä¸ªç”¨äºé…æ–™ã€‚</li></ul><p><code>Restaurant.objects.prefetch_related('best_pizza__weightpings')</code></p><ul><li><p>è¿™å°†è·å–æœ€å¥½çš„æ¯”è¨é¥¼å’Œæ¯ä¸ªé¤å…æœ€å¥½çš„æŠ«è¨çš„æ‰€æœ‰é…æ–™ã€‚ è¿™å°†åœ¨3ä¸ªè¡¨ä¸­æŸ¥è¯¢ - ä¸€ä¸ªä¸ºé¤å…ï¼Œä¸€ä¸ªä¸ºâ€œæœ€ä½³æ¯”è¨é¥¼â€ï¼Œä¸€ä¸ªä¸ºé…æ–™ã€‚</p></li><li><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨best_pizzaæ¥è·å–select_relatedå…³ç³»ï¼Œä»¥å°†æŸ¥è¯¢æ•°å‡å°‘ä¸º2ï¼š</p></li></ul><p><code>Restaurant.objects.select_related('best_pizza').prefetch_related('best_pizza__weightpings')</code></p><h3 id=18-extra>18. extra()<a hidden class=anchor aria-hidden=true href=#18-extra>#</a></h3><p><code>extra(select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</code></p><ul><li>æœ‰äº›æƒ…å†µä¸‹ï¼ŒDjangoçš„æŸ¥è¯¢è¯­æ³•éš¾ä»¥ç®€å•çš„è¡¨è¾¾å¤æ‚çš„WHEREå­å¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µ,å¯ä»¥åœ¨<code>extra()</code>ç”Ÿæˆçš„SQLä»å¥ä¸­æ³¨å…¥æ–°å­å¥ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œè¿™æ˜¯ä¸€ä¸ªæ—§çš„APIï¼Œåœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™å¯èƒ½è¢«å¼ƒç”¨ã€‚ä»…å½“æ— æ³•ä½¿ç”¨å…¶ä»–æŸ¥è¯¢æ–¹æ³•è¡¨è¾¾æŸ¥è¯¢æ—¶æ‰ä½¿ç”¨å®ƒã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>qs<span style=color:#ff7b72;font-weight:700>.</span>extra(
</span></span><span style=display:flex><span>	select<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>&#39;val&#39;</span>: <span style=color:#a5d6ff>&#34;select col from sometable where othercol = </span><span style=color:#a5d6ff>%s</span><span style=color:#a5d6ff>&#34;</span>},
</span></span><span style=display:flex><span>	select_params<span style=color:#ff7b72;font-weight:700>=</span>(someparam,),
</span></span><span style=display:flex><span> )
</span></span></code></pre></td></tr></table></div></div><p>ç›¸å½“äºï¼š</p><p><code>qs.annotate(val=RawSQL("select col from sometable where othercol = %s", (someparam,)))</code></p><h3 id=19-defer>19. defer()<a hidden class=anchor aria-hidden=true href=#19-defer>#</a></h3><p><code>defer(*fields)</code></p><ul><li><p>åœ¨ä¸€äº›å¤æ‚çš„æ•°æ®å»ºæ¨¡æƒ…å†µä¸‹ï¼Œæ¨¡å‹å¯èƒ½åŒ…å«å¤§é‡å­—æ®µï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½åŒ…å«å¤§å°ºå¯¸æ•°æ®ï¼ˆä¾‹å¦‚æ–‡æœ¬å­—æ®µï¼‰ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºPythonå¯¹è±¡éœ€è¦èŠ±è´¹å¾ˆå¤§çš„ä»£ä»·ã€‚</p></li><li><p>å½“æœ€åˆè·å–æ•°æ®æ—¶ä¸çŸ¥é“æ˜¯å¦éœ€è¦è¿™äº›ç‰¹å®šå­—æ®µçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨æŸ¥è¯¢é›†çš„ç»“æœï¼Œå¯ä»¥å‘Šè¯‰Djangoä¸è¦ä»æ•°æ®åº“ä¸­æ£€ç´¢å®ƒä»¬ã€‚</p></li><li><p>é€šè¿‡ä¼ é€’å­—æ®µåç§°åˆ°defer()å®ç°ä¸åŠ è½½ï¼š</p></li></ul><p><code>Entry.objects.defer("headline", "body")</code></p><ul><li><p>å…·æœ‰å»¶è¿ŸåŠ è½½å­—æ®µçš„æŸ¥è¯¢é›†ä»å°†è¿”å›æ¨¡å‹å®ä¾‹ã€‚</p></li><li><p>æ¯ä¸ªå»¶è¿Ÿå­—æ®µå°†åœ¨ä½ è®¿é—®è¯¥å­—æ®µæ—¶ä»æ•°æ®åº“ä¸­æ£€ç´¢ï¼ˆæ¯æ¬¡åªæ£€ç´¢ä¸€ä¸ªï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ£€ç´¢æ‰€æœ‰çš„å»¶è¿Ÿå­—æ®µï¼‰ã€‚</p></li><li><p>å¯ä»¥å¤šæ¬¡è°ƒç”¨defer()ã€‚ æ¯ä¸ªè°ƒç”¨éƒ½å‘å»¶è¿Ÿé›†æ·»åŠ æ–°å­—æ®µï¼š</p></li></ul><h4 id=å»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µ>å»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µã€‚<a hidden class=anchor aria-hidden=true href=#å»¶è¿Ÿbodyå’Œheadlineä¸¤ä¸ªå­—æ®µ>#</a></h4><p><code>Entry.objects.defer("body").filter(rating=5).defer("headline")</code></p><ul><li><p>å­—æ®µæ·»åŠ åˆ°å»¶è¿Ÿé›†çš„é¡ºåºæ— å…³ç´§è¦ã€‚å¯¹å·²ç»å»¶è¿Ÿçš„å­—æ®µåç§°å†æ¬¡defer()æ²¡æœ‰é—®é¢˜ï¼ˆè¯¥å­—æ®µä»å°†è¢«å»¶è¿Ÿï¼‰ã€‚</p></li><li><p>å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„åŒä¸‹åˆ’çº¿ç¬¦å·æ¥åˆ†éš”å…³è”çš„å­—æ®µï¼Œä»è€ŒåŠ è½½å…³è”æ¨¡å‹ä¸­çš„å­—æ®µï¼š</p></li></ul><p><code>Blog.objects.select_related().defer("entry__headline", "entry__body")</code></p><ul><li>å¦‚æœè¦æ¸…é™¤å»¶è¿Ÿå­—æ®µé›†ï¼Œå°†Noneä½œä¸ºå‚æ•°ä¼ é€’åˆ°defer()ï¼š</li></ul><h4 id=ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µ>ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µã€‚<a hidden class=anchor aria-hidden=true href=#ç«‹å³åŠ è½½æ‰€æœ‰çš„å­—æ®µ>#</a></h4><ul><li><p>my_queryset.defer(None)</p></li><li><p>defer()æ–¹æ³•ï¼ˆåŠå…¶å…„å¼Ÿï¼Œonly()ï¼‰ä»…é€‚ç”¨äºé«˜çº§ç”¨ä¾‹ï¼Œå®ƒä»¬æä¾›äº†æ•°æ®åŠ è½½çš„ä¼˜åŒ–æ–¹æ³•ã€‚</p></li></ul><h3 id=20-only>20. only()<a hidden class=anchor aria-hidden=true href=#20-only>#</a></h3><p><code>only(*fields)</code></p><ul><li><p>only()æ–¹æ³•ä¸defer()ç›¸åã€‚</p></li><li><p>å¦‚æœæœ‰ä¸€ä¸ªæ¨¡å‹å‡ ä¹æ‰€æœ‰çš„å­—æ®µéœ€è¦å»¶è¿Ÿï¼Œä½¿ç”¨only()æŒ‡å®šè¡¥å……çš„å­—æ®µé›†å¯ä»¥ä½¿ä»£ç æ›´ç®€å•ã€‚</p></li><li><p>å‡è®¾æœ‰ä¸€ä¸ªåŒ…å«å­—æ®µbiographyã€ageå’Œnameçš„æ¨¡å‹ã€‚ ä»¥ä¸‹ä¸¤ä¸ªæŸ¥è¯¢é›†æ˜¯ç›¸åŒçš„ï¼Œå°±å»¶è¿Ÿå­—æ®µè€Œè¨€ï¼š</p><ul><li>Person.objects.defer(&ldquo;age&rdquo;, &ldquo;biography&rdquo;)</li><li>Person.objects.only(&ldquo;name&rdquo;)</li></ul></li></ul><p>æ¯å½“ä½ è°ƒç”¨only()æ—¶ï¼Œå®ƒå°†æ›¿æ¢ç«‹å³åŠ è½½çš„å­—æ®µé›†ã€‚å› æ­¤ï¼Œå¯¹only()çš„è¿ç»­è°ƒç”¨çš„ç»“æœæ˜¯åªæœ‰æœ€åä¸€æ¬¡è°ƒç”¨çš„å­—æ®µè¢«è€ƒè™‘ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># This will defer all fields except the headline.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>only(<span style=color:#a5d6ff>&#34;body&#34;</span>, <span style=color:#a5d6ff>&#34;rating&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>only(<span style=color:#a5d6ff>&#34;headline&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ç”±äºdefer()ä»¥é€’å¢æ–¹å¼åŠ¨ä½œ<span style=color:#f85149>ï¼ˆ</span>å‘å»¶è¿Ÿåˆ—è¡¨ä¸­æ·»åŠ å­—æ®µ<span style=color:#f85149>ï¼‰ï¼Œ</span>å› æ­¤ä½ å¯ä»¥ç»“åˆonly()å’Œdefer()è°ƒç”¨<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Final result is that everything except &#34;headline&#34; is deferred.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>only(<span style=color:#a5d6ff>&#34;headline&#34;</span>, <span style=color:#a5d6ff>&#34;body&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>defer(<span style=color:#a5d6ff>&#34;body&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Final result loads headline and body immediately (only() replaces any</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># existing set of fields).</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>defer(<span style=color:#a5d6ff>&#34;body&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>only(<span style=color:#a5d6ff>&#34;headline&#34;</span>, <span style=color:#a5d6ff>&#34;body&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>å½“å¯¹å…·æœ‰å»¶è¿Ÿå­—æ®µçš„å®ä¾‹è°ƒç”¨save()æ—¶ï¼Œä»…ä¿å­˜åŠ è½½çš„å­—æ®µã€‚</p><h3 id=21-using>21. using()<a hidden class=anchor aria-hidden=true href=#21-using>#</a></h3><p><code>using(alias)</code></p><ul><li>å¦‚æœæ­£åœ¨ä½¿ç”¨å¤šä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºæŒ‡å®šåœ¨å“ªä¸ªæ•°æ®åº“ä¸ŠæŸ¥è¯¢QuerySetã€‚æ–¹æ³•çš„å”¯ä¸€å‚æ•°æ˜¯æ•°æ®åº“çš„åˆ«åï¼Œå®šä¹‰åœ¨DATABASESã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># queries the database with the &#39;default&#39; alias.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>all()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># queries the database with the &#39;backup&#39; alias</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>using(<span style=color:#a5d6ff>&#39;backup&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=22-select_for_update>22. select_for_update()<a hidden class=anchor aria-hidden=true href=#22-select_for_update>#</a></h3><p><code>select_for_update(nowait=False, skip_locked=False)</code></p><ul><li>è¿”å›ä¸€ä¸ªé”ä½è¡Œç›´åˆ°äº‹åŠ¡ç»“æŸçš„æŸ¥è¯¢é›†ï¼Œå¦‚æœæ•°æ®åº“æ”¯æŒï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªSELECT &mldr; FOR UPDATEè¯­å¥ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><p><code>entries = Entry.objects.select_for_update().filter(author=request.user)</code></p><ul><li><p>æ‰€æœ‰åŒ¹é…çš„è¡Œå°†è¢«é”å®šï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡é”é˜²æ­¢æ•°æ®è¢«å…¶å®ƒäº‹åŠ¡ä¿®æ”¹ã€‚</p></li><li><p>ä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœå…¶ä»–äº‹åŠ¡é”å®šäº†ç›¸å…³è¡Œï¼Œé‚£ä¹ˆæœ¬æŸ¥è¯¢å°†è¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚ä½¿ç”¨select_for_update(nowait=True)å°†ä½¿æŸ¥è¯¢ä¸é˜»å¡ã€‚å¦‚æœå…¶å®ƒäº‹åŠ¡æŒæœ‰å†²çªçš„é”,é‚£ä¹ˆæŸ¥è¯¢å°†å¼•å‘DatabaseErrorå¼‚å¸¸ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨select_for_update(skip_locked=True)å¿½ç•¥é”å®šçš„è¡Œã€‚nowaitå’Œskip_lockedæ˜¯äº’æ–¥çš„ã€‚</p></li><li><p>ç›®å‰ï¼Œpostgresqlï¼Œoracleå’Œmysqlæ•°æ®åº“åç«¯æ”¯æŒselect_for_update()ã€‚ä½†æ˜¯ï¼ŒMySQLä¸æ”¯æŒnowaitå’Œskip_lockedå‚æ•°ã€‚</p></li></ul><h3 id=23-raw>23. raw()<a hidden class=anchor aria-hidden=true href=#23-raw>#</a></h3><p>raw(raw_query, params=None, translations=None)</p><p>æ¥æ”¶ä¸€ä¸ªåŸå§‹çš„SQLæŸ¥è¯¢ï¼Œæ‰§è¡Œå®ƒå¹¶è¿”å›ä¸€ä¸ªdjango.db.models.query.RawQuerySetå®ä¾‹ã€‚</p><p>è¿™ä¸ªRawQuerySetå®ä¾‹å¯ä»¥è¿­ä»£ï¼Œå°±åƒæ™®é€šçš„QuerySetä¸€æ ·ã€‚</p><h1 id=å››ä¸è¿”å›querysetsçš„api>å››ã€ä¸è¿”å›QuerySetsçš„API<a hidden class=anchor aria-hidden=true href=#å››ä¸è¿”å›querysetsçš„api>#</a></h1><ul><li>ä»¥ä¸‹çš„æ–¹æ³•ä¸ä¼šè¿”å›QuerySetsï¼Œä½†æ˜¯ä½œç”¨éå¸¸å¼ºå¤§ï¼Œå°¤å…¶æ˜¯ç²—ä½“æ˜¾ç¤ºçš„æ–¹æ³•ï¼Œéœ€è¦èƒŒä¸‹æ¥ã€‚</li></ul><h2 id=æ–¹æ³•å-è§£é‡Š-1><strong>æ–¹æ³•å è§£é‡Š</strong><a hidden class=anchor aria-hidden=true href=#æ–¹æ³•å-è§£é‡Š-1>#</a></h2><p>get() è·å–å•ä¸ªå¯¹è±¡</p><p>create() åˆ›å»ºå¯¹è±¡ï¼Œæ— éœ€save()</p><p>get_or_create() æŸ¥è¯¢å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±æ–°å»ºå¯¹è±¡</p><p>update_or_create() æ›´æ–°å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±åˆ›å»ºå¯¹è±¡</p><p>bulk_create()</p><p>æ‰¹é‡åˆ›å»ºå¯¹è±¡</p><p>count() ç»Ÿè®¡å¯¹è±¡çš„ä¸ªæ•°</p><p>in_bulk()</p><p>æ ¹æ®ä¸»é”®å€¼çš„åˆ—è¡¨ï¼Œæ‰¹é‡è¿”å›å¯¹è±¡</p><p>iterator()</p><p>è·å–åŒ…å«å¯¹è±¡çš„è¿­ä»£å™¨</p><p>latest() è·å–æœ€è¿‘çš„å¯¹è±¡</p><p>earliest() è·å–æœ€æ—©çš„å¯¹è±¡</p><p>first() è·å–ç¬¬ä¸€ä¸ªå¯¹è±¡</p><p>last() è·å–æœ€åä¸€ä¸ªå¯¹è±¡</p><p>aggregate() èšåˆæ“ä½œ</p><p>exists() åˆ¤æ–­querysetä¸­æ˜¯å¦æœ‰å¯¹è±¡</p><p>update() æ‰¹é‡æ›´æ–°å¯¹è±¡</p><p>delete() æ‰¹é‡åˆ é™¤å¯¹è±¡</p><p>as_manager() è·å–ç®¡ç†å™¨</p><h3 id=1-get>1. get()<a hidden class=anchor aria-hidden=true href=#1-get>#</a></h3><p><code>get(**kwargs)</code></p><ul><li><p>è¿”å›æŒ‰ç…§æŸ¥è¯¢å‚æ•°åŒ¹é…åˆ°çš„å•ä¸ªå¯¹è±¡ï¼Œå‚æ•°çš„æ ¼å¼åº”è¯¥ç¬¦åˆField lookupsçš„è¦æ±‚ã€‚</p></li><li><p>å¦‚æœåŒ¹é…åˆ°çš„å¯¹è±¡ä¸ªæ•°ä¸åªä¸€ä¸ªçš„è¯ï¼Œè§¦å‘MultipleObjectsReturnedå¼‚å¸¸</p></li><li><p>å¦‚æœæ ¹æ®ç»™å‡ºçš„å‚æ•°åŒ¹é…ä¸åˆ°å¯¹è±¡çš„è¯ï¼Œè§¦å‘DoesNotExistå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š</p></li></ul><p><code>Entry.objects.get(id='foo') # raises Entry.DoesNotExist</code></p><ul><li>DoesNotExistå¼‚å¸¸ä»django.core.exceptions.ObjectDoesNotExistç»§æ‰¿ï¼Œå¯ä»¥å®šä½å¤šä¸ªDoesNotExistå¼‚å¸¸ã€‚ ä¾‹å¦‚ï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.core.exceptions</span> <span style=color:#ff7b72>import</span> ObjectDoesNotExist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>	e <span style=color:#ff7b72;font-weight:700>=</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3</span>)
</span></span><span style=display:flex><span>	b <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>except</span> ObjectDoesNotExist:
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#34;Either the entry or blog doesn&#39;t exist.&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><ul><li>å¦‚æœå¸Œæœ›æŸ¥è¯¢å™¨åªè¿”å›ä¸€è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨get()è€Œä¸ä½¿ç”¨ä»»ä½•å‚æ•°æ¥è¿”å›è¯¥è¡Œçš„å¯¹è±¡ï¼š</li></ul><p><code>entry = Entry.objects.filter(...).exclude(...).get()</code></p><h3 id=2-create>2. create()<a hidden class=anchor aria-hidden=true href=#2-create>#</a></h3><p><code>create(**kwargs)</code></p><ul><li>åœ¨ä¸€æ­¥æ“ä½œä¸­<code>åŒæ—¶åˆ›å»º</code>å¹¶ä¸”<code>ä¿å­˜å¯¹è±¡</code>çš„ä¾¿æ·æ–¹æ³•.</li></ul><p><code>p = Person.objects.create(first_name="Bruce", last_name="Springsteen")</code></p><p>ç­‰äº:</p><p><code>p = Person(first_name="Bruce", last_name="Springsteen")</code></p><p><code>p.save(force_insert=True)</code></p><ul><li>å‚æ•°force_insertè¡¨ç¤ºå¼ºåˆ¶åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœmodelä¸­æœ‰ä¸€ä¸ªä½ æ‰‹åŠ¨è®¾ç½®çš„ä¸»é”®ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼å·²ç»å­˜åœ¨äºæ•°æ®åº“ä¸­, è°ƒç”¨create()å°†ä¼šå¤±è´¥å¹¶ä¸”è§¦å‘IntegrityErrorå› ä¸ºä¸»é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä½ æ‰‹åŠ¨è®¾ç½®äº†ä¸»é”®ï¼Œåšå¥½å¼‚å¸¸å¤„ç†çš„å‡†å¤‡ã€‚</li></ul><h3 id=3-get_or_create>3. get_or_create()<a hidden class=anchor aria-hidden=true href=#3-get_or_create>#</a></h3><p><code>get_or_create(defaults=None, **kwargs)</code></p><ul><li><p>é€šè¿‡kwargsæ¥æŸ¥è¯¢å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•ï¼ˆå¦‚æœæ¨¡å‹ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸ºç©ºï¼‰ï¼Œå¦‚æœè¯¥å¯¹è±¡ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p></li><li><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªç”±(object, created)ç»„æˆçš„å…ƒç»„ï¼Œå…ƒç»„ä¸­çš„object æ˜¯ä¸€ä¸ªæŸ¥è¯¢åˆ°çš„æˆ–è€…æ˜¯è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œ createdæ˜¯ä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°çš„å¯¹è±¡çš„å¸ƒå°”å€¼ã€‚</p></li></ul><p>å¯¹äºä¸‹é¢çš„ä»£ç ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj <span style=color:#ff7b72;font-weight:700>=</span> Person<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(first_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;John&#39;</span>, last_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>except</span> Person<span style=color:#ff7b72;font-weight:700>.</span>DoesNotExist:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj <span style=color:#ff7b72;font-weight:700>=</span> Person(first_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;John&#39;</span>, last_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>, birthday<span style=color:#ff7b72;font-weight:700>=</span>date(<span style=color:#a5d6ff>1940</span>, <span style=color:#a5d6ff>10</span>, <span style=color:#a5d6ff>9</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæ¨¡å‹çš„å­—æ®µæ•°é‡è¾ƒå¤§çš„è¯ï¼Œè¿™ç§æ¨¡å¼å°±å˜çš„éå¸¸ä¸æ˜“ç”¨äº†ã€‚ ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ç”¨get_or_create()é‡å†™ :</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>obj, created <span style=color:#ff7b72;font-weight:700>=</span> Person<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get_or_create(
</span></span><span style=display:flex><span>  first_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;John&#39;</span>,
</span></span><span style=display:flex><span>  last_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>,
</span></span><span style=display:flex><span>  defaults<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>&#39;birthday&#39;</span>: date(<span style=color:#a5d6ff>1940</span>, <span style=color:#a5d6ff>10</span>, <span style=color:#a5d6ff>9</span>)},
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><ul><li>ä»»ä½•ä¼ é€’ç»™get_or_create()çš„å…³é”®å­—å‚æ•°ï¼Œé™¤äº†ä¸€ä¸ªå¯é€‰çš„defaultsï¼Œéƒ½å°†ä¼ é€’ç»™get()è°ƒç”¨ã€‚ å¦‚æœæŸ¥æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«åŒ¹é…åˆ°çš„å¯¹è±¡ä»¥åŠFalse ç»„æˆçš„å…ƒç»„ã€‚ å¦‚æœæŸ¥æ‰¾åˆ°çš„å¯¹è±¡è¶…è¿‡ä¸€ä¸ªä»¥ä¸Šï¼Œå°†å¼•å‘MultipleObjectsReturnedã€‚å¦‚æœæŸ¥æ‰¾ä¸åˆ°å¯¹è±¡ï¼Œget_or_create()å°†ä¼šå®ä¾‹åŒ–å¹¶ä¿å­˜ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªç”±æ–°çš„å¯¹è±¡ä»¥åŠTrueç»„æˆçš„å…ƒç»„ã€‚æ–°çš„å¯¹è±¡å°†ä¼šæŒ‰ç…§ä»¥ä¸‹çš„é€»è¾‘åˆ›å»º:</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>params <span style=color:#ff7b72;font-weight:700>=</span> {k: v <span style=color:#ff7b72>for</span> k, v <span style=color:#ff7b72;font-weight:700>in</span> kwargs<span style=color:#ff7b72;font-weight:700>.</span>items() <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;__&#39;</span> <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> k}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>params<span style=color:#ff7b72;font-weight:700>.</span>update({k: v() <span style=color:#ff7b72>if</span> callable(v) <span style=color:#ff7b72>else</span> v <span style=color:#ff7b72>for</span> k, v <span style=color:#ff7b72;font-weight:700>in</span> defaults<span style=color:#ff7b72;font-weight:700>.</span>items()})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>obj <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model(<span style=color:#ff7b72;font-weight:700>**</span>params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>obj<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span></code></pre></td></tr></table></div></div><ul><li><p>å®ƒè¡¨ç¤ºä»é&rsquo;defaults&rsquo; ä¸”ä¸åŒ…å«åŒä¸‹åˆ’çº¿çš„å…³é”®å­—å‚æ•°å¼€å§‹ã€‚ç„¶åå°†defaultsçš„å†…å®¹æ·»åŠ è¿›æ¥ï¼Œè¦†ç›–å¿…è¦çš„é”®ï¼Œå¹¶ä½¿ç”¨ç»“æœä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¨¡å‹ç±»ã€‚</p></li><li><p>å¦‚æœæœ‰ä¸€ä¸ªåä¸ºdefaults__exactçš„å­—æ®µï¼Œå¹¶ä¸”æƒ³åœ¨get_or_create()æ—¶ç”¨å®ƒä½œä¸ºç²¾ç¡®æŸ¥è¯¢ï¼Œåªéœ€è¦ä½¿ç”¨defaultsï¼Œåƒè¿™æ ·ï¼š</p></li></ul><p><code>Foo.objects.get_or_create(defaults__exact='bar', defaults={'defaults': 'baz'})</code></p><ul><li><p>å½“ä½ ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šçš„ä¸»é”®æ—¶ï¼Œget_or_create()æ–¹æ³•ä¸create()æ–¹æ³•æœ‰ç›¸ä¼¼çš„é”™è¯¯è¡Œä¸º ã€‚ å¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡è€Œè¯¥å¯¹è±¡çš„ä¸»é”®æ—©å·²å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼ŒIntegrityErrorå¼‚å¸¸å°†ä¼šè¢«è§¦å‘ã€‚</p></li><li><p>è¿™ä¸ªæ–¹æ³•å‡è®¾è¿›è¡Œçš„æ˜¯åŸå­æ“ä½œï¼Œå¹¶ä¸”æ­£ç¡®åœ°é…ç½®äº†æ•°æ®åº“å’Œæ­£ç¡®çš„åº•å±‚æ•°æ®åº“è¡Œä¸ºã€‚å¦‚æœæ•°æ®åº“çº§åˆ«æ²¡æœ‰å¯¹get_or_createä¸­ç”¨åˆ°çš„kwargså¼ºåˆ¶è¦æ±‚å”¯ä¸€æ€§ï¼ˆuniqueå’Œunique_togetherï¼‰ï¼Œæ–¹æ³•å®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå¯èƒ½ä¼šæœ‰ç›¸åŒå‚æ•°çš„å¤šè¡ŒåŒæ—¶æ’å…¥ã€‚ï¼ˆç®€å•ç†è§£ï¼Œkwargså¿…é¡»æŒ‡å®šçš„æ˜¯ä¸»é”®æˆ–è€…uniqueå±æ€§çš„å­—æ®µæ‰å®‰å…¨ã€‚ï¼‰</p></li><li><p>æœ€åå»ºè®®åªåœ¨Djangoè§†å›¾çš„POSTè¯·æ±‚ä¸­ä½¿ç”¨get_or_create()ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¿®æ”¹æ€§è´¨çš„åŠ¨ä½œï¼Œä¸åº”è¯¥ä½¿ç”¨åœ¨GETè¯·æ±‚ä¸­ï¼Œé‚£æ ·ä¸å®‰å…¨ã€‚</p></li><li><p>å¯ä»¥é€šè¿‡ManyToManyFieldå±æ€§å’Œåå‘å…³è”ä½¿ç”¨get_or_create()ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é™åˆ¶æŸ¥è¯¢åœ¨å…³è”çš„ä¸Šä¸‹æ–‡å†…éƒ¨ã€‚ å¦åˆ™ï¼Œå¯èƒ½å¯¼è‡´å®Œæ•´æ€§é—®é¢˜ã€‚</p></li></ul><p>ä¾‹å¦‚ä¸‹é¢çš„æ¨¡å‹ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Chapter</span>(models<span style=color:#ff7b72;font-weight:700>.</span>Model):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  title <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>CharField(max_length<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>255</span>, unique<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Book</span>(models<span style=color:#ff7b72;font-weight:700>.</span>Model):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  title <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>CharField(max_length<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>256</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  chapters <span style=color:#ff7b72;font-weight:700>=</span> models<span style=color:#ff7b72;font-weight:700>.</span>ManyToManyField(Chapter)
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥é€šè¿‡Bookçš„chapterså­—æ®µä½¿ç”¨get_or_create()ï¼Œä½†æ˜¯å®ƒåªä¼šè·å–è¯¥Bookå†…éƒ¨çš„ä¸Šä¸‹æ–‡ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> book <span style=color:#ff7b72;font-weight:700>=</span> Book<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>create(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Ulysses&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> book<span style=color:#ff7b72;font-weight:700>.</span>chapters<span style=color:#ff7b72;font-weight:700>.</span>get_or_create(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Telemachus&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#ff7b72;font-weight:700>&lt;</span>Chapter: Telemachus<span style=color:#ff7b72;font-weight:700>&gt;</span>, <span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> book<span style=color:#ff7b72;font-weight:700>.</span>chapters<span style=color:#ff7b72;font-weight:700>.</span>get_or_create(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Telemachus&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#ff7b72;font-weight:700>&lt;</span>Chapter: Telemachus<span style=color:#ff7b72;font-weight:700>&gt;</span>, <span style=color:#79c0ff>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Chapter<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>create(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Chapter 1&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span>Chapter: Chapter <span style=color:#a5d6ff>1</span><span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> book<span style=color:#ff7b72;font-weight:700>.</span>chapters<span style=color:#ff7b72;font-weight:700>.</span>get_or_create(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Chapter 1&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Raises IntegrityError</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>å‘ç”Ÿè¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºå°è¯•é€šè¿‡Book â€œUlyssesâ€è·å–æˆ–è€…åˆ›å»ºâ€œChapter 1â€ï¼Œä½†æ˜¯å®ƒä¸èƒ½ï¼Œå› ä¸ºå®ƒä¸è¿™ä¸ªbookä¸å…³è”ï¼Œä½†å› ä¸ºtitle å­—æ®µæ˜¯å”¯ä¸€çš„å®ƒä»ç„¶ä¸èƒ½åˆ›å»ºã€‚</li></ul><p>åœ¨Django1.11åœ¨defaultsä¸­å¢åŠ äº†å¯¹å¯è°ƒç”¨å€¼çš„æ”¯æŒã€‚</p><h3 id=4-update_or_create>4. update_or_create()<a hidden class=anchor aria-hidden=true href=#4-update_or_create>#</a></h3><p><code>update_or_create(defaults=None, **kwargs)</code></p><p>ç±»ä¼¼å‰é¢çš„get_or_create()ã€‚</p><ul><li><p>é€šè¿‡ç»™å‡ºçš„kwargsæ¥æ›´æ–°å¯¹è±¡çš„ä¾¿æ·æ–¹æ³•ï¼Œ å¦‚æœæ²¡æ‰¾åˆ°å¯¹è±¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚defaultsæ˜¯ä¸€ä¸ªç”± (field, value)å¯¹ç»„æˆçš„å­—å…¸ï¼Œç”¨äºæ›´æ–°å¯¹è±¡ã€‚defaultsä¸­çš„å€¼å¯ä»¥æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯è¯´å‡½æ•°ç­‰ï¼‰ã€‚</p></li><li><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªç”±(object, created)ç»„æˆçš„å…ƒç»„,å…ƒç»„ä¸­çš„objectæ˜¯ä¸€ä¸ªåˆ›å»ºçš„æˆ–è€…æ˜¯è¢«æ›´æ–°çš„å¯¹è±¡ï¼Œ createdæ˜¯ä¸€ä¸ªæ ‡ç¤ºæ˜¯å¦åˆ›å»ºäº†æ–°çš„å¯¹è±¡çš„å¸ƒå°”å€¼ã€‚</p></li><li><p>update_or_createæ–¹æ³•å°è¯•é€šè¿‡ç»™å‡ºçš„kwargs å»ä»æ•°æ®åº“ä¸­è·å–åŒ¹é…çš„å¯¹è±¡ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„å¯¹è±¡ï¼Œå®ƒå°†ä¼šä¾æ®defaults å­—å…¸ç»™å‡ºçš„å€¼æ›´æ–°å­—æ®µã€‚</p></li></ul><p>åƒä¸‹é¢çš„ä»£ç ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>defaults <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#39;first_name&#39;</span>: <span style=color:#a5d6ff>&#39;Bob&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj <span style=color:#ff7b72;font-weight:700>=</span> Person<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(first_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;John&#39;</span>, last_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>for</span> key, value <span style=color:#ff7b72;font-weight:700>in</span> defaults<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setattr(obj, key, value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>except</span> Person<span style=color:#ff7b72;font-weight:700>.</span>DoesNotExist:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  new_values <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#39;first_name&#39;</span>: <span style=color:#a5d6ff>&#39;John&#39;</span>, <span style=color:#a5d6ff>&#39;last_name&#39;</span>: <span style=color:#a5d6ff>&#39;Lennon&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  new_values<span style=color:#ff7b72;font-weight:700>.</span>update(defaults)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  obj <span style=color:#ff7b72;font-weight:700>=</span> Person(<span style=color:#ff7b72;font-weight:700>**</span>new_values)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	obj<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæ¨¡å‹çš„å­—æ®µæ•°é‡è¾ƒå¤§çš„è¯ï¼Œè¿™ç§æ¨¡å¼å°±å˜çš„éå¸¸ä¸æ˜“ç”¨äº†ã€‚ ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥ç”¨update_or_create() é‡å†™:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>obj, created <span style=color:#ff7b72;font-weight:700>=</span> Person<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>update_or_create(
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>first_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;John&#39;</span>, last_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>defaults<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>&#39;first_name&#39;</span>: <span style=color:#a5d6ff>&#39;Bob&#39;</span>},
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><ul><li><p>kwargsä¸­çš„åç§°å¦‚ä½•è§£æçš„è¯¦ç»†æè¿°å¯ä»¥å‚è§get_or_create()ã€‚</p></li><li><p>å’Œget_or_create()ä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå®¹æ˜“å¯¼è‡´ç«æ€æ¡ä»¶ï¼Œå¦‚æœæ•°æ®åº“å±‚çº§æ²¡æœ‰å‰ç½®å”¯ä¸€æ€§ä¼šè®©å¤šè¡ŒåŒæ—¶æ’å…¥ã€‚</p></li></ul><p>åœ¨Django1.11åœ¨defaultsä¸­å¢åŠ äº†å¯¹å¯è°ƒç”¨å€¼çš„æ”¯æŒã€‚</p><h3 id=5-bulk_create>5. bulk_create()<a hidden class=anchor aria-hidden=true href=#5-bulk_create>#</a></h3><p><code>bulk_create(objs, batch_size=None)</code></p><ul><li>ä»¥é«˜æ•ˆçš„æ–¹å¼ï¼ˆé€šå¸¸åªæœ‰1ä¸ªæŸ¥è¯¢ï¼Œæ— è®ºæœ‰å¤šå°‘å¯¹è±¡ï¼‰å°†æä¾›çš„å¯¹è±¡åˆ—è¡¨æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>bulk_create([
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>...</span> Entry(headline<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;This is a test&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>...</span> Entry(headline<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;This is only a test&#39;</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>...</span> ])
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><p>ä¸ä¼šè°ƒç”¨æ¨¡å‹çš„save()æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ä¼šå‘é€pre_saveå’Œpost_saveä¿¡å·ã€‚</p></li><li><p>ä¸é€‚ç”¨äºå¤šè¡¨ç»§æ‰¿åœºæ™¯ä¸­çš„å­æ¨¡å‹ã€‚</p></li><li><p>å¦‚æœæ¨¡å‹çš„ä¸»é”®æ˜¯AutoFieldï¼Œåˆ™ä¸ä¼šåƒsave()é‚£æ ·æ£€ç´¢å¹¶è®¾ç½®ä¸»é”®å±æ€§ï¼Œé™¤éæ•°æ®åº“åç«¯æ”¯æŒã€‚</p></li><li><p>ä¸é€‚ç”¨äºå¤šå¯¹å¤šå…³ç³»ã€‚</p></li><li><p>batch_sizeå‚æ•°æ§åˆ¶åœ¨å•ä¸ªæŸ¥è¯¢ä¸­åˆ›å»ºçš„å¯¹è±¡æ•°ã€‚</p></li></ul><h3 id=6-count>6. count()<a hidden class=anchor aria-hidden=true href=#6-count>#</a></h3><p><code>count()</code></p><ul><li>è¿”å›åœ¨æ•°æ®åº“ä¸­å¯¹åº”çš„QuerySetå¯¹è±¡çš„ä¸ªæ•°ã€‚count()æ°¸è¿œä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è¿”å›æ€»ä¸ªæ•°.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>count()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è¿”å›åŒ…å«æœ‰&#39;Lennon&#39;çš„å¯¹è±¡çš„æ€»æ•°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(headline__contains<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Lennon&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>count()
</span></span></code></pre></td></tr></table></div></div><h3 id=7-in_bulk>7. in_bulk()<a hidden class=anchor aria-hidden=true href=#7-in_bulk>#</a></h3><p><code>in_bulk(id_list=None)</code></p><ul><li>è·å–ä¸»é”®å€¼çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›å°†æ¯ä¸ªä¸»é”®å€¼æ˜ å°„åˆ°å…·æœ‰ç»™å®šIDçš„å¯¹è±¡çš„å®ä¾‹çš„å­—å…¸ã€‚ å¦‚æœæœªæä¾›åˆ—è¡¨ï¼Œåˆ™ä¼šè¿”å›æŸ¥è¯¢é›†ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>in_bulk([<span style=color:#a5d6ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#a5d6ff>1</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Beatles Blog<span style=color:#ff7b72;font-weight:700>&gt;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>in_bulk([<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>2</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#a5d6ff>1</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Beatles Blog<span style=color:#ff7b72;font-weight:700>&gt;</span>, <span style=color:#a5d6ff>2</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Cheddar Talk<span style=color:#ff7b72;font-weight:700>&gt;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>in_bulk([])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>in_bulk()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#a5d6ff>1</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Beatles Blog<span style=color:#ff7b72;font-weight:700>&gt;</span>, <span style=color:#a5d6ff>2</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Cheddar Talk<span style=color:#ff7b72;font-weight:700>&gt;</span>, <span style=color:#a5d6ff>3</span>: <span style=color:#ff7b72;font-weight:700>&lt;</span>Blog: Django Weblog<span style=color:#ff7b72;font-weight:700>&gt;</span>}
</span></span></code></pre></td></tr></table></div></div><ul><li><p>å¦‚æœå‘in_bulk()ä¼ é€’ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç©ºçš„å­—å…¸ã€‚</p></li><li><p>åœ¨æ—§ç‰ˆæœ¬ä¸­ï¼Œid_listæ˜¯å¿…éœ€çš„å‚æ•°ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚</p></li></ul><h3 id=8-iterator>8. iterator()<a hidden class=anchor aria-hidden=true href=#8-iterator>#</a></h3><p><code>iterator()</code></p><ul><li><p>æäº¤æ•°æ®åº“æ“ä½œï¼Œè·å–QuerySetï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p></li><li><p>QuerySeté€šå¸¸ä¼šåœ¨å†…éƒ¨ç¼“å­˜å…¶ç»“æœï¼Œä»¥ä¾¿åœ¨é‡å¤è®¡ç®—æ—¶ä¸ä¼šå¯¼è‡´é¢å¤–çš„æŸ¥è¯¢ã€‚è€Œiterator()å°†ç›´æ¥è¯»å–ç»“æœï¼Œä¸åœ¨QuerySetçº§åˆ«æ‰§è¡Œä»»ä½•ç¼“å­˜ã€‚å¯¹äºè¿”å›å¤§é‡åªéœ€è¦è®¿é—®ä¸€æ¬¡çš„å¯¹è±¡çš„QuerySetï¼Œè¿™å¯ä»¥å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p></li></ul><blockquote><p>è¯·æ³¨æ„ï¼Œåœ¨å·²ç»æäº¤äº†çš„iterator()ä¸Šä½¿ç”¨QuerySetä¼šå¼ºåˆ¶å®ƒå†æ¬¡æäº¤æ•°æ®åº“æ“ä½œï¼Œè¿›è¡Œé‡å¤æŸ¥è¯¢ã€‚æ­¤å¤–ï¼Œä½¿ç”¨iterator()ä¼šå¯¼è‡´å…ˆå‰çš„prefetch_related()è°ƒç”¨è¢«å¿½ç•¥ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªä¸€èµ·ä¼˜åŒ–æ²¡æœ‰æ„ä¹‰ã€‚</p></blockquote><h3 id=9-latest>9. latest()<a hidden class=anchor aria-hidden=true href=#9-latest>#</a></h3><p><code>latest(field_name=None)</code></p><ul><li><p>ä½¿ç”¨æ—¥æœŸå­—æ®µfield_nameï¼ŒæŒ‰æ—¥æœŸè¿”å›æœ€æ–°å¯¹è±¡ã€‚</p></li><li><p>ä¸‹ä¾‹æ ¹æ®Entryçš„&rsquo;pub_date&rsquo;å­—æ®µè¿”å›æœ€æ–°å‘å¸ƒçš„entryï¼š</p><p><code>Entry.objects.latest('pub_date')</code></p></li><li><p>å¦‚æœæ¨¡å‹çš„MetaæŒ‡å®šäº†get_latest_byï¼Œåˆ™å¯ä»¥å°†latest()å‚æ•°ç•™ç»™earliest()æˆ–è€…field_nameã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒDjangoå°†ä½¿ç”¨get_latest_byä¸­æŒ‡å®šçš„å­—æ®µã€‚</p></li><li><p>earliest()å’Œlatest()å¯èƒ½ä¼šè¿”å›ç©ºæ—¥æœŸçš„å®ä¾‹,å¯èƒ½éœ€è¦è¿‡æ»¤æ‰ç©ºå€¼ï¼š</p></li></ul><p><code>Entry.objects.filter(pub_date__isnull=False).latest('pub_date')</code></p><h3 id=10-earliest>10. earliest()<a hidden class=anchor aria-hidden=true href=#10-earliest>#</a></h3><p>earliest(field_name=None)</p><p>ç±»åŒlatest()ã€‚</p><h3 id=11-first>11. first()<a hidden class=anchor aria-hidden=true href=#11-first>#</a></h3><p><code>first()</code></p><ul><li>è¿”å›ç»“æœé›†çš„ç¬¬ä¸€ä¸ªå¯¹è±¡, å½“æ²¡æœ‰æ‰¾åˆ°æ—¶è¿”å›Noneã€‚å¦‚æœQuerySetæ²¡æœ‰è®¾ç½®æ’åº,åˆ™å°†ä¼šè‡ªåŠ¨æŒ‰ä¸»é”®è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š</li></ul><p><code>p = Article.objects.order_by('title', 'pub_date').first()</code></p><ul><li>first()æ˜¯ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ï¼Œä¸‹é¢çš„ä¾‹å­å’Œä¸Šé¢çš„ä»£ç æ•ˆæœæ˜¯ä¸€æ ·ï¼š</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>	p <span style=color:#ff7b72;font-weight:700>=</span> Article<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>order_by(<span style=color:#a5d6ff>&#39;title&#39;</span>, <span style=color:#a5d6ff>&#39;pub_date&#39;</span>)[<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>IndexError</span>:
</span></span><span style=display:flex><span>	p <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=12-last>12. last()<a hidden class=anchor aria-hidden=true href=#12-last>#</a></h3><p><code>last()</code></p><p>å·¥ä½œæ–¹å¼ç±»ä¼¼first()ï¼Œåªæ˜¯è¿”å›çš„æ˜¯æŸ¥è¯¢é›†ä¸­æœ€åä¸€ä¸ªå¯¹è±¡ã€‚</p><h3 id=13-aggregate>13. aggregate()<a hidden class=anchor aria-hidden=true href=#13-aggregate>#</a></h3><p><code>aggregate(args, *kwargs)</code></p><ul><li><p>è¿”å›æ±‡æ€»å€¼çš„å­—å…¸ï¼ˆå¹³å‡å€¼ï¼Œæ€»å’Œç­‰ï¼‰,é€šè¿‡QuerySetè¿›è¡Œè®¡ç®—ã€‚æ¯ä¸ªå‚æ•°æŒ‡å®šè¿”å›çš„å­—å…¸ä¸­å°†è¦åŒ…å«çš„å€¼ã€‚</p></li><li><p>ä½¿ç”¨å…³é”®å­—å‚æ•°æŒ‡å®šçš„èšåˆå°†ä½¿ç”¨å…³é”®å­—å‚æ•°çš„åç§°ä½œä¸ºAnnotation çš„åç§°ã€‚ åŒ¿åå‚æ•°çš„åç§°å°†åŸºäºèšåˆå‡½æ•°çš„åç§°å’Œæ¨¡å‹å­—æ®µç”Ÿæˆã€‚ å¤æ‚çš„èšåˆä¸å¯ä»¥ä½¿ç”¨åŒ¿åå‚æ•°ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªå…³é”®å­—å‚æ•°ä½œä¸ºåˆ«åã€‚</p></li></ul><p>ä¾‹å¦‚ï¼Œæƒ³çŸ¥é“Blog Entry çš„æ•°ç›®ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>django.db.models</span> <span style=color:#ff7b72>import</span> Count
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>q <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>aggregate(Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>{<span style=color:#a5d6ff>&#39;entry__count&#39;</span>: <span style=color:#a5d6ff>16</span>}
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ä½¿ç”¨å…³é”®å­—å‚æ•°æ¥æŒ‡å®šèšåˆå‡½æ•°ï¼Œå¯ä»¥æ§åˆ¶è¿”å›çš„èšåˆçš„å€¼çš„åç§°ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>q <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>aggregate(number_of_entries<span style=color:#ff7b72;font-weight:700>=</span>Count(<span style=color:#a5d6ff>&#39;entry&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#a5d6ff>&#39;number_of_entries&#39;</span>: <span style=color:#a5d6ff>16</span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=14-exists>14. exists()<a hidden class=anchor aria-hidden=true href=#14-exists>#</a></h3><p>exists()</p><ul><li><p>å¦‚æœQuerySetåŒ…å«ä»»ä½•ç»“æœï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›Falseã€‚</p></li><li><p>æŸ¥æ‰¾å…·æœ‰å”¯ä¸€æ€§å­—æ®µï¼ˆä¾‹å¦‚primary_keyï¼‰çš„æ¨¡å‹æ˜¯å¦åœ¨ä¸€ä¸ªQuerySetä¸­çš„æœ€é«˜æ•ˆçš„æ–¹æ³•æ˜¯ï¼š</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>entry <span style=color:#ff7b72;font-weight:700>=</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(pk<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>123</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> some_queryset<span style=color:#ff7b72;font-weight:700>.</span>filter(pk<span style=color:#ff7b72;font-weight:700>=</span>entry<span style=color:#ff7b72;font-weight:700>.</span>pk)<span style=color:#ff7b72;font-weight:700>.</span>exists():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#34;Entry contained in queryset&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>å®ƒå°†æ¯”ä¸‹é¢çš„æ–¹æ³•å¿«å¾ˆå¤šï¼Œè¿™ä¸ªæ–¹æ³•è¦æ±‚å¯¹QuerySetæ±‚å€¼å¹¶è¿­ä»£æ•´ä¸ªQuerySetï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>if</span> entry <span style=color:#ff7b72;font-weight:700>in</span> some_queryset:
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#34;Entry contained in QuerySet&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>è‹¥è¦æŸ¥æ‰¾ä¸€ä¸ªQuerySetæ˜¯å¦åŒ…å«ä»»ä½•å…ƒç´ ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>if</span> some_queryset<span style=color:#ff7b72;font-weight:700>.</span>exists():
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#34;There is at least one object in some_queryset&#34;</span>)
</span></span><span style=display:flex><span>å°†å¿«äº<span style=color:#f85149>ï¼š</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> some_queryset:
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#34;There is at least one object in some_queryset&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=15-update>15. update()<a hidden class=anchor aria-hidden=true href=#15-update>#</a></h3><p><code>update(**kwargs)</code></p><ul><li><p>å¯¹æŒ‡å®šçš„å­—æ®µæ‰§è¡Œæ‰¹é‡æ›´æ–°æ“ä½œï¼Œå¹¶è¿”å›åŒ¹é…çš„è¡Œæ•°ï¼ˆå¦‚æœæŸäº›è¡Œå·²å…·æœ‰æ–°å€¼ï¼Œåˆ™å¯èƒ½ä¸ç­‰äºå·²æ›´æ–°çš„è¡Œæ•°ï¼‰ã€‚</p></li><li><p>ä¾‹å¦‚ï¼Œè¦å¯¹2010å¹´å‘å¸ƒçš„æ‰€æœ‰åšå®¢æ¡ç›®å¯ç”¨è¯„è®ºï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p></li></ul><p><code>Entry.objects.filter(pub_date__year=2010).update(comments_on=False)</code></p><ul><li>å¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µ ï¼ˆæ²¡æœ‰å¤šå°‘å­—æ®µçš„é™åˆ¶ï¼‰ã€‚ ä¾‹å¦‚åŒæ—¶æ›´æ–°comments_onå’Œheadlineå­—æ®µï¼š</li></ul><p><code>Entry.objects.filter(pub_date__year=2010).update(comments_on=False, headline='This is old')</code></p><p>update()æ–¹æ³•<code>æ— éœ€save</code>æ“ä½œã€‚å”¯ä¸€é™åˆ¶æ˜¯å®ƒåªèƒ½æ›´æ–°æ¨¡å‹ä¸»è¡¨ä¸­çš„åˆ—ï¼Œè€Œä¸æ˜¯å…³è”çš„æ¨¡å‹ï¼Œä¾‹å¦‚ä¸èƒ½è¿™æ ·åšï¼š</p><p><code>Entry.objects.update(blog__name='foo') # Won't work!</code></p><p>ä»ç„¶å¯ä»¥æ ¹æ®ç›¸å…³å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼š</p><p><code>Entry.objects.filter(blog__id=1).update(comments_on=True)</code></p><p>update()æ–¹æ³•è¿”å›å—å½±å“çš„è¡Œæ•°ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>64</span>)<span style=color:#ff7b72;font-weight:700>.</span>update(comments_on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(slug<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;nonexistent-slug&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>update(comments_on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&gt;&gt;&gt;</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(pub_date__year<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>2010</span>)<span style=color:#ff7b72;font-weight:700>.</span>update(comments_on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>132</span>
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä½ åªæ˜¯æ›´æ–°ä¸€ä¸‹å¯¹è±¡ï¼Œä¸éœ€è¦ä¸ºå¯¹è±¡åšåˆ«çš„äº‹æƒ…ï¼Œæœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯è°ƒç”¨update()ï¼Œè€Œä¸æ˜¯å°†æ¨¡å‹å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ ä¾‹å¦‚ï¼Œä¸è¦è¿™æ ·åšï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>e <span style=color:#ff7b72;font-weight:700>=</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e<span style=color:#ff7b72;font-weight:700>.</span>comments_on <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span></code></pre></td></tr></table></div></div><p>å»ºè®®å¦‚ä¸‹æ“ä½œï¼š</p><p><code>Entry.objects.filter(id=10).update(comments_on=False)</code></p><p>ç”¨update()è¿˜å¯ä»¥é˜²æ­¢åœ¨åŠ è½½å¯¹è±¡å’Œè°ƒç”¨save()ä¹‹é—´çš„çŸ­æ—¶é—´å†…æ•°æ®åº“ä¸­æŸäº›å†…å®¹å¯èƒ½å‘ç”Ÿæ›´æ”¹çš„ç«äº‰æ¡ä»¶ã€‚</p><p>å¦‚æœæƒ³æ›´æ–°ä¸€ä¸ªå…·æœ‰è‡ªå®šä¹‰save()æ–¹æ³•çš„æ¨¡å‹çš„è®°å½•ï¼Œè¯·å¾ªç¯éå†å®ƒä»¬å¹¶è°ƒç”¨save()ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>for</span> e <span style=color:#ff7b72;font-weight:700>in</span> Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(pub_date__year<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>2010</span>):
</span></span><span style=display:flex><span>  e<span style=color:#ff7b72;font-weight:700>.</span>comments_on <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>  e<span style=color:#ff7b72;font-weight:700>.</span>save()
</span></span></code></pre></td></tr></table></div></div><h3 id=16-delete>16. delete()<a hidden class=anchor aria-hidden=true href=#16-delete>#</a></h3><p><code>delete()</code></p><ul><li><p>æ‰¹é‡åˆ é™¤QuerySetä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶è¿”å›åˆ é™¤çš„å¯¹è±¡ä¸ªæ•°å’Œæ¯ä¸ªå¯¹è±¡ç±»å‹çš„åˆ é™¤æ¬¡æ•°çš„å­—å…¸ã€‚</p></li><li><p>delete()åŠ¨ä½œæ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚</p></li><li><p>ä¸èƒ½åœ¨QuerySetä¸Šè°ƒç”¨delete()ã€‚</p></li><li><p>ä¾‹å¦‚ï¼Œè¦åˆ é™¤ç‰¹å®šåšå®¢ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼š</p></li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>b <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>get(pk<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Delete all the entries belonging to this Blog.</span>
</span></span><span style=display:flex><span>Entry<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>filter(blog<span style=color:#ff7b72;font-weight:700>=</span>b)<span style=color:#ff7b72;font-weight:700>.</span>delete()
</span></span><span style=display:flex><span>(<span style=color:#a5d6ff>4</span>, {<span style=color:#a5d6ff>&#39;weblog.Entry&#39;</span>: <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>&#39;weblog.Entry_authors&#39;</span>: <span style=color:#a5d6ff>2</span>})
</span></span></code></pre></td></tr></table></div></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDjangoçš„ForeignKeyä½¿ç”¨SQLçº¦æŸON DELETE CASCADEï¼Œä»»ä½•å…·æœ‰æŒ‡å‘è¦åˆ é™¤çš„å¯¹è±¡çš„å¤–é”®çš„å¯¹è±¡å°†ä¸å®ƒä»¬ä¸€èµ·è¢«åˆ é™¤ã€‚ åƒè¿™æ ·ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>blogs <span style=color:#ff7b72;font-weight:700>=</span> Blog<span style=color:#ff7b72;font-weight:700>.</span>objects<span style=color:#ff7b72;font-weight:700>.</span>all()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># This will delete all Blogs and all of their Entry objects.</span>
</span></span><span style=display:flex><span>blogs<span style=color:#ff7b72;font-weight:700>.</span>delete()
</span></span><span style=display:flex><span>(<span style=color:#a5d6ff>5</span>, {<span style=color:#a5d6ff>&#39;weblog.Blog&#39;</span>: <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>&#39;weblog.Entry&#39;</span>: <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>&#39;weblog.Entry_authors&#39;</span>: <span style=color:#a5d6ff>2</span>})
</span></span></code></pre></td></tr></table></div></div><p>è¿™ç§çº§è”çš„è¡Œä¸ºå¯ä»¥é€šè¿‡çš„ForeignKeyçš„on_deleteå‚æ•°è‡ªå®šä¹‰ã€‚ï¼ˆä»€ä¹ˆæ—¶å€™è¦æ”¹å˜è¿™ç§è¡Œä¸ºå‘¢ï¼Ÿæ¯”å¦‚æ—¥å¿—æ•°æ®ï¼Œå°±ä¸èƒ½å’Œå®ƒå…³è”çš„ä¸»ä½“ä¸€å¹¶è¢«åˆ é™¤ï¼ï¼‰</p><p>delete()ä¼šä¸ºæ‰€æœ‰å·²åˆ é™¤çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬çº§è”åˆ é™¤ï¼‰å‘å‡º<code>pre_delete</code>å’Œ<code>post_delete</code>ä¿¡å·ã€‚</p><h3 id=17-as_manager>17. as_manager()<a hidden class=anchor aria-hidden=true href=#17-as_manager>#</a></h3><p><code>classmethod as_manager()</code></p><ul><li>ä¸€ä¸ªç±»æ–¹æ³•ï¼Œè¿”å›Managerçš„å®ä¾‹ä¸QuerySetçš„æ–¹æ³•çš„å‰¯æœ¬</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://luenci.me/en/posts/readme/><span class=title>Â« Prev</span><br><span>å†™åœ¨å‰é¢</span>
</a><a class=next href=https://luenci.me/en/posts/golang%E7%9A%84%E5%80%BC%E4%BC%A0%E9%80%92%E5%92%8C%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8/><span class=title>Next Â»</span><br><span></span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share  on x" href="https://x.com/intent/tweet/?text=&amp;url=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f&amp;title=&amp;summary=&amp;source=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f&title="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on whatsapp" href="https://api.whatsapp.com/send?text=%20-%20https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on telegram" href="https://telegram.me/share/url?text=&amp;url=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on ycombinator" href="https://news.ycombinator.com/submitlink?t=&u=https%3a%2f%2fluenci.me%2fen%2fposts%2fdjango%25E7%259A%2584queryset%25E8%25AF%25A6%25E8%25A7%25A3%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span><a id=running-time></a><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>ğŸ‘ï¸â€ğŸ—¨ï¸è®¿å®¢äººæ•°: <span id=busuanzi_value_site_uv></span>|
ğŸŒè®¿é—®é‡: <span id=busuanzi_value_site_pv></span></span></span><br><span>&copy; 2024 <a href=https://luenci.me/en/>Luenci</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});const RunningTimerInterval=1e3,StartTime=new Date("10/11/2018 00:00:00");function prefixZero(e){return e<10&&(e="0"+e),e}function updateTime(){const r=new Date;let e=r.getTime()-StartTime.getTime();const t=24*60*60*1e3,n=Math.floor(e/t);e-=n*t;const s=60*60*1e3,o=Math.floor(e/s);e-=o*s;const i=60*1e3,a=Math.floor(e/i);e-=a*i;const c=Math.floor(e/1e3),l=document.getElementById("running-time");l.innerText="ğŸ•š: "+n+"å¤©"+prefixZero(o)+"å°æ—¶"+prefixZero(a)+"åˆ†"+prefixZero(c)+"ç§’"}document.addEventListener("DOMContentLoaded",()=>{let e=setInterval(updateTime,RunningTimerInterval)})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>