<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>GO 代码风格指南 | Luenci</title>
<meta name=keywords content="代码风格"><meta name=description content="GO 代码风格指南
风格原则
​	有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：

清晰：代码的目的和基本原理对读者来说是清楚的。
简单性：代码以尽可能简单的方式实现其目标。
简洁：代码具有高信噪比。
可维护性：代码的编写使其易于维护。
一致性：代码与更广泛的 Google 代码库一致。
"><meta name=author content="Luenci"><link rel=canonical href=https://luenci.com/en/posts/golang%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://luenci.com/images/L.png><link rel=icon type=image/png sizes=16x16 href=https://luenci.com/images/L.png><link rel=icon type=image/png sizes=32x32 href=https://luenci.com/images/L.png><link rel=apple-touch-icon href=https://luenci.com/L.png><link rel=mask-icon href=https://luenci.com/L.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://luenci.com/en/posts/golang%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://umami.luenci.com/script.js data-website-id=b0a9e971-b470-43a2-bda9-182c654377f4></script><meta property="og:title" content="GO 代码风格指南"><meta property="og:description" content="GO 代码风格指南
风格原则
​	有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：

清晰：代码的目的和基本原理对读者来说是清楚的。
简单性：代码以尽可能简单的方式实现其目标。
简洁：代码具有高信噪比。
可维护性：代码的编写使其易于维护。
一致性：代码与更广泛的 Google 代码库一致。
"><meta property="og:type" content="article"><meta property="og:url" content="https://luenci.com/en/posts/golang%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/"><meta property="article:section" content="posts"><meta property="og:site_name" content="(〃'▽'〃)"><meta name=twitter:card content="summary"><meta name=twitter:title content="GO 代码风格指南"><meta name=twitter:description content="GO 代码风格指南
风格原则
​	有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：

清晰：代码的目的和基本原理对读者来说是清楚的。
简单性：代码以尽可能简单的方式实现其目标。
简洁：代码具有高信噪比。
可维护性：代码的编写使其易于维护。
一致性：代码与更广泛的 Google 代码库一致。
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://luenci.com/en/posts/"},{"@type":"ListItem","position":2,"name":"GO 代码风格指南","item":"https://luenci.com/en/posts/golang%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GO 代码风格指南","name":"GO 代码风格指南","description":"GO 代码风格指南 风格原则 ​\t有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：\n清晰：代码的目的和基本原理对读者来说是清楚的。 简单性：代码以尽可能简单的方式实现其目标。 简洁：代码具有高信噪比。 可维护性：代码的编写使其易于维护。 一致性：代码与更广泛的 Google 代码库一致。 ","keywords":["代码风格"],"articleBody":"GO 代码风格指南 风格原则 ​\t有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：\n清晰：代码的目的和基本原理对读者来说是清楚的。 简单性：代码以尽可能简单的方式实现其目标。 简洁：代码具有高信噪比。 可维护性：代码的编写使其易于维护。 一致性：代码与更广泛的 Google 代码库一致。 命名 下划线 Go 中的名称通常不应包含下划线。这个原则有三个例外：\n仅由生成的代码导入的包名称可能包含下划线。有关如何选择多词包名称的更多详细信息，请参阅包名称 文件中的测试、基准和示例函数名称*_test.go可能包含下划线。 与操作系统或 cgo 互操作的低级库可能会重用标识符，如syscall. 在大多数代码库中，这预计是非常罕见的。 包名 ​\tGo 包名称应该简短并且只包含小写字母。由多个单词组成的包名称应全部小写。例如，包tabwriter未命名为tabWriter、TabWriter或 tab_writer。\n​\t避免选择可能被常用局部变量名遮蔽的包名。例如，usercount是一个比 更好的包名 count，因为count是一个常用的变量名。\n​\tGo 包名称不应该有下划线。如果您需要导入名称中确实有一个包（通常来自生成的或第三方代码），则必须在导入时将其重命名为适合在 Go 代码中使用的名称。\n一个例外是仅由生成的代码导入的包名称可能包含下划线。具体例子包括：\n使用_test外部测试包的后缀，例如集成测试 使用包级文档示例_test的后缀 ​\t避免使用无意义的包名称，例如util, utility, common,helper等。查看更多关于 所谓的“实用程序包”的信息。\n​\t当导入的包被重命名（例如import foopb \"path/to/foo_go_proto\"）时，包的本地名称必须符合上述规则，因为本地名称决定了包中的符号在文件中的引用方式。如果给定的导入在多个文件中重命名，特别是在相同或附近的包中，则应尽可能使用相同的本地名称以保持一致性。\n另请参阅：https://go.dev/blog/package-names\n参数别名 接收器变量名称必须是：\n短（通常是一两个字母的长度） 类型本身的缩写 一致地应用于该类型的每个接收器 长名 更好的名字 func (tray Tray) func (t Tray) func (info *ResearchInfo) func (ri *ResearchInfo) func (this *ReportWriter) func (w *ReportWriter) func (self *Scanner) func (s *Scanner) 常量名称 ​\t常量名称必须像 Go 中的所有其他名称一样使用MixedCaps（导出 的常量以大写字母开头，而未导出的常量以小写字母开头。）即使它打破了其他语言的约定，这也适用。\n​\t常量名称不应是其值的派生词，而应解释值的含义。\n1 2 3 4 5 6 7 8 // Good: const MaxPacketSize = 512 const ( ExecuteBit = 1 \u003c\u003c iota WriteBit ReadBit ) 不要使用非 MixedCaps 常量名称或带有K前缀的常量。\n1 2 3 4 // Bad: const MAX_PACKET_SIZE = 512 const kMaxBufferSize = 1024 const KMaxUsersPergroup = 500 根据它们的角色而不是它们的值来命名常量。如果一个常量除了它的值之外没有其他作用，那么就没有必要将它定义为一个常量。\n1 2 3 4 5 6 7 // Bad: const Twelve = 12 const ( UserNameColumn = \"username\" GroupColumn = \"group\" ) 缩写词 ​\t名称中的首字母缩略词或首字母缩略词（例如，URL和NATO）应该具有相同的大小写。URL应显示为URL或url（如urlPony, 或 URLPony），绝不能显示为Url. 这也适用于ID“标识符”的缩写；写appID而不是appId。\n在具有多个首字母缩写词的名称中（例如XMLAPI，因为它包含XML and API），给定首字母缩写词中的每个字母都应该具有相同的大小写，但名称中的每个首字母缩写词不需要具有相同的大小写。 在首字母缩写包含小写字母（例如DDoS, iOS, gRPC）的名称中，首字母缩写应该像在标准散文中一样出现，除非您需要为了导出性而更改第一个字母。在这些情况下，整个首字母大写应该是相同的情况（例如ddos, IOS, GRPC）。 初始主义 范围 正确的 不正确 XML API 已出口 XMLAPI XmlApi, XMLApi, XmlAPI,XMLapi XML API 未出口 xmlAPI xmlapi,xmlApi iOS 已出口 IOS Ios,IoS iOS 未出口 iOS ios gRPC 已出口 GRPC Grpc gRPC 未出口 gRPC grpc 分布式拒绝服务 已出口 DDoS DDOS,Ddos 分布式拒绝服务 未出口 ddos dDoS,dDOS 函数名称 ​\t函数和方法名称不应使用Get或get前缀，除非底层概念使用单词“get”（例如 HTTP GET）。更喜欢直接以名词开头的名称，例如使用Countsover GetCounts。\n如果该函数涉及执行复杂的计算或执行远程调用，则可以使用不同的词（如Compute或）代替，以向读者清楚地表明函数调用可能需要时间并且可能会阻塞或失败。Fetch Get\n变量名 一般的经验法则是，名称的长度应与其范围的大小成正比，并与其在该范围内使用的次数成反比。在文件范围内创建的变量可能需要多个单词，而作用域为单个内部块的变量可能是单个单词甚至只是一两个字符，以保持代码清晰并避免无关信息。\n这是一个粗略的基线。这些数字准则不是严格的规则。根据上下文、清晰度和简洁性应用判断。\n小范围是执行一两个小操作的范围，比如 1-7 行。 中等范围是一些小的或一个大的操作，比如 8-15 行。 大范围是一个或几个大操作，比如 15-25 行。 非常大的范围是指超过一页（例如，超过 25 行）的任何内容。 在小范围内可能非常清楚的名称（例如，c对于计数器）在较大范围内可能是不够的，并且需要澄清以提醒读者其在代码中的目的。一个作用域中有很多变量，或者表示相似值或概念的变量，可能需要比作用域建议的更长的变量名称。\n概念的特殊性也有助于保持变量名称的简洁。例如，假设只有一个数据库在使用，像db这样的短变量名通常可能为非常小的范围保留，即使范围非常大也可能保持完全清晰。在这种情况下，根据范围的大小，单个词 database可能是可以接受的，但不是必需的，因为这db是一个非常常见的词缩写，几乎没有其他解释。\n局部变量的名称应该反映它包含的内容以及它在当前上下文中的使用方式，而不是值的来源。例如，通常情况下最佳局部变量名称与结构或协议缓冲区字段名称不同。\n一般来说：\n像count或这样的单词名称options是一个很好的起点。\n可以添加其他词来消除相似名称的歧义，例如 userCountand projectCount。\n不要为了节省打字而简单地放下字母。例如Sandbox比 更受欢迎Sbx，特别是对于导出的名称。\n从大多数变量名中 省略\n类型和类似类型的词。\n对于数字，userCount是比numUsersor 更好的名称usersInt。 对于切片，users是一个比userSlice. 如果范围内有两个版本的值，则包含类似类型的限定符是可以接受的，例如，您可能将输入存储在解析值中ageString并age用于解析值。 省略周围上下文清楚的词。例如，在一个UserCount方法的实现中，调用的一个局部变量 userCount很可能是多余的；count, users, 甚至c都一样可读。\n单字母变量名 单字母变量名可能是减少 重复的有用工具，但也可能使代码不必要地变得不透明。将它们的使用限制在完整单词很明显以及它会重复出现以代替单字母变量的情况。\n一般来说：\n对于方法接收者变量，首选一个字母或两个字母的名称。 对常见类型使用熟悉的变量名通常很有帮助： r对于一个io.Reader或*http.Request w对于一个io.Writer或http.ResponseWriter 单字母标识符作为整数循环变量是可接受的，特别是对于索引（例如，i）和坐标（例如，x和y）。 当范围很短时，缩写可以是可接受的循环标识符，例如for _, n := range nodes { ... }. 重复 ​\t一段 Go 源代码应该避免不必要的重复。一个常见的来源是重复名称，其中通常包含不必要的单词或重复其上下文或类型。如果相同或相似的代码段在很近的地方多次出现，代码本身也可能是不必要的重复。\n重复命名可以有多种形式，包括：\n包与导出的符号名称 ​\t命名导出的符号时，包的名称始终在包外可见，因此应减少或消除两者之间的冗余信息。如果一个包仅导出一种类型并且它以包本身命名，则构造函数的规范名称是Newif one is required。\n**示例：**重复名称 -\u003e 更好的名称\nwidget.NewWidget-\u003ewidget.New widget.NewWidgetWithName-\u003ewidget.NewWithName db.LoadFromDatabase-\u003edb.Load goatteleportutil.CountGoatsTeleported-\u003egtutil.CountGoatsTeleported 或goatteleport.Count myteampb.MyTeamMethodRequest-\u003emtpb.MyTeamMethodRequest或 myteampb.MethodRequest 变量名与类型 ​\t编译器总是知道变量的类型，并且在大多数情况下，读者也可以通过变量的使用方式清楚地知道变量是什么类型。如果一个变量的值在同一范围内出现两次，则只需明确变量的类型。\n重复名称 更好的名字 var numUsers int var users int var nameString string var name string var primaryProject *Project var primary *Project 如果该值以多种形式出现，则可以使用像rawandparsed或底层表示这样的额外词来澄清：\n1 2 3 4 5 6 // Good: limitStr := r.FormValue(\"limit\") limit, err := strconv.Atoi(limitStr) // Good: limitRaw := r.FormValue(\"limit\") limit, err := strconv.Atoi(limitRaw) 外部上下文与本地名称 ​\t包含来自周围上下文信息的名称通常会产生额外的噪音而没有任何好处。包名、方法名、类型名、函数名、导入路径，甚至文件名都可以提供自动限定其中所有名称的上下文。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // Bad: // In package \"ads/targeting/revenue/reporting\" type AdsTargetingRevenueReport struct{} func (p *Project) ProjectName() string // Good: // In package \"ads/targeting/revenue/reporting\" type Report struct{} func (p *Project) Name() string // Bad: // In package \"sqldb\" type DBConnection struct{} // Good: // In package \"sqldb\" type Connection struct{} // Bad: // In package \"ads/targeting\" func Process(in *pb.FooProto) *Report { adsTargetingID := in.GetAdsTargetingID() } // Good: // In package \"ads/targeting\" func Process(in *pb.FooProto) *Report { id := in.GetAdsTargetingID() } ​\t重复通常应该在符号用户的上下文中进行评估，而不是孤立地进行评估。例如，下面的代码有很多名称，在某些情况下可能没问题，但在上下文中是多余的：\n1 2 3 4 5 6 7 8 9 // Bad: func (db *DB) UserCount() (userCount int, err error) { var userCountInt64 int64 if dbLoadError := db.LoadFromDatabase(\"count(distinct users)\", \u0026userCountInt64); dbLoadError != nil { return 0, fmt.Errorf(\"failed to load user count: %s\", dbLoadError) } userCount = int(userCountInt64) return userCount, nil } 相反，通常可以省略有关从上下文或用法中清楚的名称的信息：\n1 2 3 4 5 6 7 8 // Good: func (db *DB) UserCount() (int, error) { var count int64 if err := db.Load(\"count(distinct users)\", \u0026count); err != nil { return 0, fmt.Errorf(\"failed to load user count: %s\", err) } return int(count), nil } imports 导入重命名 ​\t只应重命名导入以避免与其他导入的名称冲突。（由此推论，好的包名不应该需要重命名。）在名称冲突的情况下，更愿意重命名最本地或特定于项目的导入。包的本地名称（别名）必须遵循 包命名指南，包括禁止使用下划线和大写字母。\n​\t生成的 protocol buffer 包必须重命名以从名称中删除下划线，并且它们的别名必须有pb后缀。有关详细信息，请参阅 原型和存根最佳实践。\n1 2 3 4 // Good: import ( fspb \"path/to/package/foo_service_go_proto\" ) 导入的包名称没有有用的识别信息（例如 package v1）应该重命名以包括以前的路径组件。重命名必须与导入相同包的其他本地文件一致，并且可以包括版本号。\n**注意：**最好重命名包以符合 良好的包名称，但这对于 vendored 目录中的包通常不可行。\n1 2 3 4 5 // Good: import ( core \"github.com/kubernetes/api/core/v1\" meta \"github.com/kubernetes/apimachinery/pkg/apis/meta/v1beta1\" ) ​\t如果您需要导入一个名称与您要使用的公共局部变量名称（例如url, ssh）冲突的包，并且您希望重命名该包，首选方法是使用pkg后缀（例如urlpkg）。请注意，可以使用局部变量隐藏包；仅当此类变量在范围内时仍需要使用包时，才需要重命名。\n导入分组 导入应分为两组：\n标准库包 其他（项目和销售）包 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Good: package main import ( \"fmt\" \"hash/adler32\" \"os\" \"github.com/dsnet/compress/flate\" \"golang.org/x/text/encoding\" \"google.golang.org/protobuf/proto\" foopb \"myproj/foo/proto/proto\" _ \"myproj/rpc/protocols/dial\" _ \"myproj/security/auth/authhooks\" ) ​\t将项目包分成多个组是可以接受的，例如，如果您想要一个单独的组来重命名、import-only-for-side-effects 或另一个特殊的导入组。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Good: package main import ( \"fmt\" \"hash/adler32\" \"os\" \"github.com/dsnet/compress/flate\" \"golang.org/x/text/encoding\" \"google.golang.org/protobuf/proto\" foopb \"myproj/foo/proto/proto\" _ \"myproj/rpc/protocols/dial\" _ \"myproj/security/auth/authhooks\" ) ​\t注意：goimports工具不支持维护可选组 - 超出标准库和 Google 导入之间强制分离所需的拆分。额外的导入子组需要作者和审稿人的注意，以保持符合状态。\n​\t也是 AppEngine 应用程序的 Google 程序应该有一个单独的组用于 AppEngine 导入。\n导入“空白” ( import _) 仅为了副作用import _ \"package\"而导入的包（使用语法 ）只能在主包或需要它们的测试中导入。\n此类软件包的一些示例包括：\n时间/tzdata 图像处理代码中的image/jpeg 避免在库包中导入空白，即使库间接依赖于它们。将副作用导入限制到主包有助于控制依赖性，并使得编写依赖于不同导入的测试成为可能，而不会发生冲突或浪费构建成本。\n以下是此规则的唯一例外情况：\n您可以使用空白导入绕过 nogo 静态检查器中对不允许导入的检查。 您可以在使用编译器指令的源文件中使用嵌入包的空白导入。//go:embed **提示：**如果您创建的库包间接依赖于生产中的副作用导入，请记录预期用途。\n导入“点”( import .) ​\timport .表单是一种语言功能，允许将从另一个包导出的标识符无条件地带到当前包中。有关更多信息，请参阅语言规范。\n不要在 Google 代码库中使用此功能；这使得更难判断功能来自何处。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Bad: package foo_test import ( \"bar/testutil\" // also imports \"foo\" . \"foo\" ) var myThing = Bar() // Bar defined in package foo; no qualification needed. // Good: package foo_test import ( \"bar/testutil\" // also imports \"foo\" \"foo\" ) var myThing = foo.Bar() 错误 返回错误 ​\t用于error表示函数可能会失败。按照惯例，error是最后一个结果参数。\n1 2 // Good: func Good() error { /* ... */ } ​\t返回nil错误是表示操作成功的惯用方式，否则可能会失败。如果函数返回错误，除非另有明确说明，否则调用者必须将所有非错误返回值视为未指定。通常，非错误返回值是它们的零值，但这不能假设。\n1 2 3 4 5 6 7 8 // Good: func GoodLookup() (*Result, error) { // ... if err != nil { return nil, err } return res, nil } ​\t返回错误的导出函数应该使用error类型返回它们。具体的错误类型容易受到细微错误的影响：具体的nil指针可以包装到接口中，从而变成非零值（请参阅 主题上的 Go FAQ 条目）。\n1 2 // Bad: func Bad() *os.PathError { /*...*/ } ​\t提示：带有context.Context参数的函数通常应返回一个error，以便调用者可以确定在函数运行时上下文是否被取消。\n错误字符串 ​\t错误字符串不应大写（除非以导出名称、专有名词或首字母缩写词开头）并且不应以标点符号结尾。这是因为错误字符串通常在打印给用户之前出现在其他上下文中。\n1 2 3 4 // Bad: err := fmt.Errorf(\"Something bad happened.\") // Good: err := fmt.Errorf(\"something bad happened\") ​\t另一方面，完整显示消息（日志记录、测试失败、API 响应或其他 UI）的样式取决于，但通常应大写。\n1 2 3 4 // Good: log.Infof(\"Operation aborted: %v\", err) log.Errorf(\"Operation aborted: %v\", err) t.Errorf(\"Op(%q) failed unexpectedly; err=%v\", args, err) 处理错误 ​\t遇到错误的代码应该慎重选择如何处理它。_使用变量丢弃错误通常是不合适的。如果函数返回错误，请执行以下操作之一：\n立即处理并解决错误。 将错误返回给调用者。 在特殊情况下，请致电log.Fatal或（如果绝对必要） panic。 注意： log.Fatalf不是标准库日志。参见 [#logging]。\n​\t在极少数情况下，忽略或丢弃错误是合适的（例如(*bytes.Buffer).Write，记录的调用永远不会失败），随附的注释应该解释为什么这是安全的。\n1 2 3 4 // Good: var b *bytes.Buffer n, _ := b.Write(p) // never returns a non-nil error 有关错误处理的更多讨论和示例，请参阅 Effective Go and best practices。\n带内错误 ​\t在 C 和类似语言中，函数返回值（如 -1、null 或空字符串）以表示错误或缺少结果是很常见的。这称为带内错误处理。\n1 2 3 // Bad: // Lookup returns the value for key or -1 if there is no mapping for key. func Lookup(key string) int ​\t未能检查带内错误值可能会导致错误，并将错误归因于错误的函数。\n1 2 3 4 // Bad: // The following line returns an error that Parse failed for the input value, // whereas the failure was that there is no mapping for missingKey. return Parse(Lookup(missingKey)) ​\tGo 对多个返回值的支持提供了更好的解决方案（请参阅 Effective Go 部分的多个返回值）。函数不应要求客户端检查带内错误值，而应返回一个附加值以指示其其他返回值是否有效。这个返回值可能是一个错误，也可能是一个布尔值，无需解释，应该是最终的返回值。\n1 2 3 // Good: // Lookup returns the value for key or ok=false if there is no mapping for key. func Lookup(key string) (value string, ok bool) ​\t此 API 可防止调用者错误写入Parse(Lookup(key))而导致编译时错误，因为Lookup(key)它有 2 个输出。\n以这种方式返回错误鼓励更健壮和明确的错误处理：\n1 2 3 4 5 6 // Good: value, ok := Lookup(key) if !ok { return fmt.Errorf(\"no value for %q\", key) } return Parse(value) ​\t一些标准库函数，如 package中的函数strings，返回带内错误值。这极大地简化了字符串操作代码，但代价是需要程序员更加勤奋。一般来说，Google 代码库中的 Go 代码应该为错误返回额外的值。\n缩进错误流程 ​\t在继续您的代码的其余部分之前处理错误。这通过使读者能够快速找到正常路径来提高代码的可读性。同样的逻辑适用于任何测试条件然后以终止条件结束的块（例如return，，，panic）log.Fatal。\n​\t如果不满足终止条件，则运行的代码应出现在if 块之后，并且不应在else子句中缩进。\n1 2 3 4 5 6 7 8 9 10 11 12 // Good: if err != nil { // error handling return // or continue, etc. } // normal code // Bad: if err != nil { // error handling } else { // normal code that looks abnormal due to indentation } **提示：**如果您在多行代码中使用一个变量，通常不值得使用if-with-initializer 样式。在这些情况下，通常最好将声明移出并使用标准if 语句：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // Good: x, err := f() if err != nil { // error handling return } // lots of code that uses x // across multiple lines // Bad: if x, err := f(); err != nil { // error handling return } else { // lots of code that uses x // across multiple lines } 有关详细信息，请参阅Go 技巧 #1：视线和 TotT：通过减少嵌套 来降低代码复杂性。\n文字格式语法 无切片 ​\tnil对于大多数用途，空切片和空切片之间没有功能差异。内置函数在切片上的表现len和cap预期一样。nil\n1 2 3 4 5 6 7 8 9 10 11 12 // Good: import \"fmt\" var s []int // nil fmt.Println(s) // [] fmt.Println(len(s)) // 0 fmt.Println(cap(s)) // 0 for range s {...} // no-op s = append(s, 42) fmt.Println(s) // [42] ​\t如果您将空切片声明为局部变量（尤其是如果它可以作为返回值的来源），则首选 nil 初始化以降低调用者出现错误的风险。\n1 2 3 4 5 // Good: var t []string // Bad: t := []string{} ​\t不要创建强制其客户区分 nil 和空切片的 API。\n1 2 3 4 5 6 7 8 9 10 // Good: // Ping pings its targets. // Returns hosts that successfully responded. func Ping(hosts []string) ([]string, error) { ... } // Bad: // Ping pings its targets and returns a list of hosts // that successfully responded. Can be empty if the input was empty. // nil signifies that a system error occurred. func Ping(hosts []string) []string { ... } ​\t在设计接口时，避免区分nil切片和nil非零长度切片，因为这会导致细微的编程错误。这通常是通过使用lento 检查是否为空来完成的，而不是== nil.\n​\t此实现接受两个nil和零长度切片为“空”：\n1 2 3 4 5 6 7 8 // Good: // describeInts describes s with the given prefix, unless s is empty. func describeInts(prefix string, s []int) { if len(s) == 0 { return } fmt.Println(prefix, s) } ​\t而不是依赖于区别作为 API 的一部分：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Bad: func maybeInts() []int { /* ... */ } // describeInts describes s with the given prefix; pass nil to skip completely. func describeInts(prefix string, s []int) { // The behavior of this function unintentionally changes depending on what // maybeInts() returns in 'empty' cases (nil or []int{}). if s == nil { return } fmt.Println(prefix, s) } describeInts(\"Here are some ints:\", maybeInts()) 有关进一步讨论，请参阅带内错误。\n函数格式化 函数或方法声明的签名应保留在一行中以避免缩进混淆。\n函数参数列表可以构成 Go 源文件中最长的几行。但是，它们先于缩进的变化，因此很难以不使后续行看起来像函数体的一部分的方式以令人困惑的方式断行：\n1 2 3 4 5 6 // Bad: func (r *SomeType) SomeLongFunctionName(foo1, foo2, foo3 string, foo4, foo5, foo6 int) { foo7 := bar(foo1) // ... } 请参阅最佳实践，了解一些选项，以缩短函数的调用站点，否则会有很多参数。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // Good: good := foo.Call(long, CallOptions{ Names: list, Of: of, The: parameters, Func: all, Args: on, Now: separate, Visible: lines, }) // Bad: bad := foo.Call( long, list, of, parameters, all, on, separate, lines, ) 通常可以通过分解出局部变量来缩短行。\n1 2 3 // Good: local := helper(some, parameters, here) good := foo.Call(list, of, parameters, local) ​\t同样，函数和方法调用不应仅根据行长度来分开。\n1 2 3 4 5 // Good: good := foo.Call(long, list, of, parameters, all, on, one, line) // Bad: bad := foo.Call(long, list, of, parameters, with, arbitrary, line, breaks) ​\t不要为特定的函数参数添加注释。相反，使用 选项结构或向函数文档添加更多详细信息。\n1 2 3 4 5 6 7 // Good: good := server.New(ctx, server.Options{Port: 42}) // Bad: bad := server.New( ctx, 42, // Port ) ​\t如果调用站点长得让人不舒服，请考虑重构：\n1 2 3 4 5 6 7 8 9 10 // Good: // Sometimes variadic arguments can be factored out replacements := []string{ \"from\", \"to\", // related values can be formatted adjacent to one another \"source\", \"dest\", \"original\", \"new\", } // Use the replacement struct as inputs to NewReplacer. replacer := strings.NewReplacer(replacements...) ​\t如果 API 无法更改或本地调用异常（无论调用是否太长），如果有助于理解调用，则始终允许添加换行符。\n1 2 3 4 5 6 7 8 9 10 11 // Good: canvas.RenderCube(cube, x0, y0, z0, x0, y0, z1, x0, y1, z0, x0, y1, z1, x1, y0, z0, x1, y0, z1, x1, y1, z0, x1, y1, z1, ) 请注意，上例中的线条并未环绕在特定的列边界处，而是根据坐标三元组进行分组。\n​\t函数内的长字符串字面值不应因行长而被打断。对于包含此类字符串的函数，可以在字符串格式后添加换行符，并且可以在下一行或后续行提供参数。关于换行符应该去哪里的决定最好基于输入的语义分组，而不是纯粹基于行的长度。\n1 2 3 4 5 6 7 8 9 10 // Good: log.Warningf(\"Database key (%q, %d, %q) incompatible in transaction started by (%q, %d, %q)\", currentCustomer, currentOffset, currentKey, txCustomer, txOffset, txKey) // Bad: log.Warningf(\"Database key (%q, %d, %q) incompatible in\"+ \" transaction started by (%q, %d, %q)\", currentCustomer, currentOffset, currentKey, txCustomer, txOffset, txKey) 条件和循环 ​\t声明if不应断行；多行if子句会导致 缩进混乱。\n1 2 3 4 5 6 7 // Bad: // The second if statement is aligned with the code within the if block, causing // indentation confusion. if db.CurrentStatusIs(db.InTransaction) \u0026\u0026 db.ValuesEqual(db.TransactionKey(), row.Key()) { return db.Errorf(db.TransactionError, \"query failed: row (%v): key does not match transaction key\", row) } 如果不需要短路行为，可以直接提取布尔操作数：\n1 2 3 4 5 6 // Good: inTransaction := db.CurrentStatusIs(db.InTransaction) keysMatch := db.ValuesEqual(db.TransactionKey(), row.Key()) if inTransaction \u0026\u0026 keysMatch { return db.Error(db.TransactionError, \"query failed: row (%v): key does not match transaction key\", row) } 可能还可以提取其他局部变量，尤其是在条件已经重复的情况下：\n1 2 3 4 5 6 7 8 9 10 // Good: uid := user.GetUniqueUserID() if db.UserIsAdmin(uid) || db.UserHasPermission(uid, perms.ViewServerConfig) || db.UserHasPermission(uid, perms.CreateGroup) { // ... } // Bad: if db.UserIsAdmin(user.GetUniqueUserID()) || db.UserHasPermission(user.GetUniqueUserID(), perms.ViewServerConfig) || db.UserHasPermission(user.GetUniqueUserID(), perms.CreateGroup) { // ... } if包含闭包或多行结构文字的语句应确保大括号匹配以避免 缩进混淆。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Good: if err := db.RunInTransaction(func(tx *db.TX) error { return tx.Execute(userUpdate, x, y, z) }); err != nil { return fmt.Errorf(\"user update failed: %s\", err) } // Good: if _, err := client.Update(ctx, \u0026upb.UserUpdateRequest{ ID: userID, User: user, }); err != nil { return fmt.Errorf(\"user update failed: %s\", err) } 同样，不要尝试在for语句中插入人为的换行符。如果没有优雅的重构方式，你总是可以让这条线很长：\n1 2 3 4 // Good: for i, max := 0, collection.Size(); i \u003c max \u0026\u0026 !collection.HasPendingWriters(); i++ { // ... } 但是，通常有：\n1 2 3 4 5 6 7 // Good: for i, max := 0, collection.Size(); i \u003c max; i++ { if collection.HasPendingWriters() { break } // ... } switch和case语句也应该保持在一行中。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Good: switch good := db.TransactionStatus(); good { case db.TransactionStarting, db.TransactionActive, db.TransactionWaiting: // ... case db.TransactionCommitted, db.NoTransaction: // ... default: // ... } // Bad: switch bad := db.TransactionStatus(); bad { case db.TransactionStarting, db.TransactionActive, db.TransactionWaiting: // ... case db.TransactionCommitted, db.NoTransaction: // ... default: // ... } 如果行太长，缩进所有的案例并用空行分隔它们以避免缩进混淆：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Good: switch db.TransactionStatus() { case db.TransactionStarting, db.TransactionActive, db.TransactionWaiting, db.TransactionCommitted: // ... case db.NoTransaction: // ... default: // ... } 在比较变量和常量的条件语句中，将变量值放在相等运算符的左侧：\n1 2 3 4 // Good: if result == \"foo\" { // ... } 取而代之的是常数首先出现的不太清晰的措辞（“Yoda style conditionals”）：\n1 2 3 4 // Bad: if \"foo\" == result { // ... } 复制 为避免意外的别名和类似错误，从另一个包复制结构时要小心。例如，sync.Mutex 不得复制诸如此类的同步对象。\n该bytes.Buffer类型包含一个[]byte切片，并且作为对小字符串的优化，还包含一个切片可能引用的小字节数组。如果您复制 a Buffer，则副本中的切片可能会为原始数组设置别名，从而导致后续方法调用产生令人惊讶的效果。\nT通常，如果类型的方法与指针类型关联，则不要复制该类型的值*T。\n1 2 3 // Bad: b1 := bytes.Buffer{} b2 := b1 调用采用值接收器的方法可以隐藏副本。当您编写 API 时，如果您的结构包含不应复制的字段，您通常应该获取和返回指针类型。\n这些是可以接受的：\n1 2 3 4 5 6 7 8 9 10 11 // Good: type Record struct { buf bytes.Buffer // other fields omitted } func New() *Record {...} func (r *Record) Process(...) {...} func Consumer(r *Record) {...} 但这些通常是错误的：\n1 2 3 4 5 6 7 8 9 10 // Bad: type Record struct { buf bytes.Buffer // other fields omitted } func (r Record) Process(...) {...} // Makes a copy of r.buf func Consumer(r Record) {...} // Makes a copy of r.buf 本指南也适用于复印sync.Mutex。\n接口 ​\tGo接口通常属于使用接口类型值的包，而不是实现接口类型的包。实施包应该返回具体的（通常是指针或结构）类型。这样，无需大量重构即可将新方法添加到实现中。有关详细信息，请参阅GoTip #49：接受接口，返回具体类型 。\n​\t不要从使用接口的 API 导出接口的测试替身实现。相反，设计 API 以便可以使用实际实现的公共 API对其进行测试。有关详细信息，请参阅 GoTip #42：编写用于测试的存根。即使在使用真实实现不可行的情况下，也可能没有必要引入一个完全覆盖真实类型中所有方法的接口；消费者可以创建一个仅包含其所需方法的接口，如 GoTip #78：最小可行接口中所示。\n​\t要测试使用 Stubby RPC 客户端的包，请使用真实的客户端连接。如果无法在测试中运行真实服务器，Google 的内部做法是使用内部 rpctest 包（即将推出！）获取到本地 [test double] 的真实客户端连接。\n​\t不要在使用之前定义接口（请参阅 TotT：代码健康：消除 YAGNI 气味）(YAGNI: 你不需要它（ You Aren’t Gonna Need It)。如果没有实际的使用示例，就很难判断一个接口是否必要，更不用说它应该包含哪些方法了。\n软件开发的大部分成本是维护成本。减少维护成本的一个方法是：“只在当你真正需要它时，才去编写它”。\n如果包的用户不需要为他们传递不同的类型，请不要使用接口类型参数。\n不要导出包的用户不需要的接口。\n**TODO：**在接口上写一个更深入的文档并在此处链接到它。\n1 2 3 4 5 6 // Good: package consumer // consumer.go type Thinger interface { Thing() bool } func Foo(t Thinger) string { ... } 1 2 3 4 5 6 7 // Good: package consumer // consumer_test.go type fakeThinger struct{ ... } func (t fakeThinger) Thing() bool { ... } ... if Foo(fakeThinger{...}) == \"x\" { ... } 1 2 3 4 5 6 7 8 9 // Bad: package producer type Thinger interface { Thing() bool } type defaultThinger struct{ ... } func (t defaultThinger) Thing() bool { ... } func NewThinger() Thinger { return defaultThinger{ ... } } 1 2 3 4 5 6 7 // Good: package producer type Thinger struct{ ... } func (t Thinger) Thing() bool { ... } func NewThinger() Thinger { return Thinger{ ... } } 传值 不要为了节省几个字节而将指针作为函数参数传递。\n​\t如果一个函数x只读取它的参数*x，那么这个参数不应该是一个指针。这方面的常见实例包括传递一个指向字符串 ( *string) 的指针或一个指向接口值 ( *io.Reader) 的指针。在这两种情况下，值本身都是固定大小的，可以直接传递。\n​\t此建议不适用于大型结构，甚至可能会增加大小的小型结构。特别是，protocol buffer 消息通常应该由指针而不是值来处理。指针类型满足 proto.Message接口（被 , 等接受proto.Marshal）protocmp.Transform，并且协议缓冲区消息可能非常大，并且通常会随着时间的推移而变大。\n接收器类型 ​\t方法接收者可以作为值或指针传递，就好像它是常规函数参数一样。选择哪个应该基于该方法应该属于哪个方法集。\n​\t**正确性胜过速度或简单性。**在某些情况下，您必须使用指针值。在其他情况下，如果您对代码将如何增长没有很好的了解，则为大型类型选择指针或作为面向未来的指针，并为简单的普通旧数据使用值。\n下面的列表更详细地说明了每个案例：\n如果接收者是一个切片并且该方法不重新切片或重新分配切片，请使用值而不是指针。\n1 2 3 4 // Good: type Buffer []byte func (b Buffer) Len() int { return len(b) } 如果该方法需要改变接收者，则接收者必须是一个指针。\n1 2 3 4 5 6 7 8 9 // Good: type Counter int func (c *Counter) Inc() { *c++ } // See https://pkg.go.dev/container/heap. type Queue []Item func (q *Queue) Push(x Item) { *q = append([]Item{x}, *q...) } 如果接收者是一个包含 无法安全复制的字段的结构，请使用指针接收者。常见的例子是sync.Mutex和其他同步类型。\n1 2 3 4 5 6 7 8 9 10 11 // Good: type Counter struct { mu sync.Mutex total int } func (c *Counter) Inc() { c.mu.Lock() defer c.mu.Unlock() c.total++ } **提示：**检查类型的Godoc以获取有关复制是否安全的信息。\n如果接收器是“大”结构或数组，指针接收器可能更有效。传递结构等同于将其所有字段或元素作为参数传递给方法。如果这看起来太大而不能 按值传递，那么指针是一个不错的选择。\n对于将调用或与其他修改接收器的函数同时运行的方法，如果这些修改对您的方法不可见，请使用一个值；否则使用指针。\n如果接收器是一个结构或数组，其中任何一个元素都是指向可能发生变化的东西的指针，则更喜欢指针接收器以使读者清楚地了解可变性的意图。\n1 2 3 4 5 6 7 8 // Good: type Counter struct { m *Metric } func (c *Counter) Inc() { c.m.Add(1) } 如果接收者是内置类型，例如整数或字符串，不需要修改，则使用值。\n1 2 3 4 // Good: type User string func (u User) String() { return string(u) } 如果接收者是映射、函数或通道，请使用值而不是指针。\n1 2 3 4 5 // Good: // See https://pkg.go.dev/net/http#Header. type Header map[string][]string func (h Header) Add(key, value string) { /* omitted */ } 如果接收者是一个“小”数组或结构，它自然是一个没有可变字段和指针的值类型，那么值接收者通常是正确的选择。\n1 2 3 4 5 // Good: // See https://pkg.go.dev/time#Time. type Time struct { /* omitted */ } func (t Time) Add(d Duration) Time { /* omitted */ } 如有疑问，请使用指针接收器。\n作为一般准则，更喜欢使类型的方法全部为指针方法或全部为值方法。\n**注意：**关于将值或指针传递给函数是否会影响性能，存在很多错误信息。编译器可以选择将指针传递给堆栈上的值以及复制堆栈上的值，但在大多数情况下，这些考虑不应超过代码的可读性和正确性。当性能确实很重要时，重要的是在决定一种方法优于另一种方法之前，用一个现实的基准来分析这两种方法。\nswitch和break ​\t不要在子句break末尾使用没有目标标签的switch 语句；他们是多余的。与 C 和 Java 不同，switchGo 中的子句会自动中断，并且需要一条fallthrough语句来实现 C 风格的行为。break如果您想阐明空子句的目的，请使用注释而不是。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // Good: switch x { case \"A\", \"B\": buf.WriteString(x) case \"C\": // handled outside of the switch statement default: return fmt.Errorf(\"unknown value: %q\", x) } // Bad: switch x { case \"A\", \"B\": buf.WriteString(x) break // this break is redundant case \"C\": break // this break is redundant default: return fmt.Errorf(\"unknown value: %q\", x) } **注意：**如果switch子句在for循环内，则使用breakwithin switch不会退出封闭for循环。\n1 2 3 4 5 6 for { switch x { case \"A\": break // exits the switch, not the loop } } for要退出封闭循环，请在语句上使用标签：\n1 2 3 4 5 6 7 loop: for { switch x { case \"A\": break loop // exits the loop } } ","wordCount":"11159","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Luenci"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luenci.com/en/posts/golang%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"Luenci","logo":{"@type":"ImageObject","url":"https://luenci.com/images/L.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luenci.com/en/ accesskey=h title="Luenci (Alt + H)"><img src=https://luenci.com/images/avatar.jpg alt aria-label=logo height=35>Luenci</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luenci.com/en/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://luenci.com/en/posts title=📚文章><span>📚文章</span></a></li><li><a href=https://luenci.com/en/search title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://luenci.com/en/archives title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://luenci.com/en/tags title=🔖标签><span>🔖标签</span></a></li><li><a href=https://luenci.com/en/about title=🙋🏻‍♂️关于><span>🙋🏻‍♂️关于</span></a></li><li><a href=https://luenci.com/en/links title=🤝友链><span>🤝友链</span></a></li><li><a href=https://luenci.com/en/index.xml title=📬RSS><span>📬RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luenci.com/en/>Home</a>&nbsp;»&nbsp;<a href=https://luenci.com/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">GO 代码风格指南</h1><div class=post-meta>📅最后更新:&nbsp;0001-01-01&nbsp|&nbsp⏲︎时长: 23 min&nbsp|&nbsp📖字数: 11159 words&nbsp;|&nbsp;Luenci</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#go-%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97 aria-label="GO 代码风格指南">GO 代码风格指南</a><ul><li><a href=#%e9%a3%8e%e6%a0%bc%e5%8e%9f%e5%88%99 aria-label=风格原则>风格原则</a></li><li><a href=#%e5%91%bd%e5%90%8d aria-label=命名>命名</a><ul><li><a href=#%e4%b8%8b%e5%88%92%e7%ba%bf aria-label=下划线>下划线</a></li><li><a href=#%e5%8c%85%e5%90%8d aria-label=包名>包名</a></li><li><a href=#%e5%8f%82%e6%95%b0%e5%88%ab%e5%90%8d aria-label=参数别名>参数别名</a></li><li><a href=#%e5%b8%b8%e9%87%8f%e5%90%8d%e7%a7%b0 aria-label=常量名称>常量名称</a></li><li><a href=#%e7%bc%a9%e5%86%99%e8%af%8d aria-label=缩写词>缩写词</a></li><li><a href=#%e5%87%bd%e6%95%b0%e5%90%8d%e7%a7%b0 aria-label=函数名称>函数名称</a></li><li><a href=#%e5%8f%98%e9%87%8f%e5%90%8d aria-label=变量名>变量名</a><ul><li><a href=#%e5%8d%95%e5%ad%97%e6%af%8d%e5%8f%98%e9%87%8f%e5%90%8d aria-label=单字母变量名>单字母变量名</a></li></ul></li><li><a href=#%e9%87%8d%e5%a4%8d aria-label=重复>重复</a><ul><li><a href=#%e5%8c%85%e4%b8%8e%e5%af%bc%e5%87%ba%e7%9a%84%e7%ac%a6%e5%8f%b7%e5%90%8d%e7%a7%b0 aria-label=包与导出的符号名称>包与导出的符号名称</a></li><li><a href=#%e5%8f%98%e9%87%8f%e5%90%8d%e4%b8%8e%e7%b1%bb%e5%9e%8b aria-label=变量名与类型>变量名与类型</a></li><li><a href=#%e5%a4%96%e9%83%a8%e4%b8%8a%e4%b8%8b%e6%96%87%e4%b8%8e%e6%9c%ac%e5%9c%b0%e5%90%8d%e7%a7%b0 aria-label=外部上下文与本地名称>外部上下文与本地名称</a></li></ul></li></ul></li><li><a href=#imports aria-label=imports>imports</a><ul><li><a href=#%e5%af%bc%e5%85%a5%e9%87%8d%e5%91%bd%e5%90%8d aria-label=导入重命名>导入重命名</a></li><li><a href=#%e5%af%bc%e5%85%a5%e5%88%86%e7%bb%84 aria-label=导入分组>导入分组</a></li><li><a href=#%e5%af%bc%e5%85%a5%e7%a9%ba%e7%99%bd--import-_ aria-label="导入“空白” ( import _)">导入“空白” ( <code>import _</code>)</a></li><li><a href=#%e5%af%bc%e5%85%a5%e7%82%b9-import- aria-label="导入“点”( import .)">导入“点”( <code>import .</code>)</a></li></ul></li><li><a href=#%e9%94%99%e8%af%af aria-label=错误>错误</a><ul><li><a href=#%e8%bf%94%e5%9b%9e%e9%94%99%e8%af%af aria-label=返回错误>返回错误</a></li><li><a href=#%e9%94%99%e8%af%af%e5%ad%97%e7%ac%a6%e4%b8%b2 aria-label=错误字符串>错误字符串</a></li><li><a href=#%e5%a4%84%e7%90%86%e9%94%99%e8%af%af aria-label=处理错误>处理错误</a></li><li><a href=#%e5%b8%a6%e5%86%85%e9%94%99%e8%af%af aria-label=带内错误>带内错误</a></li><li><a href=#%e7%bc%a9%e8%bf%9b%e9%94%99%e8%af%af%e6%b5%81%e7%a8%8b aria-label=缩进错误流程>缩进错误流程</a></li></ul></li><li><a href=#%e6%96%87%e5%ad%97%e6%a0%bc%e5%bc%8f%e8%af%ad%e6%b3%95 aria-label=文字格式语法>文字格式语法</a><ul><li><a href=#%e6%97%a0%e5%88%87%e7%89%87 aria-label=无切片>无切片</a></li><li><a href=#%e5%87%bd%e6%95%b0%e6%a0%bc%e5%bc%8f%e5%8c%96 aria-label=函数格式化>函数格式化</a></li><li><a href=#%e6%9d%a1%e4%bb%b6%e5%92%8c%e5%be%aa%e7%8e%af aria-label=条件和循环>条件和循环</a></li></ul></li><li><a href=#%e5%a4%8d%e5%88%b6 aria-label=复制>复制</a><ul><li><a href=#%e6%8e%a5%e5%8f%a3 aria-label=接口>接口</a></li></ul></li><li><a href=#%e4%bc%a0%e5%80%bc aria-label=传值>传值</a><ul><li><a href=#%e6%8e%a5%e6%94%b6%e5%99%a8%e7%b1%bb%e5%9e%8b aria-label=接收器类型>接收器类型</a></li><li><a href=#switch%e5%92%8cbreak aria-label=switch和break><code>switch</code>和<code>break</code></a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=go-代码风格指南>GO 代码风格指南<a hidden class=anchor aria-hidden=true href=#go-代码风格指南>#</a></h1><h2 id=风格原则>风格原则<a hidden class=anchor aria-hidden=true href=#风格原则>#</a></h2><p>​ 有一些总体原则总结了如何考虑编写可读的 Go 代码。以下是可读代码的属性，按重要性排序：</p><ol><li><strong><a href=https://google.github.io/styleguide/go/guide#clarity>清晰</a></strong>：代码的目的和基本原理对读者来说是清楚的。</li><li><strong><a href=https://google.github.io/styleguide/go/guide#simplicity>简单性</a></strong>：代码以尽可能简单的方式实现其目标。</li><li><strong><a href=https://google.github.io/styleguide/go/guide#concision>简洁</a></strong>：代码具有高信噪比。</li><li><strong><a href=https://google.github.io/styleguide/go/guide#maintainability>可维护性</a></strong>：代码的编写使其易于维护。</li><li><strong><a href=https://google.github.io/styleguide/go/guide#consistency>一致性</a></strong>：代码与更广泛的 Google 代码库一致。</li></ol><h2 id=命名>命名<a hidden class=anchor aria-hidden=true href=#命名>#</a></h2><h3 id=下划线>下划线<a hidden class=anchor aria-hidden=true href=#下划线>#</a></h3><p>Go 中的名称通常不应包含下划线。这个原则有三个例外：</p><ol><li>仅由生成的代码导入的包名称可能包含下划线。有关如何选择多词包名称的更多详细信息，请参阅包<a href=https://google.github.io/styleguide/go/decisions#package-names>名称</a></li><li>文件中的测试、基准和示例函数名称<code>*_test.go</code>可能包含下划线。</li><li>与操作系统或 cgo 互操作的低级库可能会重用标识符，如<a href=https://pkg.go.dev/syscall#pkg-constants><code>syscall</code></a>. 在大多数代码库中，这预计是非常罕见的。</li></ol><h3 id=包名>包名<a hidden class=anchor aria-hidden=true href=#包名>#</a></h3><p>​ Go 包名称应该简短并且只包含小写字母。由多个单词组成的包名称应全部小写。例如，包<a href=https://pkg.go.dev/text/tabwriter><code>tabwriter</code></a>未命名为<code>tabWriter</code>、<code>TabWriter</code>或 <code>tab_writer</code>。</p><p>​ 避免选择可能被常用局部变量名<a href=https://google.github.io/styleguide/go/best-practices#shadowing>遮蔽的包名。</a>例如，<code>usercount</code>是一个比 更好的包名 <code>count</code>，因为<code>count</code>是一个常用的变量名。</p><p>​ Go 包名称不应该有下划线。如果您需要导入名称中确实有一个包（通常来自生成的或第三方代码），则必须在导入时将其重命名为适合在 Go 代码中使用的名称。</p><p>一个例外是仅由生成的代码导入的包名称可能包含下划线。具体例子包括：</p><ul><li>使用<code>_test</code>外部测试包的后缀，例如集成测试</li><li>使用<a href=https://go.dev/blog/examples>包级文档示例</a><code>_test</code>的后缀</li></ul><p>​ 避免使用无意义的包名称，例如<code>util</code>, <code>utility</code>, <code>common</code>,<code>helper</code>等。查看更多关于 <a href=https://google.github.io/styleguide/go/best-practices#util-packages>所谓的“实用程序包”</a>的信息。</p><p>​ 当导入的包被重命名（例如<code>import foopb "path/to/foo_go_proto"</code>）时，包的本地名称必须符合上述规则，因为本地名称决定了包中的符号在文件中的引用方式。如果给定的导入在多个文件中重命名，特别是在相同或附近的包中，则应尽可能使用相同的本地名称以保持一致性。</p><blockquote><p>另请参阅：https://go.dev/blog/package-names</p></blockquote><h3 id=参数别名>参数别名<a hidden class=anchor aria-hidden=true href=#参数别名>#</a></h3><p><a href=https://golang.org/ref/spec#Method_declarations>接收器</a>变量名称必须是：</p><ul><li>短（通常是一两个字母的长度）</li><li>类型本身的缩写</li><li>一致地应用于该类型的每个接收器</li></ul><table><thead><tr><th>长名</th><th>更好的名字</th></tr></thead><tbody><tr><td><code>func (tray Tray)</code></td><td><code>func (t Tray)</code></td></tr><tr><td><code>func (info *ResearchInfo)</code></td><td><code>func (ri *ResearchInfo)</code></td></tr><tr><td><code>func (this *ReportWriter)</code></td><td><code>func (w *ReportWriter)</code></td></tr><tr><td><code>func (self *Scanner)</code></td><td><code>func (s *Scanner)</code></td></tr></tbody></table><h3 id=常量名称>常量名称<a hidden class=anchor aria-hidden=true href=#常量名称>#</a></h3><p>​ 常量名称必须像 Go 中的所有其他名称一样使用<a href=https://google.github.io/styleguide/go/guide#mixed-caps>MixedCaps</a>（<a href=https://tour.golang.org/basics/3>导出</a> 的常量以大写字母开头，而未导出的常量以小写字母开头。）即使它打破了其他语言的约定，这也适用。</p><p>​ <strong>常量名称不应是其值的派生词，而应解释值的含义。</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> MaxPacketSize = <span style=color:#a5d6ff>512</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> (
</span></span><span style=display:flex><span>    ExecuteBit = <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>&lt;&lt;</span> <span style=color:#79c0ff>iota</span>
</span></span><span style=display:flex><span>    WriteBit
</span></span><span style=display:flex><span>    ReadBit
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>不要使用非 MixedCaps 常量名称或带有<code>K</code>前缀的常量。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> MAX_PACKET_SIZE = <span style=color:#a5d6ff>512</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> kMaxBufferSize = <span style=color:#a5d6ff>1024</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> KMaxUsersPergroup = <span style=color:#a5d6ff>500</span>
</span></span></code></pre></td></tr></table></div></div><p>根据它们的角色而不是它们的值来命名常量。如果一个常量除了它的值之外没有其他作用，那么就没有必要将它定义为一个常量。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> Twelve = <span style=color:#a5d6ff>12</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> (
</span></span><span style=display:flex><span>    UserNameColumn = <span style=color:#a5d6ff>&#34;username&#34;</span>
</span></span><span style=display:flex><span>    GroupColumn    = <span style=color:#a5d6ff>&#34;group&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=缩写词>缩写词<a hidden class=anchor aria-hidden=true href=#缩写词>#</a></h3><p>​ 名称中的首字母缩略词或首字母缩略词（例如，<code>URL</code>和<code>NATO</code>）应该具有相同的大小写。<code>URL</code>应显示为<code>URL</code>或<code>url</code>（如<code>urlPony</code>, 或 <code>URLPony</code>），绝不能显示为<code>Url</code>. 这也适用于<code>ID</code>“标识符”的缩写；写<code>appID</code>而不是<code>appId</code>。</p><ul><li>在具有多个首字母缩写词的名称中（例如<code>XMLAPI</code>，因为它包含<code>XML</code> and <code>API</code>），给定首字母缩写词中的每个字母都应该具有相同的大小写，但名称中的每个首字母缩写词不需要具有相同的大小写。</li><li>在首字母缩写包含小写字母（例如<code>DDoS</code>, <code>iOS</code>, <code>gRPC</code>）的名称中，首字母缩写应该像在标准散文中一样出现，除非您需要为了<a href=https://golang.org/ref/spec#Exported_identifiers>导出</a>性而更改第一个字母。在这些情况下，整个首字母大写应该是相同的情况（例如<code>ddos</code>, <code>IOS</code>, <code>GRPC</code>）。</li></ul><table><thead><tr><th>初始主义</th><th>范围</th><th>正确的</th><th>不正确</th></tr></thead><tbody><tr><td>XML API</td><td>已出口</td><td><code>XMLAPI</code></td><td><code>XmlApi</code>, <code>XMLApi</code>, <code>XmlAPI</code>,<code>XMLapi</code></td></tr><tr><td>XML API</td><td>未出口</td><td><code>xmlAPI</code></td><td><code>xmlapi</code>,<code>xmlApi</code></td></tr><tr><td>iOS</td><td>已出口</td><td><code>IOS</code></td><td><code>Ios</code>,<code>IoS</code></td></tr><tr><td>iOS</td><td>未出口</td><td><code>iOS</code></td><td><code>ios</code></td></tr><tr><td>gRPC</td><td>已出口</td><td><code>GRPC</code></td><td><code>Grpc</code></td></tr><tr><td>gRPC</td><td>未出口</td><td><code>gRPC</code></td><td><code>grpc</code></td></tr><tr><td>分布式拒绝服务</td><td>已出口</td><td><code>DDoS</code></td><td><code>DDOS</code>,<code>Ddos</code></td></tr><tr><td>分布式拒绝服务</td><td>未出口</td><td><code>ddos</code></td><td><code>dDoS</code>,<code>dDOS</code></td></tr></tbody></table><h3 id=函数名称>函数名称<a hidden class=anchor aria-hidden=true href=#函数名称>#</a></h3><p>​ 函数和方法名称不应使用<code>Get</code>或<code>get</code>前缀，除非底层概念使用单词“get”（例如 HTTP GET）。更喜欢直接以名词开头的名称，例如使用<code>Counts</code>over <code>GetCounts</code>。</p><p>如果该函数涉及执行复杂的计算或执行远程调用，则可以使用不同的词（如<code>Compute</code>或）代替，以向读者清楚地表明函数调用可能需要时间并且可能会阻塞或失败。<code>Fetch Get</code></p><h3 id=变量名>变量名<a hidden class=anchor aria-hidden=true href=#变量名>#</a></h3><p>一般的经验法则是，名称的长度应与其范围的大小成正比，并与其在该范围内使用的次数成反比。在文件范围内创建的变量可能需要多个单词，而作用域为单个内部块的变量可能是单个单词甚至只是一两个字符，以保持代码清晰并避免无关信息。</p><p>这是一个粗略的基线。这些数字准则不是严格的规则。根据上下文、<a href=https://google.github.io/styleguide/go/guide#clarity>清晰度</a>和<a href=https://google.github.io/styleguide/go/guide#concision>简洁</a>性应用判断。</p><ul><li>小范围是执行一两个小操作的范围，比如 1-7 行。</li><li>中等范围是一些小的或一个大的操作，比如 8-15 行。</li><li>大范围是一个或几个大操作，比如 15-25 行。</li><li>非常大的范围是指超过一页（例如，超过 25 行）的任何内容。</li></ul><p>在小范围内可能非常清楚的名称（例如，<code>c</code>对于计数器）在较大范围内可能是不够的，并且需要澄清以提醒读者其在代码中的目的。一个作用域中有很多变量，或者表示相似值或概念的变量，可能需要比作用域建议的更长的变量名称。</p><p>概念的特殊性也有助于保持变量名称的简洁。例如，假设只有一个数据库在使用，像<code>db</code>这样的短变量名通常可能为非常小的范围保留，即使范围非常大也可能保持完全清晰。在这种情况下，根据范围的大小，单个词 <code>database</code>可能是可以接受的，但不是必需的，因为这<code>db</code>是一个非常常见的词缩写，几乎没有其他解释。</p><p>局部变量的名称应该反映它包含的内容以及它在当前上下文中的使用方式，而不是值的来源。例如，通常情况下最佳局部变量名称与结构或协议缓冲区字段名称不同。</p><p>一般来说：</p><ul><li><p>像<code>count</code>或这样的单词名称<code>options</code>是一个很好的起点。</p></li><li><p>可以添加其他词来消除相似名称的歧义，例如 <code>userCount</code>and <code>projectCount</code>。</p></li><li><p>不要为了节省打字而简单地放下字母。例如<code>Sandbox</code>比 更受欢迎<code>Sbx</code>，特别是对于导出的名称。</p></li><li><p>从大多数变量名中 省略</p><p>类型和类似类型的词。</p><ul><li>对于数字，<code>userCount</code>是比<code>numUsers</code>or 更好的名称<code>usersInt</code>。</li><li>对于切片，<code>users</code>是一个比<code>userSlice</code>.</li><li>如果范围内有两个版本的值，则包含类似类型的限定符是可以接受的，例如，您可能将输入存储在解析值中<code>ageString</code>并<code>age</code>用于解析值。</li></ul></li><li><p><a href=https://google.github.io/styleguide/go/decisions#repetitive-in-context>省略周围上下文</a>清楚的词。例如，在一个<code>UserCount</code>方法的实现中，调用的一个局部变量 <code>userCount</code>很可能是多余的；<code>count</code>, <code>users</code>, 甚至<code>c</code>都一样可读。</p></li></ul><h4 id=单字母变量名>单字母变量名<a hidden class=anchor aria-hidden=true href=#单字母变量名>#</a></h4><p>单字母变量名可能是减少 <a href=https://google.github.io/styleguide/go/decisions#repetition>重复</a>的有用工具，但也可能使代码不必要地变得不透明。将它们的使用限制在完整单词很明显以及它会重复出现以代替单字母变量的情况。</p><p>一般来说：</p><ul><li>对于<a href=https://google.github.io/styleguide/go/decisions#receiver-names>方法接收者变量</a>，首选一个字母或两个字母的名称。</li><li>对常见类型使用熟悉的变量名通常很有帮助：<ul><li><code>r</code>对于一个<code>io.Reader</code>或<code>*http.Request</code></li><li><code>w</code>对于一个<code>io.Writer</code>或<code>http.ResponseWriter</code></li></ul></li><li>单字母标识符作为整数循环变量是可接受的，特别是对于索引（例如，<code>i</code>）和坐标（例如，<code>x</code>和<code>y</code>）。</li><li>当范围很短时，缩写可以是可接受的循环标识符，例如<code>for _, n := range nodes { ... }</code>.</li></ul><h3 id=重复>重复<a hidden class=anchor aria-hidden=true href=#重复>#</a></h3><p>​ 一段 Go 源代码应该避免不必要的重复。一个常见的来源是重复名称，其中通常包含不必要的单词或重复其上下文或类型。如果相同或相似的代码段在很近的地方多次出现，代码本身也可能是不必要的重复。</p><p>重复命名可以有多种形式，包括：</p><h4 id=包与导出的符号名称>包与导出的符号名称<a hidden class=anchor aria-hidden=true href=#包与导出的符号名称>#</a></h4><p>​ 命名导出的符号时，包的名称始终在包外可见，因此应减少或消除两者之间的冗余信息。如果一个包仅导出一种类型并且它以包本身命名，则构造函数的规范名称是<code>New</code>if one is required。</p><blockquote><p>**示例：**重复名称 -> 更好的名称</p><ul><li><code>widget.NewWidget</code>-><code>widget.New</code></li><li><code>widget.NewWidgetWithName</code>-><code>widget.NewWithName</code></li><li><code>db.LoadFromDatabase</code>-><code>db.Load</code></li><li><code>goatteleportutil.CountGoatsTeleported</code>-><code>gtutil.CountGoatsTeleported</code> 或<code>goatteleport.Count</code></li><li><code>myteampb.MyTeamMethodRequest</code>-><code>mtpb.MyTeamMethodRequest</code>或 <code>myteampb.MethodRequest</code></li></ul></blockquote><h4 id=变量名与类型>变量名与类型<a hidden class=anchor aria-hidden=true href=#变量名与类型>#</a></h4><p>​ 编译器总是知道变量的类型，并且在大多数情况下，读者也可以通过变量的使用方式清楚地知道变量是什么类型。如果一个变量的值在同一范围内出现两次，则只需明确变量的类型。</p><table><thead><tr><th>重复名称</th><th>更好的名字</th></tr></thead><tbody><tr><td><code>var numUsers int</code></td><td><code>var users int</code></td></tr><tr><td><code>var nameString string</code></td><td><code>var name string</code></td></tr><tr><td><code>var primaryProject *Project</code></td><td><code>var primary *Project</code></td></tr></tbody></table><p>如果该值以多种形式出现，则可以使用像<code>raw</code>and<code>parsed</code>或底层表示这样的额外词来澄清：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>limitStr <span style=color:#ff7b72;font-weight:700>:=</span> r.<span style=color:#d2a8ff;font-weight:700>FormValue</span>(<span style=color:#a5d6ff>&#34;limit&#34;</span>)
</span></span><span style=display:flex><span>limit, err <span style=color:#ff7b72;font-weight:700>:=</span> strconv.<span style=color:#d2a8ff;font-weight:700>Atoi</span>(limitStr)
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>limitRaw <span style=color:#ff7b72;font-weight:700>:=</span> r.<span style=color:#d2a8ff;font-weight:700>FormValue</span>(<span style=color:#a5d6ff>&#34;limit&#34;</span>)
</span></span><span style=display:flex><span>limit, err <span style=color:#ff7b72;font-weight:700>:=</span> strconv.<span style=color:#d2a8ff;font-weight:700>Atoi</span>(limitRaw)
</span></span></code></pre></td></tr></table></div></div><h4 id=外部上下文与本地名称>外部上下文与本地名称<a hidden class=anchor aria-hidden=true href=#外部上下文与本地名称>#</a></h4><p>​ 包含来自周围上下文信息的名称通常会产生额外的噪音而没有任何好处。包名、方法名、类型名、函数名、导入路径，甚至文件名都可以提供自动限定其中所有名称的上下文。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;ads/targeting/revenue/reporting&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> AdsTargetingRevenueReport <span style=color:#ff7b72>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (p <span style=color:#ff7b72;font-weight:700>*</span>Project) <span style=color:#d2a8ff;font-weight:700>ProjectName</span>() <span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;ads/targeting/revenue/reporting&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Report <span style=color:#ff7b72>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (p <span style=color:#ff7b72;font-weight:700>*</span>Project) <span style=color:#d2a8ff;font-weight:700>Name</span>() <span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;sqldb&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> DBConnection <span style=color:#ff7b72>struct</span>{}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;sqldb&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Connection <span style=color:#ff7b72>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;ads/targeting&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Process</span>(in <span style=color:#ff7b72;font-weight:700>*</span>pb.FooProto) <span style=color:#ff7b72;font-weight:700>*</span>Report {
</span></span><span style=display:flex><span>    adsTargetingID <span style=color:#ff7b72;font-weight:700>:=</span> in.<span style=color:#d2a8ff;font-weight:700>GetAdsTargetingID</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// In package &#34;ads/targeting&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Process</span>(in <span style=color:#ff7b72;font-weight:700>*</span>pb.FooProto) <span style=color:#ff7b72;font-weight:700>*</span>Report {
</span></span><span style=display:flex><span>    id <span style=color:#ff7b72;font-weight:700>:=</span> in.<span style=color:#d2a8ff;font-weight:700>GetAdsTargetingID</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ 重复通常应该在符号用户的上下文中进行评估，而不是孤立地进行评估。例如，下面的代码有很多名称，在某些情况下可能没问题，但在上下文中是多余的：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (db <span style=color:#ff7b72;font-weight:700>*</span>DB) <span style=color:#d2a8ff;font-weight:700>UserCount</span>() (userCount <span style=color:#ff7b72>int</span>, err <span style=color:#ff7b72>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>var</span> userCountInt64 <span style=color:#ff7b72>int64</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> dbLoadError <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>LoadFromDatabase</span>(<span style=color:#a5d6ff>&#34;count(distinct users)&#34;</span>, <span style=color:#ff7b72;font-weight:700>&amp;</span>userCountInt64); dbLoadError <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span>, fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;failed to load user count: %s&#34;</span>, dbLoadError)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    userCount = int(userCountInt64)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> userCount, <span style=color:#79c0ff>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>相反，通常可以省略有关从上下文或用法中清楚的名称的信息：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (db <span style=color:#ff7b72;font-weight:700>*</span>DB) <span style=color:#d2a8ff;font-weight:700>UserCount</span>() (<span style=color:#ff7b72>int</span>, <span style=color:#ff7b72>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>var</span> count <span style=color:#ff7b72>int64</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>Load</span>(<span style=color:#a5d6ff>&#34;count(distinct users)&#34;</span>, <span style=color:#ff7b72;font-weight:700>&amp;</span>count); err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span>, fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;failed to load user count: %s&#34;</span>, err)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> int(count), <span style=color:#79c0ff>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=imports>imports<a hidden class=anchor aria-hidden=true href=#imports>#</a></h2><h3 id=导入重命名>导入重命名<a hidden class=anchor aria-hidden=true href=#导入重命名>#</a></h3><p>​ <em>只应重命名导入以避免与其他导入的名称冲突</em>。（由此推论，<a href=https://google.github.io/styleguide/go/decisions#package-names>好的包名</a>不应该需要重命名。）在名称冲突的情况下，更愿意重命名最本地或特定于项目的导入。包的本地名称（别名）必须遵循 <a href=https://google.github.io/styleguide/go/decisions#package-names>包命名指南</a>，包括禁止使用下划线和大写字母。</p><p>​ 生成的 protocol buffer 包必须重命名以从名称中删除下划线，并且它们的别名必须有<code>pb</code>后缀。有关详细信息，请参阅 <a href=https://google.github.io/styleguide/go/best-practices#import-protos>原型和存根最佳实践</a>。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// Good:
</span></span><span style=display:flex><span>import (
</span></span><span style=display:flex><span>    fspb &#34;path/to/package/foo_service_go_proto&#34;
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>导入的包名称没有有用的识别信息（例如 <code>package v1</code>）应该重命名以包括以前的路径组件。重命名必须与导入相同包的其他本地文件一致，并且可以包括版本号。</p><p>**注意：**最好重命名包以符合 <a href=https://google.github.io/styleguide/go/decisions#package-names>良好的包名称</a>，但这对于 vendored 目录中的包通常不可行。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// Good:
</span></span><span style=display:flex><span>import (
</span></span><span style=display:flex><span>    core &#34;github.com/kubernetes/api/core/v1&#34;
</span></span><span style=display:flex><span>    meta &#34;github.com/kubernetes/apimachinery/pkg/apis/meta/v1beta1&#34;
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 如果您需要导入一个名称与您要使用的公共局部变量名称（例如<code>url</code>, <code>ssh</code>）冲突的包，并且您希望重命名该包，首选方法是使用<code>pkg</code>后缀（例如<code>urlpkg</code>）。请注意，可以使用局部变量隐藏包；仅当此类变量在范围内时仍需要使用包时，才需要重命名。</p><h3 id=导入分组>导入分组<a hidden class=anchor aria-hidden=true href=#导入分组>#</a></h3><p>导入应分为两组：</p><ul><li>标准库包</li><li>其他（项目和销售）包</li></ul><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;hash/adler32&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;github.com/dsnet/compress/flate&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;golang.org/x/text/encoding&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;google.golang.org/protobuf/proto&#34;</span>
</span></span><span style=display:flex><span>    foopb <span style=color:#a5d6ff>&#34;myproj/foo/proto/proto&#34;</span>
</span></span><span style=display:flex><span>    _ <span style=color:#a5d6ff>&#34;myproj/rpc/protocols/dial&#34;</span>
</span></span><span style=display:flex><span>    _ <span style=color:#a5d6ff>&#34;myproj/security/auth/authhooks&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 将项目包分成多个组是可以接受的，例如，如果您想要一个单独的组来重命名、import-only-for-side-effects 或另一个特殊的导入组。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;hash/adler32&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;github.com/dsnet/compress/flate&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;golang.org/x/text/encoding&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;google.golang.org/protobuf/proto&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    foopb <span style=color:#a5d6ff>&#34;myproj/foo/proto/proto&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    _ <span style=color:#a5d6ff>&#34;myproj/rpc/protocols/dial&#34;</span>
</span></span><span style=display:flex><span>    _ <span style=color:#a5d6ff>&#34;myproj/security/auth/authhooks&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>​ <strong>注意：</strong><a href=https://google.github.io/styleguide/go/golang.org/x/tools/cmd/goimports>goimports</a>工具不支持维护可选组 - 超出标准库和 Google 导入之间强制分离所需的拆分。额外的导入子组需要作者和审稿人的注意，以保持符合状态。</p><p>​ 也是 AppEngine 应用程序的 Google 程序应该有一个单独的组用于 AppEngine 导入。</p><h3 id=导入空白--import-_>导入“空白” ( <code>import _</code>)<a hidden class=anchor aria-hidden=true href=#导入空白--import-_>#</a></h3><p>仅为了副作用<code>import _ "package"</code>而导入的包（使用语法 ）只能在主包或需要它们的测试中导入。</p><p>此类软件包的一些示例包括：</p><ul><li><a href=https://pkg.go.dev/time/tzdata>时间/tzdata</a></li><li>图像处理代码中的<a href=https://pkg.go.dev/image/jpeg>image/jpeg</a></li></ul><p>避免在库包中导入空白，即使库间接依赖于它们。将副作用导入限制到主包有助于控制依赖性，并使得编写依赖于不同导入的测试成为可能，而不会发生冲突或浪费构建成本。</p><p>以下是此规则的唯一例外情况：</p><ul><li>您可以使用空白导入绕过 <a href=https://github.com/bazelbuild/rules_go/blob/master/go/nogo.rst>nogo 静态检查器中对不允许导入的检查</a>。</li><li>您可以在使用编译器指令的源文件中使用<a href=https://pkg.go.dev/embed>嵌入</a>包的空白导入。<code>//go:embed</code></li></ul><p>**提示：**如果您创建的库包间接依赖于生产中的副作用导入，请记录预期用途。</p><h3 id=导入点-import->导入“点”( <code>import .</code>)<a hidden class=anchor aria-hidden=true href=#导入点-import->#</a></h3><p>​ <code>import .</code>表单是一种语言功能，允许将从另一个包导出的标识符无条件地带到当前包中。有关更多信息，请参阅<a href=https://go.dev/ref/spec#Import_declarations>语言规范</a>。</p><p>不要在 Google 代码库<strong>中</strong>使用此功能；这使得更难判断功能来自何处。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> foo_test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;bar/testutil&#34;</span> <span style=color:#8b949e;font-style:italic>// also imports &#34;foo&#34;</span>
</span></span><span style=display:flex><span>    . <span style=color:#a5d6ff>&#34;foo&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> myThing = <span style=color:#d2a8ff;font-weight:700>Bar</span>() <span style=color:#8b949e;font-style:italic>// Bar defined in package foo; no qualification needed.</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> foo_test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;bar/testutil&#34;</span> <span style=color:#8b949e;font-style:italic>// also imports &#34;foo&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;foo&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> myThing = foo.<span style=color:#d2a8ff;font-weight:700>Bar</span>()
</span></span></code></pre></td></tr></table></div></div><h2 id=错误>错误<a hidden class=anchor aria-hidden=true href=#错误>#</a></h2><h3 id=返回错误>返回错误<a hidden class=anchor aria-hidden=true href=#返回错误>#</a></h3><p>​ 用于<code>error</code>表示函数可能会失败。按照惯例，<code>error</code>是最后一个结果参数。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Good</span>() <span style=color:#ff7b72>error</span> { <span style=color:#8b949e;font-style:italic>/* ... */</span> }
</span></span></code></pre></td></tr></table></div></div><p>​ 返回<code>nil</code>错误是表示操作成功的惯用方式，否则可能会失败。如果函数返回错误，除非另有明确说明，否则调用者必须将所有非错误返回值视为未指定。通常，非错误返回值是它们的零值，但这不能假设。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>GoodLookup</span>() (<span style=color:#ff7b72;font-weight:700>*</span>Result, <span style=color:#ff7b72>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>nil</span>, err
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> res, <span style=color:#79c0ff>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ 返回错误的导出函数应该使用<code>error</code>类型返回它们。具体的错误类型容易受到细微错误的影响：具体的<code>nil</code>指针可以包装到接口中，从而变成非零值（请参阅 <a href=https://golang.org/doc/faq#nil_error>主题上的 Go FAQ 条目</a>）。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Bad</span>() <span style=color:#ff7b72;font-weight:700>*</span>os.PathError { <span style=color:#8b949e;font-style:italic>/*...*/</span> }
</span></span></code></pre></td></tr></table></div></div><p>​ <strong>提示</strong>：带有<code>context.Context</code>参数的函数通常应返回一个<code>error</code>，以便调用者可以确定在函数运行时上下文是否被取消。</p><h3 id=错误字符串>错误字符串<a hidden class=anchor aria-hidden=true href=#错误字符串>#</a></h3><p>​ 错误字符串不应大写（除非以导出名称、专有名词或首字母缩写词开头）并且不应以标点符号结尾。这是因为错误字符串通常在打印给用户之前出现在其他上下文中。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>err <span style=color:#ff7b72;font-weight:700>:=</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;Something bad happened.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>err <span style=color:#ff7b72;font-weight:700>:=</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;something bad happened&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 另一方面，完整显示消息（日志记录、测试失败、API 响应或其他 UI）的样式取决于，但通常应大写。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>log.<span style=color:#d2a8ff;font-weight:700>Infof</span>(<span style=color:#a5d6ff>&#34;Operation aborted: %v&#34;</span>, err)
</span></span><span style=display:flex><span>log.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;Operation aborted: %v&#34;</span>, err)
</span></span><span style=display:flex><span>t.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;Op(%q) failed unexpectedly; err=%v&#34;</span>, args, err)
</span></span></code></pre></td></tr></table></div></div><h3 id=处理错误>处理错误<a hidden class=anchor aria-hidden=true href=#处理错误>#</a></h3><p>​ 遇到错误的代码应该慎重选择如何处理它。<code>_</code>使用变量丢弃错误通常是不合适的。如果函数返回错误，请执行以下操作之一：</p><ul><li>立即处理并解决错误。</li><li>将错误返回给调用者。</li><li>在特殊情况下，请致电<a href=https://pkg.go.dev/github.com/golang/glog#Fatal><code>log.Fatal</code></a>或（如果绝对必要） <code>panic</code>。</li></ul><p><strong>注意：</strong> <code>log.Fatalf</code>不是标准库日志。参见 [#logging]。</p><p>​ 在极少数情况下，忽略或丢弃错误是合适的（例如<a href=https://pkg.go.dev/bytes#Buffer.Write><code>(*bytes.Buffer).Write</code></a>，记录的调用永远不会失败），随附的注释应该解释为什么这是安全的。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> b <span style=color:#ff7b72;font-weight:700>*</span>bytes.Buffer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>n, _ <span style=color:#ff7b72;font-weight:700>:=</span> b.<span style=color:#d2a8ff;font-weight:700>Write</span>(p) <span style=color:#8b949e;font-style:italic>// never returns a non-nil error</span>
</span></span></code></pre></td></tr></table></div></div><p>有关错误处理的更多讨论和示例，请参阅 <a href=http://golang.org/doc/effective_go.html#errors>Effective Go</a> and <a href=https://google.github.io/styleguide/go/best-practices.html#error-handling>best practices</a>。</p><h3 id=带内错误>带内错误<a hidden class=anchor aria-hidden=true href=#带内错误>#</a></h3><p>​ 在 C 和类似语言中，函数返回值（如 -1、null 或空字符串）以表示错误或缺少结果是很常见的。这称为带内错误处理。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Lookup returns the value for key or -1 if there is no mapping for key.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Lookup</span>(key <span style=color:#ff7b72>string</span>) <span style=color:#ff7b72>int</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 未能检查带内错误值可能会导致错误，并将错误归因于错误的函数。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// The following line returns an error that Parse failed for the input value,</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// whereas the failure was that there is no mapping for missingKey.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>Parse</span>(<span style=color:#d2a8ff;font-weight:700>Lookup</span>(missingKey))
</span></span></code></pre></td></tr></table></div></div><p>​ Go 对多个返回值的支持提供了更好的解决方案（请参阅 <a href=http://golang.org/doc/effective_go.html#multiple-returns>Effective Go 部分的多个返回值</a>）。函数不应要求客户端检查带内错误值，而应返回一个附加值以指示其其他返回值是否有效。这个返回值可能是一个错误，也可能是一个布尔值，无需解释，应该是最终的返回值。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Lookup returns the value for key or ok=false if there is no mapping for key.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Lookup</span>(key <span style=color:#ff7b72>string</span>) (value <span style=color:#ff7b72>string</span>, ok <span style=color:#ff7b72>bool</span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 此 API 可防止调用者错误写入<code>Parse(Lookup(key))</code>而导致编译时错误，因为<code>Lookup(key)</code>它有 2 个输出。</p><p>以这种方式返回错误鼓励更健壮和明确的错误处理：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>value, ok <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#d2a8ff;font-weight:700>Lookup</span>(key)
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> !ok {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;no value for %q&#34;</span>, key)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72>return</span> <span style=color:#d2a8ff;font-weight:700>Parse</span>(value)
</span></span></code></pre></td></tr></table></div></div><p>​ 一些标准库函数，如 package中的函数<code>strings</code>，返回带内错误值。这极大地简化了字符串操作代码，但代价是需要程序员更加勤奋。一般来说，Google 代码库中的 Go 代码应该为错误返回额外的值。</p><h3 id=缩进错误流程>缩进错误流程<a hidden class=anchor aria-hidden=true href=#缩进错误流程>#</a></h3><p>​ 在继续您的代码的其余部分之前处理错误。这通过使读者能够快速找到正常路径来提高代码的可读性。同样的逻辑适用于任何测试条件然后以终止条件结束的块（例如<code>return</code>，，，<code>panic</code>）<code>log.Fatal</code>。</p><p>​ 如果不满足终止条件，则运行的代码应出现在<code>if</code> 块之后，并且不应在<code>else</code>子句中缩进。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// error handling</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#8b949e;font-style:italic>// or continue, etc.</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// normal code</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// error handling</span>
</span></span><span style=display:flex><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// normal code that looks abnormal due to indentation</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p>**提示：**如果您在多行代码中使用一个变量，通常不值得使用<code>if</code>-with-initializer 样式。在这些情况下，通常最好将声明移出并使用标准<code>if</code> 语句：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>x, err <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#d2a8ff;font-weight:700>f</span>()
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// error handling</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// lots of code that uses x</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// across multiple lines</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> x, err <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#d2a8ff;font-weight:700>f</span>(); err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// error handling</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>} <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// lots of code that uses x</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// across multiple lines</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></blockquote><p>有关详细信息，请参阅<a href=https://google.github.io/styleguide/go/index.html#gotip>Go 技巧 #1：视线</a>和 <a href=https://testing.googleblog.com/2017/06/code-health-reduce-nesting-reduce.html>TotT：通过减少嵌套</a> 来降低代码复杂性。</p><h2 id=文字格式语法>文字格式语法<a hidden class=anchor aria-hidden=true href=#文字格式语法>#</a></h2><h3 id=无切片>无切片<a hidden class=anchor aria-hidden=true href=#无切片>#</a></h3><p>​ <code>nil</code>对于大多数用途，空切片和空切片之间没有功能差异。内置函数在切片上的表现<code>len</code>和<code>cap</code>预期一样。<code>nil</code></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#a5d6ff>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> s []<span style=color:#ff7b72>int</span>         <span style=color:#8b949e;font-style:italic>// nil</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(s)      <span style=color:#8b949e;font-style:italic>// []</span>
</span></span><span style=display:flex><span>fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(len(s)) <span style=color:#8b949e;font-style:italic>// 0</span>
</span></span><span style=display:flex><span>fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(cap(s)) <span style=color:#8b949e;font-style:italic>// 0</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> <span style=color:#ff7b72>range</span> s {<span style=color:#ff7b72;font-weight:700>...</span>}   <span style=color:#8b949e;font-style:italic>// no-op</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s = append(s, <span style=color:#a5d6ff>42</span>)
</span></span><span style=display:flex><span>fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(s)      <span style=color:#8b949e;font-style:italic>// [42]</span>
</span></span></code></pre></td></tr></table></div></div><p>​ 如果您将空切片声明为局部变量（尤其是如果它可以作为返回值的来源），则首选 nil 初始化以降低调用者出现错误的风险。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> t []<span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>t <span style=color:#ff7b72;font-weight:700>:=</span> []<span style=color:#ff7b72>string</span>{}
</span></span></code></pre></td></tr></table></div></div><p>​ 不要创建强制其客户区分 nil 和空切片的 API。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Ping pings its targets.</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Returns hosts that successfully responded.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Ping</span>(hosts []<span style=color:#ff7b72>string</span>) ([]<span style=color:#ff7b72>string</span>, <span style=color:#ff7b72>error</span>) { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Ping pings its targets and returns a list of hosts</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// that successfully responded. Can be empty if the input was empty.</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// nil signifies that a system error occurred.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Ping</span>(hosts []<span style=color:#ff7b72>string</span>) []<span style=color:#ff7b72>string</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span></code></pre></td></tr></table></div></div><p>​ 在设计接口时，避免区分<code>nil</code>切片和<code>nil</code>非零长度切片，因为这会导致细微的编程错误。这通常是通过使用<code>len</code>to 检查是否为空来完成的，而不是<code>== nil</code>.</p><p>​ 此实现接受两个<code>nil</code>和零长度切片为“空”：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// describeInts describes s with the given prefix, unless s is empty.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>describeInts</span>(prefix <span style=color:#ff7b72>string</span>, s []<span style=color:#ff7b72>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> len(s) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(prefix, s)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>​ 而不是依赖于区别作为 API 的一部分：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>maybeInts</span>() []<span style=color:#ff7b72>int</span> { <span style=color:#8b949e;font-style:italic>/* ... */</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// describeInts describes s with the given prefix; pass nil to skip completely.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>describeInts</span>(prefix <span style=color:#ff7b72>string</span>, s []<span style=color:#ff7b72>int</span>) {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// The behavior of this function unintentionally changes depending on what</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// maybeInts() returns in &#39;empty&#39; cases (nil or []int{}).</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> s <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  fmt.<span style=color:#d2a8ff;font-weight:700>Println</span>(prefix, s)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>describeInts</span>(<span style=color:#a5d6ff>&#34;Here are some ints:&#34;</span>, <span style=color:#d2a8ff;font-weight:700>maybeInts</span>())
</span></span></code></pre></td></tr></table></div></div><p>有关进一步讨论，请参阅<a href=https://google.github.io/styleguide/go/decisions#in-band-errors>带内错误</a>。</p><h3 id=函数格式化>函数格式化<a hidden class=anchor aria-hidden=true href=#函数格式化>#</a></h3><p>函数或方法声明的签名应保留在一行中以避免<a href=https://google.github.io/styleguide/go/decisions#indentation-confusion>缩进混淆</a>。</p><p>函数参数列表可以构成 Go 源文件中最长的几行。但是，它们先于缩进的变化，因此很难以不使后续行看起来像函数体的一部分的方式以令人困惑的方式断行：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (r <span style=color:#ff7b72;font-weight:700>*</span>SomeType) <span style=color:#d2a8ff;font-weight:700>SomeLongFunctionName</span>(foo1, foo2, foo3 <span style=color:#ff7b72>string</span>,
</span></span><span style=display:flex><span>    foo4, foo5, foo6 <span style=color:#ff7b72>int</span>) {
</span></span><span style=display:flex><span>    foo7 <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#d2a8ff;font-weight:700>bar</span>(foo1)
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>请参阅<a href=https://google.github.io/styleguide/go/best-practices#funcargs>最佳实践</a>，了解一些选项，以缩短函数的调用站点，否则会有很多参数。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>good <span style=color:#ff7b72;font-weight:700>:=</span> foo.<span style=color:#d2a8ff;font-weight:700>Call</span>(long, CallOptions{
</span></span><span style=display:flex><span>    Names:   list,
</span></span><span style=display:flex><span>    Of:      of,
</span></span><span style=display:flex><span>    The:     parameters,
</span></span><span style=display:flex><span>    Func:    all,
</span></span><span style=display:flex><span>    Args:    on,
</span></span><span style=display:flex><span>    Now:     separate,
</span></span><span style=display:flex><span>    Visible: lines,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>bad <span style=color:#ff7b72;font-weight:700>:=</span> foo.<span style=color:#d2a8ff;font-weight:700>Call</span>(
</span></span><span style=display:flex><span>    long,
</span></span><span style=display:flex><span>    list,
</span></span><span style=display:flex><span>    of,
</span></span><span style=display:flex><span>    parameters,
</span></span><span style=display:flex><span>    all,
</span></span><span style=display:flex><span>    on,
</span></span><span style=display:flex><span>    separate,
</span></span><span style=display:flex><span>    lines,
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>通常可以通过分解出局部变量来缩短行。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>local <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#d2a8ff;font-weight:700>helper</span>(some, parameters, here)
</span></span><span style=display:flex><span>good <span style=color:#ff7b72;font-weight:700>:=</span> foo.<span style=color:#d2a8ff;font-weight:700>Call</span>(list, of, parameters, local)
</span></span></code></pre></td></tr></table></div></div><p>​ 同样，函数和方法调用不应仅根据行长度来分开。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>good <span style=color:#ff7b72;font-weight:700>:=</span> foo.<span style=color:#d2a8ff;font-weight:700>Call</span>(long, list, of, parameters, all, on, one, line)
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>bad <span style=color:#ff7b72;font-weight:700>:=</span> foo.<span style=color:#d2a8ff;font-weight:700>Call</span>(long, list, of, parameters,
</span></span><span style=display:flex><span>    with, arbitrary, line, breaks)
</span></span></code></pre></td></tr></table></div></div><p>​ 不要为特定的函数参数添加注释。相反，使用 <a href=https://google.github.io/styleguide/go/best-practices#option-structure>选项结构</a>或向函数文档添加更多详细信息。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>good <span style=color:#ff7b72;font-weight:700>:=</span> server.<span style=color:#d2a8ff;font-weight:700>New</span>(ctx, server.Options{Port: <span style=color:#a5d6ff>42</span>})
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>bad <span style=color:#ff7b72;font-weight:700>:=</span> server.<span style=color:#d2a8ff;font-weight:700>New</span>(
</span></span><span style=display:flex><span>    ctx,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>42</span>, <span style=color:#8b949e;font-style:italic>// Port</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 如果调用站点长得让人不舒服，请考虑重构：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Sometimes variadic arguments can be factored out</span>
</span></span><span style=display:flex><span>replacements <span style=color:#ff7b72;font-weight:700>:=</span> []<span style=color:#ff7b72>string</span>{
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;from&#34;</span>, <span style=color:#a5d6ff>&#34;to&#34;</span>, <span style=color:#8b949e;font-style:italic>// related values can be formatted adjacent to one another</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;source&#34;</span>, <span style=color:#a5d6ff>&#34;dest&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;original&#34;</span>, <span style=color:#a5d6ff>&#34;new&#34;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Use the replacement struct as inputs to NewReplacer.</span>
</span></span><span style=display:flex><span>replacer <span style=color:#ff7b72;font-weight:700>:=</span> strings.<span style=color:#d2a8ff;font-weight:700>NewReplacer</span>(replacements<span style=color:#ff7b72;font-weight:700>...</span>)
</span></span></code></pre></td></tr></table></div></div><p>​ 如果 API 无法更改或本地调用异常（无论调用是否太长），如果有助于理解调用，则始终允许添加换行符。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>canvas.<span style=color:#d2a8ff;font-weight:700>RenderCube</span>(cube,
</span></span><span style=display:flex><span>    x0, y0, z0,
</span></span><span style=display:flex><span>    x0, y0, z1,
</span></span><span style=display:flex><span>    x0, y1, z0,
</span></span><span style=display:flex><span>    x0, y1, z1,
</span></span><span style=display:flex><span>    x1, y0, z0,
</span></span><span style=display:flex><span>    x1, y0, z1,
</span></span><span style=display:flex><span>    x1, y1, z0,
</span></span><span style=display:flex><span>    x1, y1, z1,
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><p>请注意，上例中的线条并未环绕在特定的列边界处，而是根据坐标三元组进行分组。</p><p>​ 函数内的长字符串字面值不应因行长而被打断。对于包含此类字符串的函数，可以在字符串格式后添加换行符，并且可以在下一行或后续行提供参数。关于换行符应该去哪里的决定最好基于输入的语义分组，而不是纯粹基于行的长度。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>log.<span style=color:#d2a8ff;font-weight:700>Warningf</span>(<span style=color:#a5d6ff>&#34;Database key (%q, %d, %q) incompatible in transaction started by (%q, %d, %q)&#34;</span>,
</span></span><span style=display:flex><span>    currentCustomer, currentOffset, currentKey,
</span></span><span style=display:flex><span>    txCustomer, txOffset, txKey)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>log.<span style=color:#d2a8ff;font-weight:700>Warningf</span>(<span style=color:#a5d6ff>&#34;Database key (%q, %d, %q) incompatible in&#34;</span><span style=color:#ff7b72;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34; transaction started by (%q, %d, %q)&#34;</span>,
</span></span><span style=display:flex><span>    currentCustomer, currentOffset, currentKey, txCustomer,
</span></span><span style=display:flex><span>    txOffset, txKey)
</span></span></code></pre></td></tr></table></div></div><h3 id=条件和循环>条件和循环<a hidden class=anchor aria-hidden=true href=#条件和循环>#</a></h3><p>​ 声明<code>if</code>不应断行；多行<code>if</code>子句会导致 <a href=https://google.github.io/styleguide/go/decisions#indentation-confusion>缩进混乱</a>。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// The second if statement is aligned with the code within the if block, causing</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// indentation confusion.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> db.<span style=color:#d2a8ff;font-weight:700>CurrentStatusIs</span>(db.InTransaction) <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span>
</span></span><span style=display:flex><span>    db.<span style=color:#d2a8ff;font-weight:700>ValuesEqual</span>(db.<span style=color:#d2a8ff;font-weight:700>TransactionKey</span>(), row.<span style=color:#d2a8ff;font-weight:700>Key</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> db.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(db.TransactionError, <span style=color:#a5d6ff>&#34;query failed: row (%v): key does not match transaction key&#34;</span>, row)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>如果不需要短路行为，可以直接提取布尔操作数：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>inTransaction <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>CurrentStatusIs</span>(db.InTransaction)
</span></span><span style=display:flex><span>keysMatch <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>ValuesEqual</span>(db.<span style=color:#d2a8ff;font-weight:700>TransactionKey</span>(), row.<span style=color:#d2a8ff;font-weight:700>Key</span>())
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> inTransaction <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> keysMatch {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> db.<span style=color:#d2a8ff;font-weight:700>Error</span>(db.TransactionError, <span style=color:#a5d6ff>&#34;query failed: row (%v): key does not match transaction key&#34;</span>, row)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>可能还可以提取其他局部变量，尤其是在条件已经重复的情况下：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span>uid <span style=color:#ff7b72;font-weight:700>:=</span> user.<span style=color:#d2a8ff;font-weight:700>GetUniqueUserID</span>()
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> db.<span style=color:#d2a8ff;font-weight:700>UserIsAdmin</span>(uid) <span style=color:#ff7b72;font-weight:700>||</span> db.<span style=color:#d2a8ff;font-weight:700>UserHasPermission</span>(uid, perms.ViewServerConfig) <span style=color:#ff7b72;font-weight:700>||</span> db.<span style=color:#d2a8ff;font-weight:700>UserHasPermission</span>(uid, perms.CreateGroup) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> db.<span style=color:#d2a8ff;font-weight:700>UserIsAdmin</span>(user.<span style=color:#d2a8ff;font-weight:700>GetUniqueUserID</span>()) <span style=color:#ff7b72;font-weight:700>||</span> db.<span style=color:#d2a8ff;font-weight:700>UserHasPermission</span>(user.<span style=color:#d2a8ff;font-weight:700>GetUniqueUserID</span>(), perms.ViewServerConfig) <span style=color:#ff7b72;font-weight:700>||</span> db.<span style=color:#d2a8ff;font-weight:700>UserHasPermission</span>(user.<span style=color:#d2a8ff;font-weight:700>GetUniqueUserID</span>(), perms.CreateGroup) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>if</code>包含闭包或多行结构文字的语句应确保<a href=https://google.github.io/styleguide/go/decisions#literal-matching-braces>大括号匹配</a>以避免 <a href=https://google.github.io/styleguide/go/decisions#indentation-confusion>缩进混淆</a>。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> err <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>RunInTransaction</span>(<span style=color:#ff7b72>func</span>(tx <span style=color:#ff7b72;font-weight:700>*</span>db.TX) <span style=color:#ff7b72>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> tx.<span style=color:#d2a8ff;font-weight:700>Execute</span>(userUpdate, x, y, z)
</span></span><span style=display:flex><span>}); err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;user update failed: %s&#34;</span>, err)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> _, err <span style=color:#ff7b72;font-weight:700>:=</span> client.<span style=color:#d2a8ff;font-weight:700>Update</span>(ctx, <span style=color:#ff7b72;font-weight:700>&amp;</span>upb.UserUpdateRequest{
</span></span><span style=display:flex><span>    ID:   userID,
</span></span><span style=display:flex><span>    User: user,
</span></span><span style=display:flex><span>}); err <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#79c0ff>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;user update failed: %s&#34;</span>, err)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>同样，不要尝试在<code>for</code>语句中插入人为的换行符。如果没有优雅的重构方式，你总是可以让这条线很长：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> i, max <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#a5d6ff>0</span>, collection.<span style=color:#d2a8ff;font-weight:700>Size</span>(); i &lt; max <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> !collection.<span style=color:#d2a8ff;font-weight:700>HasPendingWriters</span>(); i<span style=color:#ff7b72;font-weight:700>++</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>但是，通常有：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> i, max <span style=color:#ff7b72;font-weight:700>:=</span> <span style=color:#a5d6ff>0</span>, collection.<span style=color:#d2a8ff;font-weight:700>Size</span>(); i &lt; max; i<span style=color:#ff7b72;font-weight:700>++</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> collection.<span style=color:#d2a8ff;font-weight:700>HasPendingWriters</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>break</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>switch</code>和<code>case</code>语句也应该保持在一行中。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>switch</span> good <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>TransactionStatus</span>(); good {
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> db.TransactionStarting, db.TransactionActive, db.TransactionWaiting:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> db.TransactionCommitted, db.NoTransaction:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>switch</span> bad <span style=color:#ff7b72;font-weight:700>:=</span> db.<span style=color:#d2a8ff;font-weight:700>TransactionStatus</span>(); bad {
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> db.TransactionStarting,
</span></span><span style=display:flex><span>    db.TransactionActive,
</span></span><span style=display:flex><span>    db.TransactionWaiting:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> db.TransactionCommitted,
</span></span><span style=display:flex><span>    db.NoTransaction:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>如果行太长，缩进所有的案例并用空行分隔它们以避免<a href=https://google.github.io/styleguide/go/decisions#indentation-confusion>缩进混淆</a>：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>switch</span> db.<span style=color:#d2a8ff;font-weight:700>TransactionStatus</span>() {
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span>
</span></span><span style=display:flex><span>    db.TransactionStarting,
</span></span><span style=display:flex><span>    db.TransactionActive,
</span></span><span style=display:flex><span>    db.TransactionWaiting,
</span></span><span style=display:flex><span>    db.TransactionCommitted:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> db.NoTransaction:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>在比较变量和常量的条件语句中，将变量值放在相等运算符的左侧：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> result <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;foo&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>取而代之的是常数首先出现的不太清晰的措辞（<a href=https://en.wikipedia.org/wiki/Yoda_conditions>“Yoda style conditionals”</a>）：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#34;foo&#34;</span> <span style=color:#ff7b72;font-weight:700>==</span> result {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=复制>复制<a hidden class=anchor aria-hidden=true href=#复制>#</a></h2><p>为避免意外的别名和类似错误，从另一个包复制结构时要小心。例如，<code>sync.Mutex</code> 不得复制诸如此类的同步对象。</p><p>该<code>bytes.Buffer</code>类型包含一个<code>[]byte</code>切片，并且作为对小字符串的优化，还包含一个切片可能引用的小字节数组。如果您复制 a <code>Buffer</code>，则副本中的切片可能会为原始数组设置别名，从而导致后续方法调用产生令人惊讶的效果。</p><p><code>T</code>通常，如果类型的方法与指针类型关联，则不要复制该类型的值<code>*T</code>。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span>b1 <span style=color:#ff7b72;font-weight:700>:=</span> bytes.Buffer{}
</span></span><span style=display:flex><span>b2 <span style=color:#ff7b72;font-weight:700>:=</span> b1
</span></span></code></pre></td></tr></table></div></div><p>调用采用值接收器的方法可以隐藏副本。当您编写 API 时，如果您的结构包含不应复制的字段，您通常应该获取和返回指针类型。</p><p>这些是可以接受的：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Record <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>  buf bytes.Buffer
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// other fields omitted</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>New</span>() <span style=color:#ff7b72;font-weight:700>*</span>Record {<span style=color:#ff7b72;font-weight:700>...</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (r <span style=color:#ff7b72;font-weight:700>*</span>Record) <span style=color:#d2a8ff;font-weight:700>Process</span>(<span style=color:#ff7b72;font-weight:700>...</span>) {<span style=color:#ff7b72;font-weight:700>...</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Consumer</span>(r <span style=color:#ff7b72;font-weight:700>*</span>Record) {<span style=color:#ff7b72;font-weight:700>...</span>}
</span></span></code></pre></td></tr></table></div></div><p>但这些通常是错误的：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Record <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>  buf bytes.Buffer
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// other fields omitted</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (r Record) <span style=color:#d2a8ff;font-weight:700>Process</span>(<span style=color:#ff7b72;font-weight:700>...</span>) {<span style=color:#ff7b72;font-weight:700>...</span>} <span style=color:#8b949e;font-style:italic>// Makes a copy of r.buf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Consumer</span>(r Record) {<span style=color:#ff7b72;font-weight:700>...</span>} <span style=color:#8b949e;font-style:italic>// Makes a copy of r.buf</span>
</span></span></code></pre></td></tr></table></div></div><p>本指南也适用于复印<code>sync.Mutex</code>。</p><h3 id=接口>接口<a hidden class=anchor aria-hidden=true href=#接口>#</a></h3><p>​ Go接口通常属于使用接口类型值的包，而不是<em>实现</em>接口类型的包。实施包应该返回具体的（通常是指针或结构）类型。这样，无需大量重构即可将新方法添加到实现中。有关详细信息，请参阅<a href=https://google.github.io/styleguide/go/index.html#gotip>GoTip #49：接受接口，返回具体类型</a> 。</p><p>​ 不要从使用接口的 API 导出接口的<a href=https://abseil.io/resources/swe-book/html/ch13.html#techniques_for_using_test_doubles>测试替身</a>实现。相反，设计 API 以便可以使用<a href=https://google.github.io/styleguide/go/best-practices#use-real-transports>实际实现</a>的<a href=https://abseil.io/resources/swe-book/html/ch12.html#test_via_public_apis>公共 API</a>对其进行测试。有关详细信息，请参阅 <a href=https://google.github.io/styleguide/go/index.html#gotip>GoTip #42：编写用于测试的存根</a>。即使在使用真实实现不可行的情况下，也可能没有必要引入一个完全覆盖真实类型中所有方法的接口；消费者可以创建一个仅包含其所需方法的接口，如 <a href=https://google.github.io/styleguide/go/index.html#gotip>GoTip #78：最小可行接口</a>中所示。</p><p>​ 要测试使用 Stubby RPC 客户端的包，请使用真实的客户端连接。如果无法在测试中运行真实服务器，Google 的内部做法是使用内部 rpctest 包（即将推出！）获取到本地 [test double] 的真实客户端连接。</p><p>​ 不要在使用之前定义接口（请参阅 <a href=https://testing.googleblog.com/2017/08/code-health-eliminate-yagni-smells.html>TotT：代码健康：消除 YAGNI 气味</a>）(YAGNI: <em><strong>你不需要它（ You Aren’t Gonna Need It</strong></em>)。如果没有实际的使用示例，就很难判断一个接口是否必要，更不用说它应该包含哪些方法了。</p><blockquote><p>软件开发的大部分成本是维护成本。<strong>减少维护成本的一个方法是：“只在当你真正需要它时，才去编写它”</strong>。</p></blockquote><p>如果包的用户不需要为他们传递不同的类型，请不要使用接口类型参数。</p><p><code>不要导出包的用户不需要的接口</code>。</p><p>**TODO：**在接口上写一个更深入的文档并在此处链接到它。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> consumer <span style=color:#8b949e;font-style:italic>// consumer.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Thinger <span style=color:#ff7b72>interface</span> { <span style=color:#d2a8ff;font-weight:700>Thing</span>() <span style=color:#ff7b72>bool</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>Foo</span>(t Thinger) <span style=color:#ff7b72>string</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> consumer <span style=color:#8b949e;font-style:italic>// consumer_test.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> fakeThinger <span style=color:#ff7b72>struct</span>{ <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (t fakeThinger) <span style=color:#d2a8ff;font-weight:700>Thing</span>() <span style=color:#ff7b72>bool</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> <span style=color:#d2a8ff;font-weight:700>Foo</span>(fakeThinger{<span style=color:#ff7b72;font-weight:700>...</span>}) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;x&#34;</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> producer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Thinger <span style=color:#ff7b72>interface</span> { <span style=color:#d2a8ff;font-weight:700>Thing</span>() <span style=color:#ff7b72>bool</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> defaultThinger <span style=color:#ff7b72>struct</span>{ <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (t defaultThinger) <span style=color:#d2a8ff;font-weight:700>Thing</span>() <span style=color:#ff7b72>bool</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>NewThinger</span>() Thinger { <span style=color:#ff7b72>return</span> defaultThinger{ <span style=color:#ff7b72;font-weight:700>...</span> } }
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> producer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Thinger <span style=color:#ff7b72>struct</span>{ <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (t Thinger) <span style=color:#d2a8ff;font-weight:700>Thing</span>() <span style=color:#ff7b72>bool</span> { <span style=color:#ff7b72;font-weight:700>...</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>NewThinger</span>() Thinger { <span style=color:#ff7b72>return</span> Thinger{ <span style=color:#ff7b72;font-weight:700>...</span> } }
</span></span></code></pre></td></tr></table></div></div><h2 id=传值>传值<a hidden class=anchor aria-hidden=true href=#传值>#</a></h2><blockquote><p>不要为了节省几个字节而将指针作为函数参数传递。</p></blockquote><p>​ 如果一个函数<code>x</code>只读取它的参数<code>*x</code>，那么这个参数不应该是一个指针。这方面的常见实例包括传递一个指向字符串 ( <code>*string</code>) 的指针或一个指向接口值 ( <code>*io.Reader</code>) 的指针。在这两种情况下，值本身都是固定大小的，可以直接传递。</p><p>​ 此建议不适用于大型结构，甚至可能会增加大小的小型结构。特别是，protocol buffer 消息通常应该由指针而不是值来处理。指针类型满足 <code>proto.Message</code>接口（被 , 等接受<code>proto.Marshal</code>）<code>protocmp.Transform</code>，并且协议缓冲区消息可能非常大，并且通常会随着时间的推移而变大。</p><h3 id=接收器类型>接收器类型<a hidden class=anchor aria-hidden=true href=#接收器类型>#</a></h3><p>​ 方法<a href=https://golang.org/ref/spec#Method_declarations>接收者</a>可以作为值或指针传递，就好像它是常规函数参数一样。选择哪个应该基于该方法应该属于哪个<a href=https://golang.org/ref/spec#Method_sets>方法集</a>。</p><p>​ **正确性胜过速度或简单性。**在某些情况下，您必须使用指针值。在其他情况下，如果您对代码将如何增长没有很好的了解，则为大型类型选择指针或作为面向未来的指针，并为简单的<a href=https://en.wikipedia.org/wiki/Passive_data_structure>普通旧数据</a>使用值。</p><p>下面的列表更详细地说明了每个案例：</p><ul><li><p>如果接收者是一个切片并且该方法不重新切片或重新分配切片，请使用值而不是指针。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Buffer []<span style=color:#ff7b72>byte</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (b Buffer) <span style=color:#d2a8ff;font-weight:700>Len</span>() <span style=color:#ff7b72>int</span> { <span style=color:#ff7b72>return</span> len(b) }
</span></span></code></pre></td></tr></table></div></div></li><li><p>如果该方法需要改变接收者，则接收者必须是一个指针。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Counter <span style=color:#ff7b72>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (c <span style=color:#ff7b72;font-weight:700>*</span>Counter) <span style=color:#d2a8ff;font-weight:700>Inc</span>() { <span style=color:#ff7b72;font-weight:700>*</span>c<span style=color:#ff7b72;font-weight:700>++</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// See https://pkg.go.dev/container/heap.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Queue []Item
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (q <span style=color:#ff7b72;font-weight:700>*</span>Queue) <span style=color:#d2a8ff;font-weight:700>Push</span>(x Item) { <span style=color:#ff7b72;font-weight:700>*</span>q = append([]Item{x}, <span style=color:#ff7b72;font-weight:700>*</span>q<span style=color:#ff7b72;font-weight:700>...</span>) }
</span></span></code></pre></td></tr></table></div></div></li><li><p>如果接收者是一个包含 <a href=https://google.github.io/styleguide/go/decisions#copying>无法安全复制</a>的字段的结构，请使用指针接收者。常见的例子是<a href=https://pkg.go.dev/sync#Mutex><code>sync.Mutex</code></a>和其他同步类型。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Counter <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>    mu    sync.Mutex
</span></span><span style=display:flex><span>    total <span style=color:#ff7b72>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (c <span style=color:#ff7b72;font-weight:700>*</span>Counter) <span style=color:#d2a8ff;font-weight:700>Inc</span>() {
</span></span><span style=display:flex><span>    c.mu.<span style=color:#d2a8ff;font-weight:700>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>defer</span> c.mu.<span style=color:#d2a8ff;font-weight:700>Unlock</span>()
</span></span><span style=display:flex><span>    c.total<span style=color:#ff7b72;font-weight:700>++</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>**提示：**检查类型的<a href=https://pkg.go.dev/time#example-Duration>Godoc</a>以获取有关复制是否安全的信息。</p></li><li><p>如果接收器是“大”结构或数组，指针接收器可能更有效。传递结构等同于将其所有字段或元素作为参数传递给方法。如果这看起来太大而不能 <a href=https://google.github.io/styleguide/go/decisions#pass-values>按值传递</a>，那么指针是一个不错的选择。</p></li><li><p>对于将调用或与其他修改接收器的函数同时运行的方法，如果这些修改对您的方法不可见，请使用一个值；否则使用指针。</p></li><li><p>如果接收器是一个结构或数组，其中任何一个元素都是指向可能发生变化的东西的指针，则更喜欢指针接收器以使读者清楚地了解可变性的意图。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Counter <span style=color:#ff7b72>struct</span> {
</span></span><span style=display:flex><span>    m <span style=color:#ff7b72;font-weight:700>*</span>Metric
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (c <span style=color:#ff7b72;font-weight:700>*</span>Counter) <span style=color:#d2a8ff;font-weight:700>Inc</span>() {
</span></span><span style=display:flex><span>    c.m.<span style=color:#d2a8ff;font-weight:700>Add</span>(<span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></li><li><p>如果接收者是<a href=https://pkg.go.dev/builtin>内置类型</a>，例如整数或字符串，不需要修改，则使用值。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> User <span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (u User) <span style=color:#d2a8ff;font-weight:700>String</span>() { <span style=color:#ff7b72>return</span> string(u) }
</span></span></code></pre></td></tr></table></div></div></li><li><p>如果接收者是映射、函数或通道，请使用值而不是指针。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// See https://pkg.go.dev/net/http#Header.</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>type</span> Header <span style=color:#ff7b72>map</span>[<span style=color:#ff7b72>string</span>][]<span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (h Header) <span style=color:#d2a8ff;font-weight:700>Add</span>(key, value <span style=color:#ff7b72>string</span>) { <span style=color:#8b949e;font-style:italic>/* omitted */</span> }
</span></span></code></pre></td></tr></table></div></div></li><li><p>如果接收者是一个“小”数组或结构，它自然是一个没有可变字段和指针的值类型，那么值接收者通常是正确的选择。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>//</span> Good:
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>//</span> See https:<span style=color:#ff7b72;font-weight:700>//</span>pkg<span style=color:#ff7b72;font-weight:700>.</span>go<span style=color:#ff7b72;font-weight:700>.</span>dev<span style=color:#ff7b72;font-weight:700>/</span>time<span style=color:#8b949e;font-style:italic>#Time.</span>
</span></span><span style=display:flex><span>type Time struct { <span style=color:#ff7b72;font-weight:700>/*</span> omitted <span style=color:#ff7b72;font-weight:700>*/</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> (t Time) Add(d Duration) Time { <span style=color:#ff7b72;font-weight:700>/*</span> omitted <span style=color:#ff7b72;font-weight:700>*/</span> }
</span></span></code></pre></td></tr></table></div></div></li><li><p>如有疑问，请使用指针接收器。</p></li></ul><p>作为一般准则，更喜欢使类型的方法全部为指针方法或全部为值方法。</p><p>**注意：**关于将值或指针传递给函数是否会影响性能，存在很多错误信息。编译器可以选择将指针传递给堆栈上的值以及复制堆栈上的值，但在大多数情况下，这些考虑不应超过代码的可读性和正确性。当性能确实很重要时，重要的是在决定一种方法优于另一种方法之前，用一个现实的基准来分析这两种方法。</p><h3 id=switch和break><code>switch</code>和<code>break</code><a hidden class=anchor aria-hidden=true href=#switch和break>#</a></h3><p>​ 不要在子句<code>break</code>末尾使用没有目标标签的<code>switch</code> 语句；他们是多余的。与 C 和 Java 不同，<code>switch</code>Go 中的子句会自动中断，并且需要一条<code>fallthrough</code>语句来实现 C 风格的行为。<code>break</code>如果您想阐明空子句的目的，请使用注释而不是。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Good:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>switch</span> x {
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;A&#34;</span>, <span style=color:#a5d6ff>&#34;B&#34;</span>:
</span></span><span style=display:flex><span>    buf.<span style=color:#d2a8ff;font-weight:700>WriteString</span>(x)
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;C&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// handled outside of the switch statement</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;unknown value: %q&#34;</span>, x)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Bad:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>switch</span> x {
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;A&#34;</span>, <span style=color:#a5d6ff>&#34;B&#34;</span>:
</span></span><span style=display:flex><span>    buf.<span style=color:#d2a8ff;font-weight:700>WriteString</span>(x)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>break</span> <span style=color:#8b949e;font-style:italic>// this break is redundant</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;C&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>break</span> <span style=color:#8b949e;font-style:italic>// this break is redundant</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> fmt.<span style=color:#d2a8ff;font-weight:700>Errorf</span>(<span style=color:#a5d6ff>&#34;unknown value: %q&#34;</span>, x)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><blockquote><p>**注意：**如果<code>switch</code>子句在<code>for</code>循环内，则使用<code>break</code>within <code>switch</code>不会退出封闭<code>for</code>循环。</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff7b72>for</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>switch</span> x {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;A&#34;</span>:
</span></span><span style=display:flex><span>     <span style=color:#ff7b72>break</span> <span style=color:#8b949e;font-style:italic>// exits the switch, not the loop</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>for</code>要退出封闭循环，请在语句上使用标签：</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>loop:
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>switch</span> x {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>case</span> <span style=color:#a5d6ff>&#34;A&#34;</span>:
</span></span><span style=display:flex><span>       <span style=color:#ff7b72>break</span> loop <span style=color:#8b949e;font-style:italic>// exits the loop</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span></code></pre></td></tr></table></div></div></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://luenci.com/en/tags/%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC/>代码风格</a></li></ul><nav class=paginav><a class=prev href=https://luenci.com/en/posts/%E8%81%8A%E8%81%8A%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA-opentracing/><span class=title>« Prev</span><br><span>聊聊链路追踪 OpenTracing</span>
</a><a class=next href=https://luenci.com/en/posts/gitops-%E5%8E%9F%E7%90%86/><span class=title>Next »</span><br><span>Giweights 介绍</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on x" href="https://x.com/intent/tweet/?text=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f&amp;hashtags=%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f&amp;title=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&amp;summary=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&amp;source=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f&title=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on whatsapp" href="https://api.whatsapp.com/send?text=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97%20-%20https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on telegram" href="https://telegram.me/share/url?text=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&amp;url=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share GO 代码风格指南 on ycombinator" href="https://news.ycombinator.com/submitlink?t=GO%20%e4%bb%a3%e7%a0%81%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&u=https%3a%2f%2fluenci.com%2fen%2fposts%2fgolang%25E4%25BB%25A3%25E7%25A0%2581%25E9%25A3%258E%25E6%25A0%25BC%25E6%258C%2587%25E5%258D%2597%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=Lucareful/Lucareful.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxOTMzMDM3NDA=" data-category=Q&A data-category-id=DIC_kwDOC4WUvM4ChdIQ data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><script src=https://sdk.jinrishici.com/v2/browser/jinrishici.js></script><script type=text/javascript>jinrishici.load(function(e){var t=document.querySelector(".poem_sentence"),n=document.querySelector(".poem_info");t.innerHTML=e.data.content,n.innerHTML="—— "+e.data.origin.author})</script><span><a id=running-time></a><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>👁️‍🗨️访客人数: <span id=busuanzi_value_site_uv></span>|
🌐访问量: <span id=busuanzi_value_site_pv></span></span></span><br><span>&copy; 2025 <a href=https://luenci.com/en/>Luenci</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a> 📖
<text class=poem_sentence></text><text class=poem_info></text></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});const RunningTimerInterval=1e3,StartTime=new Date("10/11/2018 00:00:00");function prefixZero(e){return e<10&&(e="0"+e),e}function updateTime(){const r=new Date;let e=r.getTime()-StartTime.getTime();const t=24*60*60*1e3,n=Math.floor(e/t);e-=n*t;const s=60*60*1e3,o=Math.floor(e/s);e-=o*s;const i=60*1e3,a=Math.floor(e/i);e-=a*i;const c=Math.floor(e/1e3),l=document.getElementById("running-time");l.innerText="🕚: "+n+"天"+prefixZero(o)+"小时"+prefixZero(a)+"分"+prefixZero(c)+"秒"}document.addEventListener("DOMContentLoaded",()=>{let e=setInterval(updateTime,RunningTimerInterval)})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>